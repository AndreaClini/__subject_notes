% !TeX root = ../geometry_main.tex
%==========================================================
%=========================================================
\chapter{Towards General Relativity}
%=========================================================
%=========================================================



%-----------------------------------------------------------
%=======================================================
\section{Conservation laws}\todotag{To be written}
%=======================================================
%------------------------------------------------------------


\begin{mytheorem}[What even are energy and mometum?]
In flat spacetime physics we are used to notions like energy and momentum.
To make sense of similar notions in curved spacetime, we first need to investigate what these quantities really are.
Energy and momentum are the Noether charges corresponding symmetries of spacetime, namely time-translation and space-translation invariance of the laws of physics.
Indeed the equations we write for flat spacetimes  typically respect these symmetries, and hence we have conservation of energy and momentum.

In curved spacetime, even if we write down equations that do not explicitly depend on spacetime position, the curvature of spacetime itself can break these symmetries i.e. in practice the metric $g_{\mu\nu}$ may depend on spacetime position.
This means that in general curved spacetimes we may not have global conservation of energy and momentum, and in fact we may not even be able to define them properly.

In any case, we will \emph{identify} energy and momentum with the Noether charges associated to time-translation and space-translation invariance, whenever these symmetries exist.
In practice, whenever we have a timelike Killing vector field, we can define a conserved energy, and whenever we have spacelike Killing vector fields, we can define a conserved momentum in that direction.
\end{mytheorem}


\begin{mytheorem}[Killing vector field\todotag{finish}]
%
A Killing vector field $K$ is a vector field whose flow generates an isometry of the metric manifold i.e. the Lie derivative of the metric along $K$ vanishes
\begin{align}
    \mathcal{L}_K g = 0.
\end{align}
Using metric compatibility $\nabla g=0$ and replacing partial with covariant derivatives\footnote{As discussed in Section \ref{sec:lie_derivative}, both expressions are tensorial and coincide in normal coordinates.} the Killing condition can be equivalently written as
\begin{align}
    0=\left(\mathcal{L}_K g\right)_{\mu\nu}&\equiv K^\lambda \partial_\lambda g_{\mu\nu} + g_{\lambda\nu} \partial_\mu K^\lambda + g_{\mu\lambda} \partial_\nu K^\lambda\\
    &= K^\lambda \underbrace{\nabla_\lambda g_{\mu\nu}}_{=0} + \underbrace{g_{\lambda\nu} \nabla_\mu K^\lambda}_{=\nabla_\mu K_\nu} + \underbrace{g_{\mu\lambda} \nabla_\nu K^\lambda}_{=\nabla_\nu K_\mu}
    = \nabla_\mu K_\nu + \nabla_\nu K_\mu.
\end{align}
That is finally, the Killing equation equivalently reads
\begin{align}
    \nabla_\mu K_\nu + \nabla_\nu K_\mu = 0.
\end{align}

The number of Killing vector fields of a spacetime is a measure of its symmetries.
In $n$-dimensional spacetime, the maximum number of linearly independent Killing vector fields is $n(n+1)/2$.
This number is intuitively clear for two reasons.
First, we have $n$ \emph{local} directions of translation symmetry--i.e. in the tangent space--and $n(n-1)/2$ directions of rotation symmetry.
For example, in 4D we have 4 translations and 6 `generalized rotations' (3 ordinary spatial rotations and 3 boosts).
Second, $n(n+1)/2$ is precisely the number of independent components of the metric tensor $g_{\mu\nu}$, so that exceeding this number would overconstrain the metric.
Spacetimes achieving this maximum number, like Minkowski, de Sitter and anti-de Sitter, are called \emph{maximally symmetric}.
%
\end{mytheorem}



\begin{mytheorem}[Energy-momentum tensor of continuum distributions \& Bianchi conservation laws] \todotag{Finish}
The energy-momentum tensor $T^{\mu\nu}$ is a symmetric rank-2 tensor that encodes the density and flux of energy and momentum in spacetime.
In flat spacetime we define it directly as the Noether current associated to invariance of the action under spacetime translations 
\begin{align}
    x^\mu &\to x^\mu + \epsilon^\mu,\qquad \phi_a(x) \to \phi_a(x) + S^a_b \phi_b(x)- \epsilon^\mu \partial_\mu \phi_a(x).
\end{align}
%
In general spacetimes we do not have such symmetries precisely because the nontrivial curvature $g_{\mu\nu}(x)$ might obstruct them.
It is then intuitive that \emph{whatever we identify with energy and momentum} should be very \emph{sensitive to variations of the metric} $g_{\mu\nu}$, since indeed a trivial metric $g_{\mu\nu}=\eta_{\mu\nu}$ would immediately yield such conserved quantities.
We thus define the energy-momentum as the tensorial quantity identified in the variation of the matter action under $g_{\mu\nu}\mapsto g_{\mu\nu} + \delta g_{\mu\nu}$\todotag{Fix}
\begin{align}
    \delta S_\text{mat} = \delta \left(\int \mathrm{d}^dx\,\sqrt{|g|}\,\,\mathcal{L}_\text{mat}\right)
    =: \frac{1}{2} \int \mathrm{d}^d x \sqrt{-g}\, T^{\mu\nu}_\text{mat}\,\,\delta g_{\mu\nu}.
\end{align}
This quantity is indeed a tensor since $\sqrt{|g|}\, \mathrm{d}^d x $ is the volume form, $\delta g^{\mu\nu}$ is a tensor and the action is a scalar.
The quantity $T_{\mu\nu}$ must then transform as tensor in order to keep $T_{\mu\nu} \delta g^{\mu\nu}$ a scalar.

Using $\delta g_{\mu\nu} = - g_{\mu\alpha} g_{\nu\beta} \delta g^{\alpha\beta}$, we reconcile the different sign conventions in the literature
{\small
\begin{align}
    T^{\mu\nu} = \frac{2}{\sqrt{|g|}} \frac{\delta S_\text{mat}}{\delta g_{\mu\nu}}
    = \frac{2}{\sqrt{|g|}} \frac{\delta S_\text{mat}}{\delta g^{\alpha\beta}} \frac{\delta g^{\alpha\beta}}{\delta g_{\mu\nu}}
    = - \frac{2}{\sqrt{|g|}} g^{\mu\alpha} g^{\nu\beta} \frac{\delta S_\text{mat}}{\delta g^{\alpha\beta}}
    ,\qquad
    T_{\alpha\beta} = g_{\alpha\mu} g_{\beta\nu} T^{\mu\nu}
    = -\frac{2}{\sqrt{|g|}} \frac{\delta S_\text{mat}}{\delta g^{\mu\nu}}.
\end{align}
}
In terms of the matter lagrangian 
{\small
\begin{align}
    T_{\mu\nu} = -\frac{2}{\sqrt{|g|}} \frac{\delta}{\delta g^{\mu\nu}} \left(\sqrt{|g|} \mathcal{L}_\text{mat}\right)
    = -\frac{2}{\sqrt{|g|}} \left( \sqrt{|g|} \frac{\delta \mathcal{L}_\text{mat}}{\delta g^{\mu\nu}} -\frac{1}{2}\sqrt{|g|}g_{\mu\nu}\mathcal{L}_\text{mat} \right)
    = -2 \frac{\delta \mathcal{L}_\text{mat}}{\delta g^{\mu\nu}} + g_{\mu\nu} \mathcal{L}_\text{mat}.
\end{align}
}
\smallskip

The energy-momentum tensor obey the conservation equations (\textbf{Bianchi identities})
\begin{align}
    \nabla_\mu T^{\mu\nu} = 0,\qquad \nu=0,\ldots, n-1,
\end{align}
which is a consequence of diffeomorphism invariance of the matter action.
In particular, this is not a `law of physics', but rather a `law of math'.
It is indeed an \emph{unavoidable geometric constraint} that follows from demanding the matter action be invariant under diffeomorphisms $x\mapsto \tilde{x}(x)$.

We also stress this should \emph{not} be interpreted as global conservation law, since in curved spacetimes we generally do not even have global energy and momentum definitions.
In fact $\nabla_\mu T^{\mu\nu}$ is not even a true divergence i.e. it is not of the form $\nabla_\mu V^\mu$ for some vector field $V^\mu$, so that Gauss theorem does not apply and in general we cannot define a vector whose flux through a closed surface vanishes.

Finally note that we have precisely $n$ consraints, as expected since we have $n$ DoFs for the general diffeomorphism in $n$-dimensions.
When such a diffeomorphism is a symmetry of the spacetime--i.e. generated by a Killing vector field--we can indeed identify a conserved energy or momentum component as described below.
%
\end{mytheorem}
\begin{proof}
%
Consider an infinitesimal diffeomorphism $\phi_{X,\epsilon}:M\to M$  generated by a vector field $X=X^\mu \partial_\mu$.
The matter action is a scalar i.e. diffeomorphism invariant, so that \todotag{Fix proof, variations must be wrt covariant derivatives $\nabla$}
\begin{align}
    \int_M d^nx\sqrt{|g|}\,\mathcal{L}(\psi,\partial\psi,g,x) \equiv \int_M d^n\tilde{x}_\epsilon\sqrt{|\tilde{g}_\epsilon|}\tilde{\mathcal{L}}_\epsilon 
    = \int_M \!\!\!d^nx\,\sqrt{|\phi_{X,\epsilon}^* g|}\,\,\left( \phi_{X,\epsilon}^* \mathcal{L}\right),
    \quad \forall \epsilon.
\end{align}
Taking the limit
\begin{align}
    0 = \delta S_\text{mat} &= \lim_{\epsilon\to 0} \frac{1}{\epsilon} \left( \int_M d^nx\sqrt{|\phi_{X,\epsilon}^* g|}\, \phi_{X,\epsilon}^* \mathcal{L} - \int_M d^nx\sqrt{|g|}\mathcal{L} \right)
    \\
    =& \int_M \!\!d^nx \tfrac{1}{2}\sqrt{|g|} g^{\mu\nu}\underbrace{\lim_{\epsilon\to 0}\frac{(\phi_{X,\epsilon}^*g_{\mu\nu}-g_{\mu\nu})}{\epsilon}}_{=(\mathcal{L}_Xg)_{\mu\nu}}\,\mathcal{L}
    + \int_M\!\! d^nx \sqrt{|g|} \lim_{\epsilon\to 0} \frac{\phi_{X,\epsilon}^* \mathcal{L} - \mathcal{L}}{\epsilon}.
\end{align}
For the latter observe that $\phi_{X,\epsilon}^* \mathcal{L} = \mathcal{L}(\phi_{X,\epsilon}^* \psi, \partial (\phi_{X,\epsilon}^* \psi), \phi_{X,\epsilon}^* g, x)$.
Therefore 
\begin{align}
    \lim_{\epsilon\to 0} \frac{\phi_{X,\epsilon}^* \mathcal{L} - \mathcal{L}}{\epsilon} 
    &= \frac{\delta \mathcal{L}}{\delta \psi} \lim_{\epsilon\to 0} \frac{\phi_{X,\epsilon}^* \psi - \psi}{\epsilon}
    + \frac{\delta \mathcal{L}}{\delta (\partial_\mu \psi)} \lim_{\epsilon\to 0} \frac{\partial_\mu (\phi_{X,\epsilon}^* \psi) - \partial_\mu \psi}{\epsilon}
    + \frac{\delta \mathcal{L}}{\delta g_{\mu\nu}} \lim_{\epsilon\to 0} \frac{(\phi_{X,\epsilon}^* g_{\mu\nu}-g_{\mu\nu})}{\epsilon}
    \\
    &= \frac{\delta \mathcal{L}}{\delta \psi} \mathcal{L}_X \psi + \frac{\delta \mathcal{L}}{\delta (\partial_\mu \psi)} \partial_\mu (\mathcal{L}_X \psi) + \frac{\delta \mathcal{L}}{\delta g_{\mu\nu}} (\mathcal{L}_X g)_{\mu\nu}.
\end{align}

Integrating by parts, using the symmetry of $T^{\mu\nu}$ and Gauss theorem to discard boundary terms, and using that $\psi$ solves the Euler-Lagrange equations, we finally obtain
{\small
\begin{align}
0= \delta S = & \int_M \!\!d^nx \sqrt{|g|} \left[ \tfrac{1}{2} g^{\mu\nu} \mathcal{L} + \frac{\delta \mathcal{L}}{\delta g_{\mu\nu}} \right] (\mathcal{L}_X g)_{\mu\nu}
\\
&+ \int_M \!\!d^nx \sqrt{|g|} \underbrace{\left[ \frac{\delta \mathcal{L}}{\delta \psi} - \nabla_\mu \left( \frac{\delta \mathcal{L}}{\delta (\partial_\mu \psi)} \right) \right]}_{=0 \text{ by EoM}} \mathcal{L}_X \psi + \int_M \!\!d^nx \sqrt{|g|} \graycancel{\nabla_\mu \left( \frac{\delta \mathcal{L}}{\delta (\partial_\mu \psi)} \mathcal{L}_X \psi \right)}
\\
=& \int_M \!\!d^nx \sqrt{|g|} \underbrace{\left[ \tfrac{1}{2} g^{\mu\nu} \mathcal{L} + \frac{\delta \mathcal{L}}{\delta g_{\mu\nu}} \right]}_{=\tfrac{1}{2}T^{\mu\nu}} (\nabla_\mu X_\nu + \nabla_\nu X_\mu)
= \int_M\!\! d^nx \sqrt{|g|} \nabla_{\mu}T^{\mu\nu} X_\nu 
+ \int_M \!\!d^nx \sqrt{|g|} \graycancel{\nabla_{\mu}\left(T^{\mu\nu}K_\nu\right)}
\end{align}
}
Since the vector field $X$ is arbitrary (and vanishes at the boundaries or infinity so that boundary terms vanish), we conclude that $\nabla_\mu T^{\mu\nu}=0$.
%
\end{proof}


%---------------------------------------------------------------------
{\color{red}

\begin{mytheorem}[Action for point-particles]\todotag{fix}
The action for a massive particle moving along a geodesics wordline $\lambda \mapsto x^\mu(\lambda)$ is simply given by
\begin{align}
    S_{pp}=-m\int \mathrm{d}\tau = -\int d\lambda,
\end{align}
where $\tau$ is the proper time along the worldline defined by $\mathrm{d}\tau^2 = - g_{\mu\nu} \mathrm{d}x^\mu \mathrm{d}x^\nu$ and $\lambda =\tau/m$, so that the momentum is $p^\mu = \frac{dx^\mu}{d\lambda}$.

For massless particles, we have to be more careful in writing down the action using a Lagrange multiplier to enforce the null condition.
In full generality $m\geq 0$ we write
\begin{align}
    S_{pp} = \int \mathrm{d}\lambda \frac{1}{2}\left( \frac{1}{e(\lambda)} g_{\mu\nu} \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda} - e(\lambda) m^2 \right),
\end{align}
where $e(\lambda)$ is an einbein chosen to enforce the mass-shell condition along the worldline.
Varying with respect to $e(\lambda)$ gives indeed
{\small
\begin{align}
    \delta S_{pp} = -\int \mathrm{d}\lambda \, \frac{1}{2} \left( \frac{1}{e(\lambda)^2} g_{\mu\nu} \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda} + m^2 \right) \delta e(\lambda).
\end{align}
}
Varying with respect to the trajectory $x^\mu(\lambda)$ instead gives the geodesic equation
{\small
\begin{align}
    \delta S_{pp} &= \int \mathrm{d}\lambda  \left( - \frac{\mathrm{d}}{\mathrm{d}\lambda} \left( \frac{1}{e(\lambda)} g_{\mu\nu} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda} \right) + \frac{1}{2 e(\lambda)} \partial_\mu g_{\alpha\beta} \frac{\mathrm{d}x^\alpha}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\beta}{\mathrm{d}\lambda} \right)\, \delta x^\mu(\lambda)
    \\
    &=-\int \mathrm{d}\lambda \,\frac{1}{e(\lambda)} g_{\mu\nu}\Bigg[ \frac{\mathrm{d}^2 x^\nu}{\mathrm{d}\lambda^2}  + \underbrace{g^{\nu\rho}\left(\partial_\alpha g_{\beta\rho}-\frac{1}{2} \partial_\nu g_{\alpha\beta} \right)}_{=\Gamma_{\alpha\beta}^\nu} \frac{\mathrm{d}x^\alpha}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\beta}{\mathrm{d}\lambda}-\frac{1}{e(\lambda)}\frac{de}{d\lambda}\frac{d x^\nu}{d\lambda}\Bigg]\, \delta x^\mu(\lambda),
\end{align}
}
up to a term $\propto \frac{\mathrm{d}e(\lambda)}{\mathrm{d}\lambda}$ that can be absorbed in a redefinition of the parameter $\lambda$ to keep $e$ constant along the worldline.
Namely, we have that $p^\mu \propto \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda}$ obeys the geodesic equation and this identifies $\lambda$ up to affine transformations $\lambda \mapsto a \lambda + b$.
We then choose $\lambda$ so that indeed ...
Substituting back the solution for $e(\lambda)$

yields the mass-shell constraint $g_{\mu\nu} \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda} + m^2 e(\lambda)^2 =0$.
In the massless case $m=0$ this simply enforces the null condition $g_{\mu\nu} \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda} =0$. 
\end{mytheorem}

\begin{mytheorem}[Energy-momentum tensor of point particles]\todotag{fix}
Note that we can equally well consider point particles instead of continuum distributions of matter.
For massive particles--time-like geodesics--we simply take $\lambda=\tau/m$ where $\tau$ is the proper time along the worldline  $\partial_\tau x^\mu \partial_\tau x_\mu=-1$, while for massless particles--i.e. null geodesics $\partial_\lambda x^\mu \partial_\lambda x_\mu=0$--the parameter $\lambda$ is \emph{defined} so that the geodesic equation holds.
The energy-momentum tensor of a point particle of mass $m$ moving along a worldline $x^\mu(\lambda)$ is given by
\begin{align}
    T^{\mu\nu}(x) = m \int \mathrm{d}\lambda \, \frac{1}{\sqrt{|g|}} \delta^{(n)}(x - x(\lambda)) \, \frac{\mathrm{d}x^\mu}{\mathrm{d}\lambda} \frac{\mathrm{d}x^\nu}{\mathrm{d}\lambda}.
\end{align}
\end{mytheorem}
}

%-----------------------------------------------------------



\begin{mytheorem}[Conserved quantities along Killing vector fields: point \& continuum distributions]\todotag{Finish}
Consider a particle moving along a geodesic $x^\mu(\lambda)$ with $4$-momentum $p^\mu = m\,\mathrm{d}x^\mu/\mathrm{d}\lambda$.
Note that $\lambda$ has energy-dimension $[E]^{-2}$.
For massive particles--timelike geodesics--we simply take $\lambda=\tau/m$ where $\tau$ is the proper time along the worldline  $\partial_\tau x^\mu \partial_\tau x_\mu=-1$.
For massless particles--i.e. null geodesics $\partial_\lambda x^\mu \partial_\lambda x_\mu=0$--the parameter $\lambda$ is \emph{defined} so that the geodesic equation holds, up to affine transformations $\lambda \mapsto a \lambda + b$; the rescaling $\lambda \mapsto a \lambda$ changes the momentum $p^\mu \mapsto p^\mu/a$ and is fixed demanding a specific energy normalization $E=p^\mu U_\mu$ with respect to an observer with $4$-velocity $U^\mu$.
If $K^\mu$ is a Killing vector field, the following quantity is conserved along the geodesic
\begin{align}
    Q := K_\mu \,p^\mu, \qquad \frac{\mathrm{d}Q}{\mathrm{d}\lambda} = 0.
\end{align}
For a continuum distribution of matter with stress-energy tensor $T^{\mu\nu}$, the following current is conserved
\begin{align}
    J^\mu := T^{\mu\nu} K_\nu,\qquad \nabla_\mu J^\mu = 0.
\end{align}
\end{mytheorem}
\begin{proof}
For the point like particle
{\small
\begin{align}
    \frac{\mathrm{d}}{\mathrm{d}\lambda}(K_\mu p^\mu) &= p^\nu \nabla_\nu (K_\mu p^\mu) = p^\nu (\nabla_\nu K_\mu) p^\mu + K_\mu\, p^\nu (\nabla_\nu p^\mu)
     =\tfrac{1}{2}p^\mu p^\nu \underbrace{(\nabla_\nu K_\mu + \nabla_\mu K_\nu)}_{=0} + K_\mu\, \underbrace{p^\nu \nabla_\nu p^\mu}_{=0}= 0.
\end{align}
}
For the continuum distribution
{\small
\begin{align}
    \nabla_\mu J^\mu &= \nabla_\mu (T^{\mu\nu} K_\nu) = (\nabla_\mu T^{\mu\nu}) K_\nu + T^{\mu\nu} (\nabla_\mu K_\nu) = \underbrace{(\nabla_\mu T^{\mu\nu})}_{=0} K_\nu + \tfrac{1}{2} T^{\mu\nu} \underbrace{(\nabla_\mu K_\nu + \nabla_\nu K_\mu)}_{=0} = 0.
\end{align}
}
\end{proof}





%-----------------------------------------------------------
%=======================================================
\section{Equations of motion: Einstein \& Euler--Lagrange equations}\todotag{To be written}
%=======================================================
%------------------------------------------------------------


\begin{mytheorem}[The intrinsic difficulty of QFT in curved spacetime]\todotag{To be written}
Several issues, more physical or technical, make the formulation of QFT in curved spacetime hard: the absence of a preferred vacuum state, the lack of global symmetries, the presence of horizons and singularities, the difficulty in defining particle states and observables etc.
One intrinsic difficulty can however be grasped quite immediately from Einstein equation and the simple Heinsenberg uncertainty principle.
The necessity of UV renormalization is already manifest in flat spacetime QFT.
Allowing for arbitrarily high momenta $p$ is equivalent to exploring arbitrarily small length scales $\Delta x \Delta p \sim \hbar$.
On the other hand, by Einstein equation $G_{\mu\nu} = 8\pi G T_{\mu\nu}$, energy-momentum sources curvature.
High momenta $p$ will then inevitably modify the spacetime geometry itself, which in turn affect the measure of distances $\Delta x$ (as well as momenta themselves!).
This backreaction loop between geometry and quantum fields makes the formulation of QFT in curved spacetime intrinsically difficult.
\end{mytheorem}


\begin{mytheorem}[Euler-Lagrange equations in curved spacetime for arbitrary-spin fields]
The action for a field theory in curved spacetime with a multiplet $\{\phi_a\}_a$ of fields with \emph{arbitrary spin} is 
\begin{align}
    S[\phi] =  \int_M \omega_g\,\,\mathcal{L}\,=\int \mathrm{d}^d x \sqrt{|g|} \,\,\, \mathcal{L}(\phi_a, \nabla_\mu \phi_a, g_{\mu\nu}).
\end{align}
The lagrangian density $\mathcal{L}$ is a \emph{scalar} function of the following tensor\footnote{To be precise, for half-integer spin the first two are sections of a suitable fiber bundle.}: the fields $\phi_a$, possibly with spin, their covariant derivatives $\nabla_\mu \phi_a$ and the metric $g_{\mu\nu}$.
That is, it is a total contraction of all indices, including spinorial ones.
In turn the integrand is simply the contraction of the metric volume form $\omega_g = \sqrt{|g|} d^d x$ with a scalar $\mathcal{L}$ i.e. a (0,0)-tensor, or equivalently the wedge product with of a 0-form.

Note that we could equivalently write $\mathcal{L}=\mathcal{L}(\phi_a, \partial_\mu \phi_a, g_{\mu\nu},\partial_\rho g_{\mu\nu})$, since the difference between partial and covariant derivatives is given by Christoffel symbols $\Gamma_{\mu\nu}^\rho$ that are functions of the metric and its first derivatives only.
However, the resulting expression would be unnecessarily cumbersome:\footnote{Of course, if $\phi_a$ are scalar fields then $\partial_\mu\phi_a=\nabla_\mu\phi_a$.} the lagrangian must be a scalar--i.e. a contraction of tensors--whereas partial derivatives of tensors are not even tensors, so that in order to obtain a sensible expression we would need to introduce Christoffel symbols `implictly' everywhere needed anyway.

Finally, note that derivatives of $\mathcal{L}$ with respect to $\nabla_\mu \phi$ are tensors, while derivatives with respect to $\partial_\mu \phi$ are not.
Indeed, since $\mathcal{L}$ is a scalar, if we have parametrizations $\epsilon_1 \mapsto \phi(\epsilon_1)$, $\epsilon_2 \mapsto \nabla_\mu \phi(\epsilon_2)$ and $\epsilon_3\mapsto g_{\mu\nu}(\epsilon_3)$, we have
{\small
\begin{align}
    \frac{\mathrm{d}}{\mathrm{d}\epsilon} \mathcal{L}(\phi(\epsilon), \nabla_\mu \phi(\epsilon), g_{\mu\nu}(\epsilon)) 
    = \frac{\partial \mathcal{L}}{\partial \phi} \underbrace{\frac{\mathrm{d}\phi}{\mathrm{d}\epsilon}}_{tensor}
    + \frac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)} \underbrace{\frac{\mathrm{d}(\nabla_\mu \phi)}{\mathrm{d}\epsilon}}_{tensor}
    + \frac{\partial \mathcal{L}}{\partial g_{\mu\nu}} \underbrace{\frac{\mathrm{d}g_{\mu\nu}}{\mathrm{d}\epsilon}}_{tensor}.
\end{align}
}
Since variations of tensors $\frac{d T}{d\epsilon}$ are tensors and the left-hand side is a scalar, we conclude that $\frac{\partial \mathcal{L}}{\partial \phi}$ is a tensor of the same type as $\phi$, $\frac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)}$ is a tensor with one upper index more than $\phi$ and $\frac{\partial \mathcal{L}}{\partial g_{\mu\nu}}$ is a (2,0) tensor.
On the other hand, if we considered a parametrization $\epsilon \mapsto \partial_\mu \phi(\epsilon)$ instead, the term $\frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi)} \frac{\mathrm{d}(\partial_\mu \phi)}{\mathrm{d}\epsilon}$ would still be a scalar, but we could not conclude that $\frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi)}$ is a tensor of suitable rank since $\frac{\mathrm{d}(\partial_\mu \phi)}{\mathrm{d}\epsilon}$ is not a tensor.


The equations of motion for the fields are obtained varying with respect to $\phi_a$, \todotag{Fix all derivatives $\partial\mapsto \nabla$}
{\small
\begin{align}
    \delta S &= \int_M \mathrm{d}^d x \sqrt{|g|} \left( \frac{\partial \mathcal{L}}{\partial \phi_a} \delta \phi_a + \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)} \delta (\partial_\mu \phi_a) \right)
    \\
    &= \int_M \mathrm{d}^d x \sqrt{|g|} \left[ \frac{\partial \mathcal{L}}{\partial \phi_a} - \frac{1}{\sqrt{|g|}}\, \partial_\mu \left( \sqrt{|g|} \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)} \right) \right] \delta \phi_a + \underbrace{\frac{1}{\sqrt{|g|}}\, \partial_\mu \left( \sqrt{|g|} \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)} \delta\phi_a\right)}_{\displaystyle = \nabla_\mu \left( \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)} \delta\phi_a\right)}.
\end{align}
}
The last term is a total derivative since $\text{div}_{\Omega_g}X=\nabla_\mu X^\mu\,\Omega_g$ for any vector field\footnote{Indeed the variation of $\mathcal{L}$ wrt $\partial_\mu \phi_a$ returns a vector $X^\mu:=\frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)}$. } $X$ and the metric volume form $\Omega_g=\sqrt{|g|}dx^1 \wedge \cdots \wedge dx^n$, and hence vanishes by Gauss theorem assuming the variations $\delta \phi_a$ vanish at the boundary of $M$ (or fall off sufficiently fast at infinity).
%
The Euler-Lagrange equations for the field $\phi_a$ are then
\begin{align}
    0=\frac{\partial\mathcal{L}}{\partial \phi_a}-\frac{1}{\sqrt{|g|}} \partial_\mu \left( \sqrt{|g|} \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)} \right)
    = \frac{\partial\mathcal{L}}{\partial \phi_a}-\nabla_\mu\left( \frac{\partial \mathcal{L}}{\partial (\partial_\mu \phi_a)}\right).
\end{align}
Beware the \textbf{above formulas hold for arbitrary-spin fields} $\phi_a$, including scalars, vectors, tensors and spinors, \textbf{arranged in any multiplet} $\{\phi_a\}_a$, provided the Lagrangian density $\mathcal{L}$ is a scalar, as it should.
\end{mytheorem}










\begin{mytheorem}[Lagrangian and Klein-Gordon equation for scalar fields]
The action for a real scalar field $\phi$ of mass $m$ in curved spacetime is given by
\begin{align}
    S_\text{KG} = -\frac{1}{2} \int \mathrm{d}^d x \sqrt{|g|} \left( g^{\mu\nu} \partial_\mu \phi \partial_\nu \phi + m^2 \phi^2 \right).
\end{align}
Varying this action with respect to $\phi$ yields the curved spacetime Klein-Gordon equation
\begin{align}
    (\nabla^\mu \nabla_\mu - m^2) \phi = \frac{1}{\sqrt{|g|}} \partial_\mu \left( \sqrt{|g|}\,\, g^{\mu\nu} \partial_\nu \phi \right) - m^2 \phi = 0.
\end{align}
%   
\end{mytheorem}


\begin{mytheorem}[Lagrangian and Maxwell equations for vector fields]\todotag{Finish}
%
The action for a vector field $A=A_\mu \,dx^\mu$ (electromagnetic potential) coupled to a current $J=J_\mu d x^\mu$ is given by $S=S_{\mathrm{Maxwell}}+S_{\mathrm{int}}$, where
\begin{align}
    S_{\mathrm{Maxwell}}&= -\int_M \!\!\mathrm{d}^n x \sqrt{|g|}\, \tfrac{1}{4} F_{\mu\nu} F^{\mu\nu} 
    = \int_M\!\! -\tfrac{1}{2} F \wedge \star F  = -\tfrac{1}{2}\,\langle dA, dA\rangle_{\mathrm{Hodge}},
    \\
    S_{\mathrm{int}}&= -\int_M \!\!\mathrm{d}^n x \sqrt{|g|}\, A_\mu J^\mu = \int_M -A \wedge \star J = -\langle A, J \rangle_{\mathrm{Hodge}}.
\end{align}
We defined the (abelian) field strength 2-form as\footnote{\label{fn:covariant_vs_partial_dif_forms}Note we can exchange partial with covariant derivatives since both expressions are tensorial and coincide in normal coordinates at a point i.e. where Christoffel symbols vanish, as we already discussed in general for the exterior derivative of any $p$-form.}
\begin{align}
    F:=dA, \quad \text{in a chart}\quad F_{\mu\nu} \,dx^\mu\wedge dx^\nu = \Big(\partial_\mu A_\nu - \partial_\nu A_\mu\Big)\, dx^\mu\wedge dx^\nu =\Big(\nabla_\mu A_\nu - \nabla_\nu A_\mu\Big)\, dx^\mu\wedge dx^\nu.
\end{align}
%

The current $J$ is assumed to be conserved $\nabla_\mu J^\mu=0$ in order to ensure gauge invariance of the action under $A\mapsto A + d f$ for any scalar field $f$.
%
It is typically obtained via minimal coupling $\nabla_\mu \mapsto D_\mu^A\equiv\nabla_\mu - i q A_\mu$ to charged matter fields, like a complex scalar or a spinor,
\begin{align}
    \mathcal{L}&\supset |(\nabla_\mu - i q A_\mu)\phi|^2 = \nabla^\mu\phi^\dagger \nabla_\mu \phi + \underbrace{i q (\phi^\dagger \nabla_\mu \phi - \phi \nabla_\mu \phi^\dagger)}_{=J_\mu}A^\mu + q^2 A_\mu A^\mu |\phi|^2 \quad \text{(complex scalar),}
    \\[7pt]
    \mathcal{L}&\supset \bar{\psi} i \gamma^\mu (\nabla_\mu - i q A_\mu)\psi = \bar{\psi} i \gamma^\mu \nabla_\mu \psi +  \underbrace{q\bar{\psi} \gamma^\mu \psi}_{=J^\mu} A_\mu \quad \text{(Dirac spinor).}
\end{align}

%
Varying the action wrt $A\mapsto A+\epsilon $ and integrating by parts, using the exterior co-derivative $\delta$ i.e. the adjoint of $d$ wrt the Hodge product, gives
\begin{align}
    \delta S_{\mathrm{Maxwell}} &= -\langle dA, d\epsilon \rangle_{\mathrm{Hodge}} = - \langle \delta dA, \epsilon \rangle_{\mathrm{Hodge}} = -\int_M \delta d A\wedge \star \epsilon,
    \\
    \delta S_{\mathrm{int}} &= -\langle J,\epsilon\rangle_{\mathrm{Hodge}}=\int_M - J \wedge \star \epsilon= -\int_M\!\!\mathrm{d}^n x\sqrt{|g|}\, \epsilon_\mu J^\mu.
\end{align}
The Maxwell equations in curved spacetime $\delta S_{\mathrm{Maxwell}} + \delta S_{\mathrm{int}}=0$ are then
\begin{align}
    \delta d A +J= \delta F +J= 0, \quad \text{or in a chart} \quad \nabla_\mu F^{\mu\nu} = -J^\nu.
\end{align}
%
These are \emph{not} to be confused with the Bianchi identity\footnotemark[\getrefnumber{fn:covariant_vs_partial_dif_forms}] for the field strength $F=dA$, which reads
\begin{align}
    dF=0\quad \text{or in a chart} \quad  0=\partial_{[\alpha} F_{\beta\gamma]}\equiv \nabla_{[\alpha} F_{\beta\gamma]}.
\end{align}


%
\end{mytheorem}


{\color{red}

\begin{mytheorem}[The Dirac equation in curved spacetime]\todotag{Finish}
The Dirac equation for a spin-$\tfrac{1}{2}$ field $\psi$ in curved spacetime is given by
\begin{align}
    (i \gamma^\mu \nabla_\mu - m) \psi = 0,
\end{align}
where $\gamma^\mu$ are the curved spacetime gamma matrices satisfying the Clifford algebra $\{\gamma^\mu, \gamma^\nu\} = 2 g^{\mu\nu}$ and $\nabla_\mu$ is the spinor covariant derivative.
The action for the Dirac field in curved spacetime is then simply
\begin{align}
    S_\text{Dirac} = \int \mathrm{d}^d x \sqrt{|g|} \, \bar{\psi} (i \gamma^\mu \nabla_\mu - m) \psi,
\end{align}
where $\bar{\psi} = \psi^\dagger \gamma^0$ is the Dirac adjoint.
Varying this action with respect to $\bar{\psi}$ yields the Dirac equation in curved spacetime.

We need to undesratnd how to define the gamma matrices $\gamma^\mu$ and the covariant derivative $\nabla_\mu$ acting on spinors in curved spacetime.
For this, it is easier to introduce a local orthonormal frame (vielbein) $e_a^\mu$ such that $g_{\mu\nu} = e_\mu^a e_\nu^b \eta_{ab}$, where $\eta_{ab}$ is the Minkowski metric.
The curved spacetime gamma matrices are then related to the flat spacetime gamma matrices $\gamma^a$ by
\begin{align}
    \gamma^\mu = e_a^\mu \gamma^a,
\end{align}
where the flat spacetime gamma matrices satisfy $\{\gamma^a, \gamma^b\} = 2 \eta^{ab}$.
The covariant derivative acting on spinors is defined as
\begin{align}
    \nabla_\mu \psi = \partial_\mu \psi + \frac{1}{4} \omega_{\mu}^{ab} \gamma_{ab} \psi,
\end{align}
where $\omega_{\mu}^{ab}$ is the spin connection and $\gamma_{ab} = \frac{1}{2} [\gamma_a, \gamma_b]$.
As regards $\gamma^\mu$, we introduce a local orthonormal frame (vielbein) $e_a^\mu$ such that $g_{\mu\nu} = e_\mu^a e_\nu^b \eta_{ab}$, where $\eta_{ab}$ is the Minkowski metric.
%
\end{mytheorem}
}
% !TeX root = ../QFT_main.tex
%=========================================================
%=========================================================
\chapter{Quantum Field Theory in Curved Spacetime}\label{ch:qft_in_curved_spacetime}
%========================================================
%=========================================================


\section{Initial consideration \todotag{Finish \& remove sec header}}

\begin{mytheorem}[How to formulate QFT in curved spacetime?\questiontag{Polish}]
%
QFT in curved spacetime requires a careful rethinking of our approach.
Indeed canonical quantization is performed in Hamiltonian formalism, which requires a global time coordinate to define conjugate variables and then equal-time commutation relations.
The Hamiltonian formalism is thus coordinate-dependent by definition, and \emph{would seem} doomed to fail in curved spacetime.
We should find a way to quantization that ultimately preserves covariance and yields the same physics.

To develop the intuition, note that we are used familiar expressions for the lagrangian or hamiltonian in flat spacetime because we always use inertial `rectangular' coordinates related by global Lorentz transformations.
In other coordinates e.g. polar ones, the expressions for $\mathcal{L}$ and $\mathcal{H}$ would be different (and possibly more complicated) even in flat spacetime, but the physics would be the same.
This suggests how to proceed: we should recast the lagrangian density $\sqrt{|g|}\mathcal{L}$ in a covariant form, that is \emph{formally} invariant under change of coordinates in flat spacetime, and then promote it to arbitrary spacetimes by replacing the Minkowski metric with a general one and partial derivatives with covariant ones.

Having a Lagrangian formulation valid in curved spacetime, we can then derive the Hamiltonian formulation by choosing a coordinate system and a time slicing.
Beware the expressions for $\mathcal{H}$ and the conjugate field $\pi$ do depend on this choice.
While this seems to break covariance, in facts it only hides it.
Indeed, regardless of the coordinate choice and corresponding expressions, combining the two hamilton equations for $\phi$ and its coordinate-dependent conjugate field $\pi$ gives back the covariant Euler--Lagrange equations
\begin{align}
  \begin{cases}
    \frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H}{\delta \pi(t,\mathbf{x})}, \\
    \frac{\partial \pi(t,\mathbf{x})}{\partial t} = -\frac{\delta H}{\delta \phi(t,\mathbf{x})},
  \end{cases} \quad \Leftrightarrow \quad \nabla_\mu \left(\tfrac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)}\right) - \tfrac{\partial \mathcal{L}}{\partial \phi} = 0.
\end{align}
Alternatively, we can formulate QFT directly in Lagrangian formalism via path integrals, which is manifestly covariant and does not require singling out a time coordinate.

The resulting quantum theories are completely equivalent since they have the same Dyson--Schwinger equations for correlators.
But the path integral approach is practically more powerful since it extends beyond the perturbative regime.
The two procedures are summarized in the following diagram.
\vspace{2mm}

\begin{tikzpicture}[
  font=\small,
  >=Stealth,
  block/.style={
    draw=blue!60!black,
    rounded corners=2pt,
    thick,
    fill=blue!8,
    text width=5.1cm,
    align=center,
    inner sep=5pt
  },
  lab/.style={
    font=\scriptsize,
    align=center,
    text=blue!70!black,
    fill=white,
    fill opacity=0.9,
    text opacity=1,
    inner sep=1.5pt
  },
  arr/.style={->, thick, draw=black},
  equiv/.style={<->, thick, draw=black}
]
\matrix (m) [matrix of nodes, row sep=16mm, column sep=38mm, nodes={block}] {
  |[name=srH ]| {SR, classical field theory\\Hamiltonian formalism}
    & |[name=srL ]| {SR, classical field theory\\Lagrangian formalism} \\
  |[name=grHc]| {GR, classical field theory\\Hamiltonian formalism}
    & |[name=grLc]| {GR, classical field theory\\Lagrangian formalism} \\
  |[name=grHq]| {GR, QFT\\Hamiltonian formalism\\(Canonical quantization)}
    & |[name=grLq]| {GR, QFT\\Lagrangian formalism\\(Path integral QFT)} \\
};
% Top row
\draw[equiv] (srH) -- node[lab, above]{Legendre transform} node[lab, below]{equivalence} (srL);
% Middle row
\draw[arr]  (srL) -- node[lab, right] {allow curvature\\\& make covariant} (grLc);
\draw[equiv] (grHc) -- node[lab, above]{Legendre transform} node[lab, below]{equivalence} (grLc);
% Bottom row
\draw[arr] (grHc) -- node[lab, left] {canonical\\quantization} (grHq);
\draw[arr] (grLc) -- node[lab, right] {path\\integral} (grLq);
\draw[equiv] (grHq) -- node[lab, above]{same Dyson--Schwinger eqs\\ for correlators} node[lab, below]{equivalence} (grLq);
\end{tikzpicture}
%
\end{mytheorem}


\begin{mytheorem}[Hamiltonian as generator of time translations \& different foliations\todotag{Polish \& understand better}]
%
The above analysis clarifies that for any given choice $F$ spacetime foliation $\mathcal{M}\simeq \R\times \Sigma$ with coordinates $x^\mu$, the corresponding hamiltonian $H_F=\int_\Sigma d^3\mathbf{x}\,\mathcal{H}_F$  is the generator of time translations along the chosen time coordinate $t\equiv x^0$.
Indeed the \emph{classical} hamilton equations in the chosen coordinates $(t,\mathbf{x})$ read
\begin{align}
  &\frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H_F}{\delta \pi_F(t,\mathbf{x})}, \quad
  \frac{\partial \pi_F(t,\mathbf{x})}{\partial t} = -\frac{\delta H_F}{\delta \phi(t,\mathbf{x})},\quad\text{and more generally }\quad \frac{\partial \mathcal{O}}{\partial t} = \{\mathcal{O}, H_F\}\quad \forall\,\, \text{field}\,\,\mathcal{O}.
\end{align}
Or at the quantum level, replacing $\{\,,\,\}\mapsto -\frac{i}{\hbar}[\,,\,]$ and time-evolving operators in Heisenberg picture
\begin{equation}
  \frac{\partial \hat{\mathcal{O}}}{\partial t} = -\frac{i}{\hbar} [\hat{\mathcal{O}}(t), \hat{H}_F]\quad \forall \,\,\text{field operator}\,\, \hat{\mathcal{O}}.
\end{equation}
In both classical and quantum cases, this shows that $H_F$ is the generator of the time evolution operator parametrized wrt the chosen coordinate time $t$
\begin{align}
  &U(t,t_0) = \mathcal{T}\exp\left(-\frac{i}{\hbar}\int_{t_0}^t \!\! dt' H_F(t')\right)\,.
\end{align}
A different choice $\tilde{F}$ of coordinates and foliation  $\mathcal{M}\simeq \R\times \tilde{\Sigma}$ yields a different hamiltonian $H_{\tilde{F}}$ generating time translations along the corresponding time $\tilde{t}\equiv \tilde{x}^0$.

If the two foliations are equivalent i.e. fixed-time leaves are mapped into each other by the change of coordinates, \todotag{Not sure what if $\tilde{t}=\tilde{t}(t,\mathbf{x})$ i.e. leaves not map into each other?}
\begin{align}
  \R\times \Sigma \simeq\mathcal{M}\simeq  \tilde{\R}\times \tilde{\Sigma} \quad \text{via}\quad (t,\mathbf{x}) \mapsto (\tilde{t}(t), \tilde{\mathbf{x}}(t,\mathbf{x})),
\end{align}
the Hilbert spaces $\mathcal{H}=\bigotimes_n L^2(\Sigma,\C)^{\otimes^n}$ of the two quantum theories are isomorphic (resp. the fixed-time function spaces $\mathcal{C}(\Sigma_t,\R)$ in the classical case) and so must be the time evolution of their states and operators, provided we evolve across corresponding time intervals $[t_1,t_2]$ and $[\tilde{t}_1,\tilde{t}_2]$ with $\tilde{t}_j:=\tilde{t}(t_j)$.
If $\chi_t: \mathcal{H}_F \to \mathcal{H}_{\tilde{F}}$ is the isomorphism between the two Hilbert spaces (resp. classical spaces) induced by the coordinate change $\mathbf{x}\mapsto \tilde{\mathbf{x}}(t,\mathbf{x})$ at time $t$, the corresponding time evolutions obey
{\small
\begin{equation}
  \chi_{t_2} \circ U_F(t_2,t_1)\circ \chi_{t_1}^{-1} 
  = \chi_{t_2} \circ \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{t_1}^{t_2} dt' H_F(t')\right)\circ \chi_{t_1}^{-1}
  = \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{\tilde{t}(t_1)}^{\tilde{t}(t_2)} d\tilde{t}' H_{\tilde{F}}(\tilde{t}')\right)
  = U_{\tilde{F}}(\tilde{t}_2,\tilde{t}_1)\,.
\end{equation}
}
If the coordinate change does not mix time and space $(t,\mathbf{x})\mapsto (\tilde{t}(t),\tilde{\mathbf{x}}(\mathbf{x}))$, the isomorphism bewteen Hilberts (resp. classical) spaces $\chi_t\equiv \chi$ is time-independent, and we can take it to be the identity upon changing space coordinates in one frame yielding the same leaves $\Sigma_t=\tilde{\Sigma}_{\tilde{t}(t)}$ at all times.
The two hamiltonians and time evolutions then act on the \emph{same} Hilbert space, and we simply have a time change relation
{\small
\begin{align}
  H_F(t) = \tfrac{d\tilde{t}}{dt} H_{\tilde{F}}(\tilde{t}(t)), \quad
  U_F(t_2,t_1) = \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{t_1}^{t_2} dt' H_F(t')\right)
  = \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{\tilde{t}(t_1)}^{\tilde{t}(t_2)} d\tilde{t}' H_{\tilde{F}}(\tilde{t}')\right)
  = U_{\tilde{F}}(\tilde{t}_2,\tilde{t}_1).
\end{align}
}

Finally, the above analysis allow for a temporary period where two foliations $F$ and $\tilde{F}$ are inequivalent, e.g. during a gravitational collapse or other highly dynamical spacetime process, as long as spacetime is asymptotically stationary in the past and future.
That is the coordinate change $(t,\mathbf{x})\mapsto \tilde{t}=\tilde{t}(t,\mathbf{x})$ does not map leaves of the foliations into each other for some time interval $[t_i,t_f]$, but does so asymptotically for $t\to \pm\infty$.
In this case, we can relate the two Hilbert (resp. classical) spaces and corresponding time evolutions via the isomorshisms $\chi_t$ as above only in the asymptotic regions $t<t_i$ and $t>t_f$, and define $S$-matrix like operators mapping states (resp. classical configurations) from one foliation to the other across the dynamical period.
\end{mytheorem}


To fix ideas we consider below the case of quintessence scalar field, but the analysis extends to any field theory in curved spacetime.

\begin{mytheorem}[Hamiltonian formulation of scalar field in curved spacetime\todotag{Finish}]
%
Consider the action for a scalar field in curved spacetime and choose a foliation $\mathcal{M}\R\times\Sigma$
\begin{align}
    S[\phi] = \int d^4x\, \sqrt{|g|} \left( \frac{1}{2} g^{\mu\nu} \nabla_\mu \phi \nabla_\nu \phi - V(\phi) \right) = \int dt \underbrace{\int_\Sigma d^3\mathbf{x}\, \sqrt{|g|} \left( \frac{1}{2} g^{\mu\nu} \nabla_\mu \phi \nabla_\nu \phi - V(\phi) \right)}_{L(t)}.
\end{align}
The conjugate field in such coordinates is
{
\begin{align}
    \pi(t,\mathbf{x}) = \frac{\delta L(t)}{\delta \dot{\phi}(t,\mathbf{x})} = \sqrt{|g|} g^{0\nu} \nabla_\nu \phi(t,\mathbf{x}) = \sqrt{|g|} \left( g^{00} \,\nabla_0\phi(t,\mathbf{x}) + g^{0j} \,\nabla_{\!j} \phi(t,\mathbf{x}) \right) \quad \Rightarrow \quad \nabla_0 \phi(t,\mathbf{x}) = \frac{1}{\sqrt{|g|} g^{00}} \left( \pi(t,\mathbf{x}) - \sqrt{|g|} g^{0j} \nabla_{\!j} \phi(t,\mathbf{x}) \right).
\end{align}
}
The hamiltonian density is thus
\begin{align}
    \mathcal{H}(t,\mathbf{x}) &= \pi(t,\mathbf{x}) \nabla_0 \phi(t,\mathbf{x}) - \sqrt{|g|} \left( \frac{1}{2} g^{\mu\nu} \nabla_\mu \phi(t,\mathbf{x}) \nabla_\nu \phi(t,\mathbf{x}) - V(\phi(t,\mathbf{x})) \right) \\
    &= \frac{\pi^2(t,\mathbf{x})}{2\sqrt{|g|} g^{00}} - \frac{g^{0j}}{g^{00}} \pi(t,\mathbf{x}) \nabla_{\!j} \phi(t,\mathbf{x}) + \sqrt{|g|} \left( \frac{1}{2} h^{ij} \nabla_{\!i} \phi(t,\mathbf{x}) \nabla_{\!j} \phi(t,\mathbf{x}) + V(\phi(t,\mathbf{x})) \right),
\end{align}
where $h^{ij} = g^{ij} - \frac{g^{0i} g^{0j}}{g^{00}}$ is the inverse induced metric on the spatial slices $\Sigma_t$.
The hamiltonian is $H(t) = \int_\Sigma d^3\mathbf{x}\, \mathcal{H}(t,\mathbf{x})$.
The classical hamilton equations are
\begin{align}
    &\frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H(t)}{\delta \pi(t,\mathbf{x})} = \frac{\pi(t,\mathbf{x})}{\sqrt{|g|} g^{00}} - \frac{g^{0j}}{g^{00}} \nabla_{\!j} \phi(t,\mathbf{x}), \\
    &\frac{\partial \pi(t,\mathbf{x})}{\partial t} = -\frac{\delta H(t)}{\delta \phi(t,\mathbf{x})} = \nabla_{\!j} \left( \sqrt{|g|} h^{ij} \nabla_{\!i} \phi(t,\mathbf{x}) \right) - \sqrt{|g|} V'(\phi(t,\mathbf{x})).
\end{align}
Combining them gives back the covariant Euler--Lagrange equations
\begin{align}
    \nabla_\mu \left( \frac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)} \right) - \frac{\partial \mathcal{L}}{\partial \phi} = 0.
\end{align}
%
\end{mytheorem}


\begin{mytheorem}[Canonical quantization of scalar field in curved spacetime\todotag{Finish}]
%
We now proceed to canonical quantization following Heinsenberg procedure.
We promote the classical fields $\phi(t,\mathbf{x})$ and $\pi(t,\mathbf{x})$ to \emph{self-adjoint} operators $\hat{\phi}(t,\mathbf{x})$ and $\hat{\pi}(t,\mathbf{x})$ acting on a Hilbert space $\mathcal{H}$ and the equations are left unchanged upon replacing Poisson brackets with commutators $\{\,,\,\}\mapsto -\frac{i}{\hbar}[\,,\,]$.
In particular EoM for the fields and equal-time CCR read
\begin{align}
    &\frac{\partial \hat{\phi}(t,\mathbf{x})}{\partial t} = \frac{1}{i\hbar} [\hat{\phi}(t,\mathbf{x}), \hat{H}(t)] = \frac{\hat{\pi}(t,\mathbf{x})}{\sqrt{|g|} g^{00}} - \frac{g^{0j}}{g^{00}} \nabla_{\!j} \hat{\phi}(t,\mathbf{x}), \\
    &\frac{\partial \hat{\pi}(t,\mathbf{x})}{\partial t} = \frac{1}{i\hbar} [\hat{\pi}(t,\mathbf{x}), \hat{H}(t)] = \nabla_{\!j} \left( \sqrt{|g|} h^{ij} \nabla_{\!i} \hat{\phi}(t,\mathbf{x}) \right) - \sqrt{|g|} V'(\hat{\phi}(t,\mathbf{x})), \\
    &[\hat{\phi}(t,\mathbf{x}), \hat{\phi}(t,\mathbf{y})] = 0, \quad [\hat{\pi}(t,\mathbf{x}), \hat{\pi}(t,\mathbf{y})] = 0, \quad [\hat{\phi}(t,\mathbf{x}), \hat{\pi}(t,\mathbf{y})] = i\hbar\, \delta^{(3)}(\mathbf{x}-\mathbf{y}).
\end{align}
We now want to solve this theory.
The strategy is to mimick the flat spacetime approach and expand the field operator in terms of mode solutions to the Klein--Gordon equation in curved spacetime...
  
\end{mytheorem}





%--------------------------------------------------------
%=========================================================
\section{Green functions}
%=========================================================
%------------------------------------------------------------


\begin{mytheorem}[Dyson--Schwinger equations for correlators in curved spacetime\todotag{polish}]
%
A quantum theory is completely specified by its correlators\footnote{In fact, it is even sufficient to only know time-ordered ones.} (expectation values of products of time-evolved field operators).
Correlators are uniquely determined by the Dyson--Schwinger equations, which are an infinite set of coupled differential equations relating all $n$-point functions to each other for all $n\in\mathbb{N}$.
If two theories have all the same Dyson--Schwinger equations for correlators, they are thus completely equivalent.
In particular this proves the equivalence between canonical quantization and path integral quantization in curved spacetime, at least as long as the former approach is applicable.
\end{mytheorem}
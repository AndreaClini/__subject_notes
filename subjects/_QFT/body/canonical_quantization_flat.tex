% !TeX root = ../QFT_main.tex
%=========================================================
%=========================================================
\chapter{Canonical Quantization in Flat Spacetime}
%========================================================
%=========================================================



%--------------------------------------------------------
%=========================================================
\section{Classical \& Quantum Harmonic Oscillators}\label{sec:harmonic_oscillators}
%=========================================================
%------------------------------------------------------------

This section fixes the notation and reviews the theory of finite dimensional classical and quantum harmonic oscillators, which are the building blocks of Quantum Field Theories.

\begin{mytheorem}[Review of classical \& quantum harmonic oscillator\questiontag{Check}]
%
The \emph{classical} harmonic oscillator with mass $m$ and frequency $\omega$ is described by the Hamiltonian
\begin{equation}
    H = \tfrac{1}{2m}p^2 + \tfrac{m\omega^2}{2} q^2, \quad \{q, p\} = \delta_{ij}\,,
\end{equation}
where $q$ and $p$ are the canconical conjugate variables, obeying the Poisson brackets.
%
Rewrite the conjugate variables in terms of adimensional ones to match the two prefactors as
\begin{align}
    \tilde{q}=\ell q, \quad \tilde{p}= \frac{\hbar}{\ell} p, \quad \{\tilde{q}, \tilde{p}\} = \hbar \delta_{ij},
     \quad \text{for}\quad \ell= \sqrt{\tfrac{\hbar}{m\omega}}.
\end{align}
The Hamiltonian becomes
\begin{align}
    H &= \hbar \omega \tfrac{1}{2}\left( {\tilde{p}}^2 + {\tilde{q}}^2 \right)
    \\
    &\overset{!}{=}\hbar \omega \left[
        \tfrac{1}{\sqrt{2}}\left( \tilde{p} - i \tilde{q} \right)
        \cdot \tfrac{1}{\sqrt{2}}\left( \tilde{p} + i \tilde{q} \right)
    \right],
\end{align}
where in the second passage we used that $\tilde{p}$ and $\tilde{q}$ commute in the \emph{classical} theory.
%
Following Heisenberg canonical quantization procedure, promote the classical theory to a quantum one as follows.
\begin{itemize}
    \item Promote the canonical variables to operators acting on a Hilbert space $\mathcal{F}$.
    %
    \item Poisson brackets are replaced by commutators according to the rule $\displaystyle \{A, B\} \mapsto \frac{1}{i\hbar} [\hat{A}, \hat{B}]$.
    %
    \item The equations of motion are left formally unchanged, but now refer to evolving operators.
\end{itemize}
%
The Hamiltonian operator is given by
\begin{equation}
    \hat{H} = \tfrac{1}{2m}{p}^2 + \tfrac{m\omega^2}{2} {q}^2= \tfrac{1}{2}\hbar \omega \left( {\tilde{p}}^2 + {\tilde{q}}^2 \right).
\end{equation}
The Poisson brackets turn into the canonical commutation relations
\begin{align}
    [q,p]=i\hbar \delta_{ij} ,
    \qquad
    [\tilde{q}, \tilde{p}] = i \delta_{ij}.
\end{align}
We cannot use the previous factorization since now $\tilde{p}$ and $\tilde{q}$ do not commute anymore.
We have instead
\begin{align}
    \hat{H} &=     
    \hbar \omega \bigg[
        \underbrace{\tfrac{1}{\sqrt{2}}\left( \tilde{p} - i \tilde{q} \right)}_{a}
        \cdot
        \underbrace{\tfrac{1}{\sqrt{2}}\left( \tilde{p} + i \tilde{q} \right)}_{a^{\dagger}}
        + \underbrace{\tfrac{1}{2}[\tilde{p}, i\tilde{q}]}_{=\frac{1}{2} i \hbar}
    \Big] = \tfrac{1}{2}\hbar\omega \left(a^\dagger a+ a a^\dagger\right)
    = \hbar \omega \left( a^{\dagger} a + \tfrac{1}{2} \right),
\end{align}
for the creation and annihilation operators
{
\begin{align}\label{eq:ordinary_QM_harmonic_oscillator}
    a^\dagger &= \tfrac{1}{\sqrt{2}}\left( \tilde{p} - i \tilde{q} \right) = \tfrac{1}{\sqrt{2\hbar}} \left(\sqrt{m\omega} \,q - \tfrac{i}{\sqrt{m\omega}} p \right), \,\,
    a = \tfrac{1}{\sqrt{2}}\left( \tilde{p} + i \tilde{q} \right) = \tfrac{1}{\sqrt{2\hbar}} \left( \sqrt{m\omega}\, q + \tfrac{i}{\sqrt{m\omega}} p \right),\,\, [a, a^\dagger] = 1.
\end{align}
}
%
The energy eigenvalues of the quantum harmonic oscillator are
\begin{equation}
    E_n = \hbar \omega \left( n + \tfrac{1}{2} \right), \quad n = 0, 1, 2, \ldots
\end{equation}
%
In the familiar position representation  we have
\begin{align}
    q &= x, \quad p = -i \hbar \partial_x, \qquad 
    \tilde{q}=\xi := \frac{x}{\ell}=\sqrt{\tfrac{m\omega}{\hbar}} x, \quad \tilde{p} = -i \frac{d}{d\xi},\\
    a^\dagger &= \tfrac{1}{\sqrt{2}}\left(\xi-\partial_\xi\right) = \tfrac{1}{\sqrt{2}}\left(\sqrt{\tfrac{m\omega}{\hbar}} x - \sqrt{\tfrac{\hbar}{m\omega}} \partial_x\right), \quad
    \quad a = \tfrac{1}{\sqrt{2}}\left(\xi+\partial_\xi\right)= \tfrac{1}{\sqrt{2}}\left(\sqrt{\tfrac{m\omega}{\hbar}} x + \sqrt{\tfrac{\hbar}{m\omega}} \partial_x\right).
\end{align}

We remark that we could have equivalently started the quantization procedure directly from the last expression of the \emph{classical} Hamiltonian
\begin{align}
    H&\overset{!}{=}\hbar \omega \left[\tfrac{1}{\sqrt{2}}\left( \tilde{p} - i \tilde{q} \right)
        \cdot \tfrac{1}{\sqrt{2}}\left( \tilde{p} + i \tilde{q} \right)\right] = \hbar \omega \left( a^\dagger a \right).
\end{align}
This corresponds to normal-ordering of the previous \emph{quantum} Hamiltonian, removing the zero-point energy $\hbar \omega/2$.
As long as gravity is ignored, constant energy shifts do not affect the dynamics of the system, and we can safely normal-order the Hamiltonian.
In general relativity, all forms of energy will instead source the energy-momentum tensors and thus the gravitational field, and we cannot simply ignore the zero-point energy anymore.

It is fundamental to understand how the \emph{fixed} frequency $\omega$ of the oscillator determines the likelyhood of finding the system at a given elongation from equilibrium i.e. the amplitude of oscillation.
Indeed, all wave functions are proportional to a Gaussian factor, multiplied by suitable Hermite polynomials and normalization constants
\begin{align}
    \psi_n(q) = C_n\,H_n(\xi)\, e^{-\tfrac{\xi^2}{2}} = C_n \,\, H_n\Big(\sqrt{\tfrac{m\omega}{\hbar}} q\Big) \,\, e^{-\frac{m \omega}{2 \hbar} q^2}
     \,\propto\, e^{-\frac{m \omega}{2 \hbar} q^2}.
\end{align}
Crucially, the smaller is the frequency $\omega$, the wider is the Gaussian and in turn the higher the probability of finding the oscillator at large elongations from equilibrium i.e. of observing large amplitudes of oscillation.
This is already familiar from Electrodynamics: it is very unlikely to find high-frequency electromagnetic waves with large amplitudes, whereas low-frequency waves are easily found with large amplitudes.
%
\end{mytheorem}



\begin{mytheorem}[Identifying ladder operators\todotag{check}]
%
Ladder operators are a convenient way deal with harmonic oscillators: they diagonalize the Hamiltonian and yield a single \emph{complex} DoF tracking both canonical variables $q$ and $p$. 
The definition of ladder operators can be obtained by direct inspection of the Hamiltonian after rescaling the canonical variables to adimensional ones as done above.
However, this procedure somewhat hides the arbitrariness in their definition, which is source of profound physical consequences for QFT in curved spacetime.

Let us proceed more generally, simply defining a complex operator $\hat{a}$ tracking both canonical variables as a linear combination for arbitrary constants $\alpha,\beta\in\R$
\begin{align}
    a = \alpha\, q + i \,\beta \,p \quad \text{for arbitrary }\, \alpha,\, \beta \in \mathbb{R}
    \quad \Longleftrightarrow \quad \begin{cases}
        q = \frac{1}{2\alpha}(a + a^\dagger)\,,\\[4pt]
        p = \frac{-i}{2\beta}(a - a^\dagger)\,{\color{gray}= -i\,\alpha\hbar\,(a-a^\dagger).}
    \end{cases}
\end{align}
We first choose $\beta=\beta(\alpha)$ to enforce convenient CCR for $a$ and $a^\dagger$, and then fix $\alpha$ to make (somebody's) Hamiltonian as simple as possible.
Namely we choose
\begin{align}
    [a, a^\dagger] &= [\alpha q + i \beta p, \alpha q - i \beta p] = 2 \alpha \beta \hbar \quad \Rightarrow\quad \beta = \frac{1}{2\alpha \hbar}\,.
\end{align}
The original Hamiltonian can then be expressed as
\begin{align}
    H&= \frac{1}{2m}p^2+\frac{m\omega^2}{2}q^2 +Jq + Kp\\
    &= -\frac{\alpha^2\hbar^2}{2m}\,(a-a^\dagger)^2
    \;+\;\frac{m\omega^2}{8\alpha^2}\,(a+a^\dagger)^2
    \;+\;\frac{J}{2\alpha}(a+a^\dagger)
    \;-\; iK\alpha\hbar\,(a-a^\dagger)
    \\
    &=\left(\frac{m\omega^2}{8\alpha^2}-\frac{\alpha^2\hbar^2}{2m}\right)\,(a^2+a^{\dagger 2})
    +\left(\frac{m\omega^2}{8\alpha^2}+\frac{\alpha^2\hbar^2}{2m}\right)\,\underbrace{(a^\dagger a+a a^\dagger)}_{=2a^\dagger a +1}
    +\frac{J}{2\alpha}(a+a^\dagger)
    - iK\alpha\hbar\,(a-a^\dagger).  
\end{align}
The expression dramatically simplifies upon choosing
\begin{align}
    \alpha = \sqrt{\frac{m\omega}{2\hbar}} \quad \Longrightarrow \quad \beta = \frac{1}{\sqrt{2 m \omega \hbar}}\,.
\end{align}
The final expressions are
\begin{align}
    a &= \frac{1}{\sqrt{2}}\left(\sqrt{\frac{m\omega}{\hbar}}\, q + i \frac{1}{\sqrt{m \omega \hbar}}\, p\right), \quad [a, a^\dagger] = 1,\\
    H &= \hbar \omega \left(a^\dagger a + \tfrac{1}{2}\right) + \sqrt{\frac{\hbar}{2 m \omega}} J (a + a^\dagger) - i \sqrt{\frac{m \omega \hbar}{2}} K (a - a^\dagger).
\end{align}
If $J$ and $K$ are independent of the canonical variables, this form yields convenient equations of motion for $a$ (we might also further shift $a$ to absorb the linear terms).
On the other hand, if $J$ or $K$ do depend on $q,\,p$, this suggests it might be more convenient to define ladder operators in some other way!

In case $J,\,K$ are indepndent of the canonical variables, the equations of motion for $a$ read
\begin{align}
    &i\hbar\,\partial_t a= [a, H] = \hbar \omega a + \sqrt{\frac{\hbar}{2 m \omega}} J + i \sqrt{\frac{m \omega \hbar}{2}} K\\
    &\Longrightarrow \quad a(t) = a(t_0) e^{-i\omega (t-t_0)} - \frac{i}{\hbar} \int_{t_0}^t dt' \left(\sqrt{\tfrac{\hbar}{2 m \omega}} J(t') + i \sqrt{\tfrac{m \omega \hbar}{2}} K(t')\right) e^{-i\omega (t-t')}.
\end{align}
For example, if $J$ and $K$ are nonzero only within a finite time interval $[t_i, t_f]$, we have
\begin{align}
    a(t) &= \begin{cases}
        a(t_0) e^{-i\omega (t-t_0)}=: a_{\mathrm{in}}e^{-i\omega (t-t_0)}, & t < t_i\,\\[6pt]
        a(t_i) e^{-i\omega (t-t_i)} - \frac{i}{\hbar} \int_{t_i}^t dt' \left(\sqrt{\tfrac{\hbar}{2 m \omega}} J(t') + i \sqrt{\tfrac{m \omega \hbar}{2}} K(t')\right) e^{-i\omega (t-t')}, & t_i \leq t \leq t_f,\\[6pt]
        a(t_f) e^{-i\omega (t-t_f)}=: a_{\mathrm{out}} e^{-i\omega (t-t_f)}, & t > t_f.
    \end{cases}
\end{align}
\end{mytheorem}



\begin{mytheorem}[Rotated harmonic oscillator\questiontag{Check}]
%
Consider an isotropic\footnote{\label{fn:isotropic_oscillator}for simplicity, otherwise diagonalize the frequency matrix} harmonic oscillator in dimension $n$
\begin{align}
    H = \frac{1}{2m} \sum_{j=1}^n (p^j)^2 + \frac{m\omega^2}{2} \sum_{j=1}^n (q^j)^2, \quad \{q, p^T\} = \delta_{ij}.
\end{align}
We can rotate cohordinates with an orthogonal matrix $R \in O(n)$ as   
\begin{align}
     \tilde{q}^i = R^i_{j} q_j, \quad \tilde{p}^i = R^i_{j} p_j, \quad 
     \{\tilde{q}, \tilde{p}^T\} = R\{q,p^T\} R^T = R\,R^T = \delta_{ij}\,.
\end{align}
Passing to the quanum case, everythin is unchanged upond replacing $\{\,,\,\}\mapsto \frac{1}{i\hbar} [\,,\,]$.
In position space representation we have
{\small
\begin{align}
    \tilde{q}^i &= \tilde{x}^i = R^i_{j} x^j, \quad \tilde{p}^i = -i\hbar \frac{\partial}{\partial \tilde{x}^i} = -i\hbar \frac{\partial x^j}{\partial \tilde{x}^i}\frac{\partial}{\partial x^j}
    = -i\hbar \big(R^{-1})^j_i  \frac{\partial}{\partial x^j} = - i\hbar \big(R^T)^j_i \frac{\partial}{\partial x^j} = R^i_{j}\,\Big(-i\hbar \frac{\partial}{\partial x^j} \Big) = R^i_{j}\, p^j\,.
\end{align}
}
Correspondingly the ladder operators just change the same as
\begin{align}
    \tilde{a}^j = \frac{1}{\sqrt{2}}\Big(\sqrt{m\omega}\tilde{q}^j+\frac{i}{\sqrt{m\omega}}\tilde{p}^j\Big)
    = R^j_k\,\Big(\sqrt{m\omega}{q}^k+\frac{i}{\sqrt{m\omega}}{p}^k\Big) = R^j_k\, a^k\,.
\end{align}
\end{mytheorem}



\begin{mytheorem}[Complex \& rotated harmonic oscillators\questiontag{Check}]
%
Consider a 2D real isotropic\footnotemark[\getrefnumber{fn:isotropic_oscillator}] harmonic oscillator with Hamiltonian
\begin{equation}
    H = \tfrac{1}{2m}(p_x^2 + p_y^2) + \tfrac{m\omega^2}{2} (q_x^2 + q_y^2), \quad \{q_x, p_x\} = \{q_y, p_y\} = 1.
\end{equation}
%
It is customary to rewrite it as a single complex harmonic oscillator by defining the complex canonical variables in 4 possible ways\footnote{\label{fn:order_sign_CCR_conjugate} the order of $\pm$ and $\mp$ signs correspond to not taking (resp. taking) the conjugate in the CCR} as
\begin{align}
    q_z = \frac{1}{\sqrt{2}}(q_x + i q_y), \quad p_z = \frac{1}{\sqrt{2}}(p_x \mp i p_y), \quad \{q_z, p_z^{(\dagger)}\} = 1\,. \label{eq:complex_oscillator_pure_decomposition}
    \\[4pt]
    q_z = \frac{1}{\sqrt{2}}(q_x + \tfrac{i}{{m\omega}}\, p_y), \quad p_z = \frac{1}{\sqrt{2}}(p_x \pm i {m\omega}\,q_y), \quad \{q_z, p_z^{(\dagger)}\} = 1\,. \label{eq:complex_oscillator_mixed_decomposition}
\end{align}
All choices lead to the same Hamiltonian in terms of complex variables
\begin{align}\label{eq:complex_harmonic_oscillator}
    H = \tfrac{1}{m} p_z p_z^{\dagger} + m \omega^2 q_z q_z^{\dagger}\,\quad \text{with}\quad \{q_z, p_z^{(\dagger)}\} = 1\,.
\end{align}
In practice one often starts from a complex harmonic oscillator obeying the CCR with/out conjugation, and then identify corresponding real variables\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}] either expressing complex position (resp. momentum) as combination of real positions (resp. momenta) as
\begin{align}
    &q_x=\frac{q_z+q_z^\dagger}{\sqrt{2}},\quad p_x =\frac{p_z+p_z^\dagger}{\sqrt{2}},\quad
    q_y=-i\frac{q_z - q_z^\dagger}{\sqrt{2}},\quad p_y =\pm i \frac{p_z - p_z^\dagger}{\sqrt{2}}.
\end{align}
or making both complex variables $q_z,p_z$ a mixture of real positions and momenta as\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}]
\begin{align}
    &q_x=\frac{q_z+q_z^\dagger}{\sqrt{2}},\quad p_x =\frac{p_z+p_z^\dagger}{\sqrt{2}},\quad
    q_y=\frac{\mp i}{\sqrt{2}}\frac{(p_z-p_z^\dagger)}{m\omega},\quad p_y =\frac{-im\omega}{\sqrt{2}} (q_z - q_z^\dagger).
\end{align}
%

We now consider a \emph{complex} position representation.
Namely, we would like to identify\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}] $q_z\sim z$ and $p_z \sim \mp i\hbar \partial_z^{(*)}$.
Recall that in \emph{any} case derivatives transform as
\begin{align}
    \partial_z = \frac{1}{\sqrt{2}}\left(\partial_x - i \partial_y\right),\quad
    \partial_{z^*} = \frac{1}{\sqrt{2}}\left(\partial_x + i \partial_y\right),
\end{align}
In the pure position/momentum case, we use the position representation for both the $x$ and $y$ variables to get\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}]
\begin{align}
    \hat{q}_z &= \frac{\hat{q}_x + i \hat{q}_y}{\sqrt{2}}=\frac{1}{\sqrt{2}}(x + i y) = z, \\
    \hat{p}_z &= \frac{1}{\sqrt{2}}(\hat{p}_x \mp i \hat{p}_y) = \frac{-i\hbar}{\sqrt{2}}\left(\partial_x \mp i \partial_y\right) = -i\hbar \frac{\partial}{\partial z^{(*)}}\,.
\end{align}
In the mixed case it is instead convenient to use the position representation for $x$ and the momentum representation for $y$, yielding\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}]
\begin{align}
    \hat{q}_z &= z = \frac{1}{\sqrt{2}}\left(\hat{q}_x + \tfrac{i}{m\omega} \hat{p}_y\right) = \frac{1}{\sqrt{2}}\left(x + iy\right) =z\,, \\
    \hat{p}_z & = \frac{1}{\sqrt{2}}\left(\hat{p}_x \pm i m \omega \hat{q}_y\right) = \frac{1}{\sqrt{2}}\left(-i\hbar \partial_x \mp i (-i\hbar)\partial_y\right) = -i\hbar \frac{1}{\sqrt{2}}(\partial_x \mp i \partial_y) = -i\hbar \frac{\partial}{\partial z^{(*)}}\,.
\end{align}
Crucially, note that as an operator $\big(i\partial_z)^\dagger = i \partial_{z^*}$ since the adjoint flips the sign of derivatives $\partial_{x,y}^\dagger = -\partial_{x,y}$ wrt real variables, so that indeed the CCR are obeyeed in the forms prescribed.

We can also consider the Hamiltonian for more complex variables
\begin{align}
    H = \tfrac{1}{m} p_z^{j\,\dagger}\, p_z^j+ m \omega^2 q_z^{j\,\dagger}\,q_z^j\,,\quad \{q^i_z, p_z^{j\, (\dagger)}\} = \delta^i_j\,.
\end{align}
Depending on \emph{not} taking or taking the conjugate in the CCR, an orthogonal $U \in O(n)$ resp. unitary transformation $U \in U(n)$ acting on the complex DoFs leave the CCR invariant
\begin{align}
     \tilde{q}^i_z = U^i_{j} q_z^j, \quad \tilde{p}^i_z = U^i_{j} p_z^j, \quad 
     \{\tilde{q}^i_z, \tilde{p}_z^{j\,(\dagger)}\} = U^i_k \{q_z^k, p_z^{l\,(\dagger)}\} U^{j\,(*)}_l
     = U^i_k \delta^k_l U^{j\,(*)}_l = U^i_k \big(U^{T (*)}\big)^k_j = \delta^i_j\,.
\end{align}
However, in the former case the Hamiltonian is invariant only provided $U$ is also \emph{real} since
\begin{align}
    H &= \tfrac{1}{m} \tilde{p}_z^{j\,\dagger}\, \tilde{p}_z^j+ m \omega^2 \tilde{q}_z^{j\,\dagger}\,\tilde{q}_z^j
    = \tfrac{1}{m} (U^{j\,(*)}_l p_z^{l\,\dagger}) (U^j_k p_z^k) + m \omega^2 (U^{j\,(*)}_l q_z^{l\,\dagger}) (U^j_k q_z^k) \\
    &= \tfrac{1}{m} p_z^{l\,\dagger} \big(U^{T (*)} U\big)^l_k p_z^k + m \omega^2 q_z^{l\,\dagger} \big(U^{T (*)} U\big)^l_k q_z^k
    \overset{!}{=} \tfrac{1}{m} p_z^{l\,\dagger} \delta^l_k p_z^k + m \omega^2 q_z^{l\,\dagger} \delta^l_k q_z^k\,.
\end{align}
Complex harmonic oscillators with CCR implemented with conjugation thus have a larger symmetry group $U(n)$ than those with CCR implemented without conjugation, which only have $O(n)$ symmetry.

The advantage of the mixed decomposition \eqref{eq:complex_oscillator_mixed_decomposition} is that it yields a nicer decomposition of the complex variables $q_z,\,p_z$ in terms of ladder operators of real oscillators \emph{rotated} by $\pi/4$ in phase space.
Define ladder operators for each real DoF $x,y$ as usual
\begin{align}
    &a_{x,y}= \frac{1}{\sqrt{2}}\left(\sqrt{m\omega} q_{x,y} + \frac{i}{\sqrt{m\omega}} p_{x,y}\right),  \quad [a_{x,y}, a_{x,y}^\dagger] = \delta_{xy}\,\\
    &  q_{x,y}= \frac{1}{\sqrt{2 m \omega}} (a_{x,y} + a_{x,y}^\dagger), \quad p_{x,y} = -i \sqrt{\frac{m \omega}{2}} (a_{x,y} - a_{x,y}^\dagger).
\end{align}
Define $\tfrac{\pi}{4}$-rotated oscillators and corresponding ladder operators as
\begin{align}
    q_\pm &= \frac{1}{\sqrt{2}}(q_x \pm q_y), \quad p_\pm = \frac{1}{\sqrt{2}}(p_x \pm p_y),\quad a_+ = \frac{1}{\sqrt{2}}(a_x \pm a_y).
\end{align}
In the pure case \eqref{eq:complex_oscillator_pure_decomposition} we have\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}]
\begin{align}
    q_z &= \frac{1}{\sqrt{2}}(q_x + i q_y) = \frac{1}{2\sqrt{m\omega}}\left[(a_x + a_x^\dagger) + i (a_y + a_y^\dagger)\right]\\
    &=  \frac{1}{\sqrt{2}}\left(\frac{q_+ + q_-}{\sqrt{2}} + i \frac{q_+ - q_-}{\sqrt{2}}\right) = \frac{1}{2\sqrt{m\omega}}\left[\tfrac{1+i}{\sqrt{2}}(a_++a_+^\dagger)+ \tfrac{1-i}{\sqrt{2}}(a_-+a_-^\dagger)\right],\\
    \\
    p_z &= \frac{1}{\sqrt{2}}(p_x \mp i p_y) = \frac{-i\sqrt{m\omega}}{2}\left[(a_x - a_x^\dagger) \mp i (a_y - a_y^\dagger)\right]
    \\
    &= \frac{1}{\sqrt{2}}\left(\frac{p_+ + p_-}{\sqrt{2}} \mp i \frac{p_+ - p_-}{\sqrt{2}}\right) = \frac{-i\sqrt{m\omega}}{2}\left[\tfrac{1\mp i}{\sqrt{2}}(a_+-a_+^\dagger)+ \tfrac{1\pm i}{\sqrt{2}}(a_- - a_-^\dagger)\right].
\end{align}
In the mixed case \eqref{eq:complex_oscillator_mixed_decomposition} we instead get\footnotemark[\getrefnumber{fn:order_sign_CCR_conjugate}]
\begin{align}\label{eq:complex_oscillator_rotated_mixed_decomposition}
    q_z &= \frac{1}{\sqrt{2}}\left(q_x + \tfrac{i}{m\omega} p_y\right) = \frac{1}{2\sqrt{m\omega}}\left[(a_x + a_x^\dagger) + (a_y - a_y^\dagger)\right]\\
    &=\frac{1}{2}\left((q_++q_-)+\tfrac{i(p_+-p_-)}{m\omega}\right)
    = \frac{1}{\sqrt{2m\omega}}(a_+ + a_-^\dagger),
    \\
    p_z &= \frac{1}{\sqrt{2}}\left(p_x \pm i m \omega q_y\right) = \frac{-i\sqrt{m\omega}}{2}\left[(a_x - a_x^\dagger) \mp (a_y + a_y^\dagger)\right]
    \\
    &= \frac{1}{2}\big[(p_+ + p_-) \pm i m \omega (q_+ - q_-)\big] = \Big(i \sqrt{\frac{m\omega}{2}} ( a_+^\dagger-a_-)\Big)^{(\dagger)}.
\end{align}
%
\end{mytheorem}



\begin{mytheorem}[Ladder operator toolkit\todotag{Finis}]
%
Ladder operators $a$ and $a^\dagger$ obeying $[a, a^\dagger] = 1$ have the following useful properties.
\begin{itemize}
    \item Physicists Hermite polynomials $H_n(\xi)$ are defined as
    \begin{align}
        H_n(\xi):= e^{\frac{\xi^2}{2}}\Big(\underbrace{\xi-\partial_\xi}_{=\sqrt{2}\,a^\dagger}\big)^n e^{-\frac{\xi^2}{2}}\,.
    \end{align}
    From the formula $\xi \mapsto H_n(\xi)$ as parity $(-1)^n$.
    %
    \item The action of $a$ on a state $\propto \left(a^\dagger\right)^n |0\rangle$ is
    \begin{align}
        a \left(a^\dagger\right)^n |0\rangle = n \left(a^\dagger\right)^{n-1} |0\rangle.
    \end{align}
    More generally, the lowering operator acts as derivative wrt $a^\dagger$ on any Taylor expandable function $f(a^\dagger)$, in the sense that
    \begin{align}
        a f(a^\dagger) |0\rangle = \frac{d f}{d a^\dagger} |0\rangle.
    \end{align}
    %
    \item The Baker-Campbell-Hausdorff formula for ladder operators reads
    \begin{align}
        e^{\alpha a + \beta a^\dagger} = e^{\alpha a} e^{\beta a^\dagger} e^{-\frac{1}{2} \alpha \beta}, \quad \alpha, \beta \in \mathbb{C}.
    \end{align}
    This is just a simpler version of the general BCH formula,
    \begin{align}
        &e^A e^B = E^Z, \quad Z = \log(e^A e^B)= A + B + \tfrac{1}{2}[A,B] + \tfrac{1}{12}([A,[A,B]] - [B,[A,B]]) + \ldots
        \\[5pt]
        &\Rightarrow \quad e^A e^B = e^{A+B} e^{+\frac{1}{2}[A,B]} \quad \text{if } [A,[A,B]] = [B,[A,B]] = 0,
    \end{align}
    since the commutator is a c-number  $[\alpha a, \beta a^\dagger] = \alpha \beta\in\C$. 
\end{itemize}
    %
\end{mytheorem}

\begin{mytheorem}[Coherent states\todotag{Finish}]
%
Coherent states $|\alpha\rangle$ of the quantum harmonic oscillator are defined as the eigenstates of the annihilation operator $a$, namely
\begin{align}
    a |\alpha\rangle = \alpha |\alpha\rangle \quad\text{or equivalently}\quad \langle \alpha|a^\dagger = \alpha^* \langle \alpha|, \quad \alpha \in \mathbb{C}.
\end{align}
Note it is not assured they exist since $a$ is not a \emph{normal} operator!
We construct them explictly for arbitrary $\alpha\in \C$ as
\begin{align}
    |\alpha\rangle \propto  \sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} |n\rangle = \sum_{n=0}^\infty \frac{(\alpha a^\dagger)^n}{n!} |0\rangle
    = e^{\alpha a^\dagger} |0\rangle\quad \Rightarrow\quad a|\alpha\rangle = a e^{\alpha a^\dagger} |0\rangle = \frac{d}{da^\dagger} e^{\alpha a^\dagger} |0\rangle = \alpha e^{\alpha a^\dagger} |0\rangle = \alpha |\alpha\rangle.
\end{align}
To find the normalization it is first convenient to note that
\begin{align} 
    e^{\beta a}|0\rangle = 1+\beta a + \frac{\beta^2}{2} a^2 + \ldots = |0\rangle, \quad \forall \beta \in \C\,.
\end{align}
We can thus insert $e^{-\alpha^*a}$ next to $|0\rangle$ without changing anything and then use the BCH formula to find 
\begin{align}
    |\alpha\rangle &\propto\, e^{\alpha a^\dagger} |0\rangle = e^{\alpha a^\dagger} e^{-\alpha^* a} |0\rangle
    = e^{\frac{1}{2} |\alpha|^2} e^{\alpha a^\dagger - \alpha^* a} |0\rangle\,,\qquad e^{\alpha a^\dagger - \alpha^* a}\in U(\mathcal{H}).
\end{align}
The operators $e^{\alpha a^\dagger - \alpha^* a}$ are unitary since $(\alpha a^\dagger - \alpha^* a)^\dagger = -(\alpha a^\dagger - \alpha^* a)$, the normalized coherent state is then
\begin{align}
    |\alpha\rangle = e^{-\frac{1}{2} |\alpha|^2} e^{\alpha a^\dagger}|0\rangle =  e^{-\frac{1}{2} |\alpha|^2} e^{\alpha a^\dagger}e^{-\alpha^* a}|0\rangle = e^{\alpha a^\dagger - \alpha^* a} |0\rangle.
\end{align}
%
Coherent states also warn us about the identification of ladder operators as creating/destroying a particle.
This identification is indeed justified only on states with a definite number of particles, like the Fock states $|n\rangle$ or superpositions thereof.
On the other hand the action of $a^\dagger$ leave coherent states invariant up to a complex factor.
\end{mytheorem}



\begin{mytheorem}[Exciting harmonic oscillators: driving forces \& parametric resonance\todotag{Finish}]
%
There are two main ways to excite a harmonic oscillator, i.e. to increase its energy.
\begin{itemize}
    \item Apply an external \emph{driving force} $F(t)$, modifying the Hamiltonian as
    \begin{equation}
        H = \tfrac{1}{2m}p^2 + \tfrac{m\omega^2}{2} q^2 - q F(t).
    \end{equation}
    If the driving force oscillates at the natural frequency of the oscillator, $F(t) = F_0 \cos(\omega t)$, then resonance occurs and the amplitude of oscillation increases linearly with time.
    %
    \item Change in time the \emph{parameters} of the oscillator, like its frequency $\omega(t)$ or mass $m(t)$, modifying the Hamiltonian as
    \begin{equation}
        H = \tfrac{1}{2m(t)}p^2 + \tfrac{m(t)\omega(t)^2}{2} q^2.
    \end{equation}
    If the parameters are changed periodically at twice the natural frequency of the oscillator, parametric resonance occurs and the amplitude of oscillation increases exponentially with time.
\end{itemize}
%
The first is essentially how QFTs of different species excite each other via interactions, while the second is how QFTs in curved spacetime get excited by the expansion of the universe or by time-dependent gravitational fields.
\end{mytheorem}



%--------------------------------------------------------
%=========================================================
\section{The Klein-Gordon Field}
%=========================================================
%------------------------------------------------------------


\begin{mytheorem}[Towards the Klein-Gordon Lagrangian\todotag{Improve}]
%
Consider the Lagrangian for a discrete set of classical harmonic oscillator in $d$ space dimensions with some potential $V(q_n)$,
\begin{align}
    \mathcal{L}= \sum_{n\in \Z^d}\frac{1}{2} \mu \dot{q}_n^2 - \frac{1}{2} \mu \omega_n^2 \sum_{j=1}^d (q_n - q_{n +\hat{e}_j})^2 - V(q_n).
\end{align}
The density of oscillators is $\rho = \mu / a^d$ and the speed of sound is $c_s = a \omega_n$, where $a$ is the lattice spacing, are kept constant as we take the continuum limit $a \to 0$.
The Lagrangian then becomes
\begin{align}
    \mathcal{L} &= \sum_{n\in \Z^d} a^d \left[ \frac{1}{2} \rho \dot{q}_n^2 - \frac{1}{2} \rho (a\omega_n)^2 \sum_{j=1}^d \left(\frac{q_n - q_{n +\hat{e}_j}}{a}\right)^2 - \frac{1}{a^d} V(q_n) \right]
    \\
    & 
    \sum_{n\in \Z^d} a^d \left[ \frac{1}{2} \big(\rho^{1/2} \dot{q}_n\big)^2 - \frac{1}{2} (a\omega_n)^2 \sum_{j=1}^d \left(\frac{\rho^{1/2}q_n - \rho^{1/2}q_{n +\hat{e}_j}}{a}\right)^2 - \frac{1}{a^d} V(\rho^{-1/2}\rho^{1/2}q_n) \right]
    \\
    &\xrightarrow[a\to 0]{} \int d^d\!x\,\,\, \tfrac{1}{2} \left(\partial_t\phi(t,\mathbf{x})\right)^2 - \tfrac{1}{2} c_s^2 \,\left(\nabla_x\phi(t,\mathbf{x})\right)^2 - \mathcal{V}(\phi(t,\mathbf{x})),
\end{align}
where we redefined the field as $\phi(t,\mathbf{x}) := \rho^{1/2} q_n(t)= \mu^{1/2}a^{-d/2} q_n(t)$ and the potential density as $\mathcal{V}(\phi) := \lim_{a\to 0} a^{-d} V(\rho^{-1/2} \phi)$.
Choosing a quadratic potential $V(q_n) = \tfrac{1}{2} \mu^2 q_n^2$ yields the Klein-Gordon lagrangian density for a free scalar field of mass $\mu$.


Note that we absorbed a factor $\mu^{1/2}$ in the rescaling of the field.
Therefore in d+1 spacetime the field $\phi(t,\mathbf{x}) := \rho^{1/2} q_n(t)= \mu^{1/2}a^{-d/2} q_n(t)$ has energy dimension $[\phi] = E^{-1/2} E^{d/2} = E^{(d-1)/2}$, and its Fourier transform $\phi_k= \int d^dx \phi_x e^{ixk}$ has dimension $[\phi_k] = E^{-1/2} E^{-d/2}$.
Below we will identify harmonic oscillator variables constituting the field as $\phi_k\sim q_k+\tfrac{1}{\omega_k} p_k$, so that $[q_k] = E^{-1/2} E^{-d/2}$ and $[p_k] = E^{1/2} E^{-d/2}$.
Since the mass $\mu$ has already been absorbed, \emph{adimensional} density\footnote{In the sense they are 'square-root densities' in $k$-space i.e. $[\tilde{q}_k]=[\tilde{p}_k]=E^{-d/2}$} variables will then be obtained rescaling as
\begin{equation}
    \tilde{q}_k = \sqrt{\frac{\omega_k}{\hbar}} q_k, \quad \tilde{p}_k = \frac{1}{\hbar}\sqrt{\frac{\hbar}{\omega_k}} p_k,\quad
    \text{instead of the usual}\quad \tilde{q}_k = \sqrt{\frac{m\omega_k}{\hbar}} q_k,\quad \tilde{p}_k = \frac{1}{\hbar}\sqrt{\frac{\hbar}{m\omega_k}} p_k.
\end{equation}
%
\end{mytheorem}




\begin{mytheorem}[Klein-Gordon field as a lake: (de)coupled oscillators \& probing waves with a cork\notetag{Check}]

\begin{wrapfigure}[16]{r}{0.45\textwidth} % 14 = lines to wrap; adjust as needed
  \centering
  \vspace{-0.5\baselineskip}            % optional: nudge up
  \includegraphics[width=0.35\textwidth,height=3.5cm]{images/lake_real.png}\\[1pt]
  \includegraphics[width=0.35\textwidth,height=3.5cm]{images/lake_fourier.png}
  %\includegraphics[width=0.30\textwidth,height=5cm,keepaspectratio]{images/lake_fourier.png}
  %\caption{...}
\end{wrapfigure}

\noindent
The classical (free) Klein-Gordon field is completely analogous to the surface of a lake.
It should be seen as a collection of \emph{coupled} harmonic oscillators, one at each point of space, or equivalently of \emph{decoupled} harmonic oscillators in momentum space i.e. independent Fourier modes, each oscillating with its own frequency.

In the absence of dissipation mechanisms, both for the field and the lake surface, a perturbation in space spreads and deforms overtime, propagating as a superposition of waves with various frequencies and exciting neighbouring points.
On the other hand, a wave with fixed frequency oscillates but maintains its shape (amplitude and frequency) over time, freely travelling across the lake surface without deforming.

\begin{figure}[h!]
  \centering
  \begin{minipage}[t]{0.45\textwidth}
    \includegraphics[width=\linewidth,height=4.5cm]{images/3_corks_lake_reduced.png}
  \end{minipage}\hfill
  \begin{minipage}[t]{0.45\textwidth}
    \raisebox{1.5em}[0pt][0pt]{%
      \includegraphics[width=\linewidth,height=3cm]{images/correlated_cork_oscillations.png}}
  \end{minipage}
\end{figure}

We can probe the waves on a lake using a cork floating on the water surface.
The cork moves up and down following the profile of the lake, thus providing a measurement of the local height of the water surface at the cork position.
The analogous procedure for the KG field is to use an atom or another suitable (quantum) system that can be acted upon by the field, both in the classical and quantum case.
This point-like detector interacts with the field, extracting information on its field amplitude at the given space(time) position.
The oscillations of more corks at different space points will be correlated, but oscillations with different frequencies are independent.

Finally note that in the absence of interactions, say `no rocks thrown into the lake', the surface of the lake--i.e. the classical field--will stay flat or retain its initial excitation, if any.
In the quantum case, there will be fluctuations on top of these classical profiles due to zero-point energy of each Fourier mode, even in the absence of external perturbations.
%
\end{mytheorem}







\begin{mytheorem}[Classical theory of the Klein-Gordon field]
%
A real free scalar field $\phi(x)$ obeys the Klein-Gordon equation, 
\begin{equation}
    (\partial_{\mu} \partial^{\mu} + m^2) \phi(x) = 0.
\end{equation}
This is a wave equation with relativistic dispersion relation $E^2 = |\mathbf{p}|^2 + m^2$ for the field excitations.
It is the Euler-Lagrange equation of the nonunique Lagrangian (density) and action
\begin{equation}
    \mathcal{L} = \frac{1}{2} \partial_{\mu} \phi \partial^{\mu} \phi - \frac{1}{2} m^2 \phi^2, 
    \quad L=\int d^3 x\, \mathcal{L},\quad S = \int dx^0 L = \int d^4 x\, \mathcal{L}.
\end{equation}
The corresponding conjugate momentum and Hamiltonian density are 
\begin{equation}
    \pi(x) = \frac{\delta L}{\delta \partial_0 \phi(x)} = \frac{\partial \mathcal{L}}{\partial\big(\partial_0 \phi(x)\big)} = \partial_0 \phi(x), 
    \qquad 
    \mathcal{H} = \frac{1}{2} \pi^2 + \frac{1}{2} (\nabla \phi)^2 + \frac{1}{2} m^2 \phi^2.
\end{equation}
In the classical theory, the fields $\phi(x)$ and $\pi(x)$ satisfy the equal-time Poisson brackets 
\begin{align}
    \{\phi(t, \mathbf{x}), \pi(t, \mathbf{y})\} = \delta^{(3)}(\mathbf{x} - \mathbf{y}), \quad
    \{\phi(t, \mathbf{x}), \phi(t, \mathbf{y})\} = 0, \quad
    \{\pi(t, \mathbf{x}), \pi(t, \mathbf{y})\} = 0.
\end{align}
More generally, the equation of motions for any functional $\mathcal{O}[\phi, \pi]$ of the fields is given by the Poisson brackets
\begin{equation}
    \frac{d\mathcal{O}}{dt} = \{\mathcal{O}, H\} + \frac{\partial \mathcal{O}}{\partial t},
    \quad \text{for}\quad
    \{\mathcal{O}_1,\mathcal{O}_2\} = \int d^3 x\, \left( \frac{\delta \mathcal{O}_1}{\delta \phi(x)} \frac{\delta \mathcal{O}_2}{\delta \pi(x)} - \frac{\delta \mathcal{O}_1}{\delta \pi(x)} \frac{\delta \mathcal{O}_2}{\delta \phi(x)} \right),
\end{equation}
where the Hamiltonian is $H = \int d^3 x\, \mathcal{H}$. 
In particular, the fundamental fields obey the equations of motion, which equivalently combine into the Klein-Gordon equation,
\begin{align}
    \frac{d\phi(t, \mathbf{x})}{dt} = \{\phi(t, \mathbf{x}), H\} = \pi(t, \mathbf{x}), \quad
    \frac{d\pi(t, \mathbf{x})}{dt} = \{\pi(t, \mathbf{x}), H\} = (\nabla^2 - m^2) \phi(t, \mathbf{x}). 
\end{align}
%
\end{mytheorem}


\begin{mytheorem}[Heisenberg canonical quantization of the Klein-Gordon field\notetag{Check}]
%
Following Heisenberg canonical quantization procedure, we promote the classical theory to a quantum theory as follows.
\begin{itemize}
    \item Promote the classical fields $\phi(x)$ and $\pi(x)$ to operators $\hat{\phi}(x)$ and $\hat{\pi}(x)$ acting on a Hilbert space $\mathcal{F}$.
    %
    \item Poisson brackets are replaced by commutators according to the rule $\displaystyle \{A, B\} \mapsto \frac{1}{i\hbar} [\hat{A}, \hat{B}].$
    %
    \item The equations of motion are left formally unchanged, but now refer to evolving operators.
\end{itemize}
%
The equal-time Poisson backe of the field become the equal-time caonical commutation relations 
\begin{align}
    [\hat{\phi}(t, \mathbf{x}), \hat{\pi}(t, \mathbf{y})] &= i\hbar\, \delta^{(3)}(\mathbf{x} - \mathbf{y}), \quad
    [\hat{\phi}(t, \mathbf{x}), \hat{\phi}(t, \mathbf{y})] = 0, \quad
    [\hat{\pi}(t, \mathbf{x}), \hat{\pi}(t, \mathbf{y})] = 0.
\end{align}
%
The evolution of any operator $\mathcal{O}[\hat{\phi},\hat{\pi}]$ function of the fundamental fields is
\begin{equation}
    \frac{d\hat{\mathcal{O}}}{dt} = \frac{1}{i \hbar} [\hat{\mathcal{O}}, \hat{H}] + \frac{\partial \hat{\mathcal{O}}}{\partial t}, \quad \text{for}\quad
    \hat{H} = \int d^3x\,\, \hat{\mathcal{H}} = \int d^3 x\, \left( \frac{1}{2} \hat{\pi}^2 + \frac{1}{2} (\nabla \hat{\phi})^2 + \frac{1}{2} m^2 \hat{\phi}^2 \right).
\end{equation}
%
In particular, the fundamental fields obey the Heisenberg equations of motion
\begin{align}
    \begin{cases}\displaystyle
    \frac{d\hat{\phi}(t, \mathbf{x})}{dt} = \tfrac{1}{i \hbar} [\hat{\phi}(t, \mathbf{x}), \hat{H}] = \hat{\pi}(t, \mathbf{x}), \\[7pt]
    \displaystyle
    \frac{d\hat{\pi}(t, \mathbf{x})}{dt} = \tfrac{1}{i \hbar} [\hat{\pi}(t, \mathbf{x}), \hat{H}] = (\nabla^2 - m^2) \hat{\phi}(t, \mathbf{x}),
    \end{cases}
    \,\Rightarrow\quad  (\partial_{\mu} \partial^{\mu} + m^2) \hat{\phi}(x) = 0.
\end{align}
which together again imply the field operator $\hat{\phi}(x)$ satisfies the Klein-Gordon equation.
%
\end{mytheorem}


\begin{mytheorem}[The Schrödinger equation\notetag{Check}]
%
The good old Schrödinger equation in Quantum Mechanics reads
\begin{equation}
    i \hbar \frac{\partial}{\partial t} |\Psi(t)\rangle = \hat{H} |\Psi(t)\rangle.
\end{equation}
In the original formulation $|\Psi\rangle$ is a ket in a single-particle Hilbert space, and it is bound to fail when dealing with systems with variable particle number.
%
However, since the Heisenberg and Schrödinger formulations of Quantum Mechanics are completely equivalent, we can still use the latter in QFT and get a corresponding equation.
The space $\mathcal{F}=\bigoplus \mathcal{H}_1^{\otimes n}$ of states in QFT is now a Fock space, i.e. a direct sum of $n$-particle Hilbert spaces.
Taking $\mathcal{H}_1\simeq L^2(\mathbb{R}^3)$ for simplicity, the general state in $\mathcal{F}$ can be written as
\begin{equation}
    |\Psi\rangle = \left( \begin{array}{c}
    \psi_0 \\
    \psi_1(\mathbf{x}_1) \\
    \psi_2(\mathbf{x}_1, \mathbf{x}_2) \\
    \vdots
    \end{array} \right),\qquad \psi_n(\mathbf{x}_1, \ldots, \mathbf{x}_n) \in L^2(\mathbb{R}^{3n}).
\end{equation}
%
The Schrödinger equation in QFT is virtually identical.
Now $\hat{H}=\int d^3x \mathcal{H}$ is the Hamiltonian operator acting on the Fock space $\mathcal{F}$.
For example, for the free Klein-Gordon field
\begin{align}
    \hat{H} &= \int d^3 x\, \left( \frac{1}{2} \hat{\pi}^2 + \frac{1}{2} (\nabla \hat{\phi})^2 + \frac{1}{2} m^2 \hat{\phi}^2 \right).
\end{align}
%    
\end{mytheorem}



%=========================================================
\subsection{Fourier transform \& uncoupled degrees of freedom}
%=========================================================


\begin{mytheorem}[Fourier transform \& identifying the uncoupled DoFs of the Klein-Gordon field]
%  
The Fourier transform of the fields are defined as
\begin{equation}
    \phi_k(t) :=\int d^3 x\, e^{-i \mathbf{k} \cdot \mathbf{x}} \phi(t, \mathbf{x}), \qquad \pi_k(t) := \int d^3 x\, e^{-i \mathbf{k} \cdot \mathbf{x}} \pi(t, \mathbf{x}) = \frac{\partial }{\partial t}\phi_k(t).
\end{equation}
Note that self-adjointness in position space implies $\phi_k^{\dagger}(t) = \phi_{-k}(t), \,\pi_k^{\dagger}(t) = \pi_{-k}(t)$ in momentum space.
%
The Klein-Gordon equation simply becomes the equation for uncoupled \emph{complex} harmonic oscillators
\begin{equation}
    \frac{d^2 }{dt^2}\phi_k(t) + (|\mathbf{k}|^2 + m^2) \phi_k(t) = 0, \quad \text{with frequency}\quad \omega_k = \sqrt{|\mathbf{k}|^2 + m^2}.
\end{equation}
Coherently, the Hamiltonian is just a sum of independent complex harmonic oscillator Hamiltonians
\begin{equation}
    H  = \int d^3x\,\left(\tfrac{1}{2} \pi^2 + \tfrac{1}{2} (\nabla \phi)^2 + \tfrac{1}{2} m^2 \phi^2\right) = \int \frac{d^3 k}{(2\pi)^3} \left( \tfrac{1}{2} \pi_k^\dagger\pi_k + \tfrac{1}{2} (|\mathbf{k}|^2 + m^2) \phi_k^\dagger \phi_{k} \right)\,,
\end{equation}
and equal time commutation relations in momentum space indeed become the expected oscillator CCR\footnote{Note the commutation relation for the complex harmonic oscillator are of the form $[q_z,p_z^*]=1$ as discussed in \eqref{eq:complex_harmonic_oscillator}.}
\begin{align}
    [\hat{\phi}_k(t), \hat{\pi}_{k'}(t)] = i\hbar\, (2\pi)^3 \delta^{(3)}(\mathbf{k} + \mathbf{k}'), \quad
    [\hat{\phi}_k(t), \hat{\phi}_{k'}(t)] = 0, \quad
    [\hat{\pi}_k(t), \hat{\pi}_{k'}(t)] = 0.
\end{align}

It seems we managed to diagonalize the Hamiltonian and identify the uncoupled degrees of freedom of the theory, behaving as independent harmonic oscillators labelled by the momentum $\mathbf{k}$.
However something is off track.
\begin{itemize}
    \item The field $\phi_k$ is no more self-adjoint, since $\phi_k^{\dagger} = \phi_{-k}$, whereas we would rather our DoFs be observables.
    In fact the $\phi_k$ are \emph{normal} operators, so they actually are observables with complex eigenvalues, even though it is not very intuitive. 
    \item The delta functions of the CCR is $\delta^{(3)}(\mathbf{k} + \mathbf{k}')$ instead of the expected $\delta^{(3)}(\mathbf{k} - \mathbf{k}')$, suggesting that the conjugate momentum of the mode $\phi_k$ is actually $\pi_{-k}$ instead of $\pi_k$.
    \item We have a continuum of Fourier modes $k$, and Dirac $\delta$ instead of Kronecker $\delta$ for the DoFs.
\end{itemize}
These problems are all related.
The last one was expected, since we are considering infinite volume and thus a continuum of modes $k$.
Infrared regularization, like placing the theory in a finite box or ball, would immediately restore countable \emph{discrete} Fourier modes\footnote{e.g. modes $e^{\pm ikx}$ or $\sin(kx)$ for suitable $k=2\pi(\tfrac{n_1}{L_1},\tfrac{n_2}{L_2},\tfrac{n_3}{L_3})$ in a box with PBC or DBC, and $\propto R_n(r) Y_{\ell,m}(\theta,\phi)$ in a ball} and Kronecker deltas.
In fact, considering a \emph{finite} box with Dirichlet or Neumann boundary conditions instead of periodic ones, would yield a Fourier expansion in \emph{real} sine and cosine modes, thereby solving also the first issue:
\begin{align}\label{eq:other_BCs_IR_regulated_field}
    \hat{\phi}^{\mathrm{DBC}}_k(t) \simeq  \int_{\text{box}} \!\!d^3 x\, \sin(\mathbf{k} \mathbf{x}) \hat{\phi}(t, \mathbf{x})\,\in\R\,, \quad
    \hat{\phi}^{\mathrm{NBC}}_k(t) \simeq \int_{\text{box}} \!\!d^3 x\, \cos(\mathbf{k} \mathbf{x}) \hat{\phi}(t, \mathbf{x})\,\in\R.
\end{align}

In any case, the first two issues have more physical relevance and are still related.
We can fix them by explicitly rewriting $\phi_k$ as linear combination of \emph{physical} self-adjoint harmonic oscillators $\{q_k,p_k\}_k$ to highlight the true DoFs of the theory.
Alternatively, we can directly write $\phi_k$ in terms of creation and annihilation operators $a_k$, and in turn again identify the corresponding self-adjoint oscillators.
The two approaches are completely equivalent and force us to understand several aspects e.g. what to consider as \emph{the vacuum} of the theory.
%
\end{mytheorem}



\begin{mytheorem}[Infrared regularization \& DoFs of Klein-Gordon field]
%
Before entering the physical aspects, we fix the conventions for Fourier transform and infrared regularization by placing the theory in a finite cubic box of volume $V=L^d$ with periodic boundary conditions.
Fourier modes become countable discrete $\mathbf{k} = \frac{2\pi}{L} \mathbf{n}$ with $\mathbf{n}\in\mathbb{Z}^d$, and we have the correspondences
\begin{align}\label{eq:IR_reg_replacements}
    \int_V \frac{d^d k}{(2\pi)^d} &\,\,\Rightarrow \,\,\frac{1}{V} \sum_k\,, \quad
    (2\pi)^d \delta^{(d)}_D(\mathbf{k} - \mathbf{k}') \equiv \int_V d^dx e^{i\mathbf{x}\cdot(\mathbf{k} - \mathbf{k}')} \,\,\Rightarrow \,\,V \delta_{k,k'}\,,\quad \frac{\delta}{\delta f_k}\,\,\Rightarrow \,\, \frac{V}{(2\pi)^d} \frac{\partial}{\partial f_k}\,.
\end{align}
The Fourier transforms of fields and of the Hamiltonian become
\begin{align}
    \phi(t_0,\mathbf{x})&= \frac{1}{V} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \phi_k(t_0) = \frac{1}{V} \sum_k \frac{1}{\sqrt{2\omega_k}} \left( a_k e^{i \mathbf{k}\cdot\mathbf{x}} + a_k^{\dagger} e^{- i \mathbf{k}\cdot\mathbf{x}} \right),
    \\
    \pi(t_0,\mathbf{x})&= \frac{1}{V} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \pi_k(t_0) = \frac{1}{V} \sum_k \frac{1}{\sqrt{2\omega_k}} \left( -i \omega_k a_k e^{i \mathbf{k}\cdot\mathbf{x}} + i \omega_k a_k^{\dagger} e^{- i \mathbf{k}\cdot\mathbf{x}} \right),
    \\
    H&= \frac{1}{V} \sum_k \hbar \omega_k \left( a_k^{\dagger} a_k + \tfrac{1}{2} V \right).
\end{align}
%
With these conventions, \textbf{all formulas stay unchanged upon the replacements} \eqref{eq:IR_reg_replacements}.
The nonzero commutation relations become
\begin{align}
    [\phi_k(t), \pi_{k'}(t)] = i\hbar\, V \delta_{k,k'}, \quad
    [a_{k}, a_{k'}^{\dagger}] = V \delta_{k,k'}.
\end{align}
The \textbf{energy dimensions of operators/variables}, fields $(\phi_k,\,\pi_k)$, ladder $(a_k,a_k^\dagger)$, dimensional $(q_k, p_k)$ and adimensional $(\tilde{q}_k, \tilde{p}_k)$ oscillators, \textbf{and their mutual relations} \eqref{eq:relations_fields_creation_operators_harmonic_oscillator_var} \textbf{remain unchanged}.

%
\textbf{Beware} in the \textbf{literature} it is \textbf{common to redefine operators rescaling} by $\sqrt{V}$ after IR regularization as
\begin{align}
    \big(\phi_k,\,\pi_k\big) \mapsto V^{-\frac{1}{2}} \big(\phi_k,\,\pi_k\big)\,,\quad
    a_k^{(\dagger)} \mapsto V^{-\frac{1}{2}} a_k^{(\dagger)}, \quad
    \big(q_k,p_k\big) \mapsto V^{-\frac{1}{2}} \big(q_k,p_k\big), \quad
    \big(\tilde{q}_k, \tilde{p}_k\big) \mapsto V^{-\frac{1}{2}} \big(\tilde{q}_k, \tilde{p}_k\big)\,.
\end{align}
In particular ladder operators $a_k$ and $a_k^{\dagger}$ become dimensionless.
The fields, Hamiltonian and commutation relations change as
{\small
\begin{align}
    \phi_k(t) &= \frac{1}{\sqrt{V}} \int d^3 x\, e^{-i \mathbf{k} \cdot \mathbf{x}} \phi(t, \mathbf{x}),\quad
    \phi(t,\mathbf{x})= \frac{1}{\sqrt{V}} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \phi_\mathbf{k}(t)=\frac{1}{\sqrt{V}} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \frac{1}{\sqrt{2\omega_k}} \left( a_k e^{i \mathbf{k}\cdot\mathbf{x}} + a_k^{\dagger} e^{- i \mathbf{k}\cdot\mathbf{x}} \right),
    \\
    \pi_k(t) &= \frac{1}{\sqrt{V}} \int d^3 x\, e^{-i \mathbf{k} \cdot \mathbf{x}} \pi(t, \mathbf{x}),\quad
    \pi(t,\mathbf{x})= \frac{1}{\sqrt{V}} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \pi_\mathbf{k}(t)=\frac{1}{\sqrt{V}} \sum_k e^{i \mathbf{k}\cdot\mathbf{x}} \frac{1}{\sqrt{2\omega_k}} \left( -i \omega_k a_k e^{i \mathbf{k}\cdot\mathbf{x}} + i \omega_k a_k^{\dagger} e^{- i \mathbf{k}\cdot\mathbf{x}} \right),
    \\
    H&= \sum_k \tfrac{1}{2}\,\pi_k^\dagger\pi_k + \tfrac{1}{2}\omega_k^2 \,\phi_k^\dagger \phi_k =\sum_k \hbar \omega_k \left( a_k^{\dagger} a_k + \tfrac{1}{2} \right),\qquad [\phi_k,\pi_k^\dagger]=i\hbar\delta_{k,k'}\,\quad[a_{k}, a_{k'}^{\dagger}] = \delta_{k,k'}.
\end{align}
}
%
This is just a matter of conventions, but it is important to keep track of factors of $V$ when considering fluctuations and zero-point energies.
We will \textbf{not adopt this convention}, which make the passage finite-infinite volume less straightforward.
%
\end{mytheorem}


\begin{mytheorem}[Observable DoFs of the Klein-Gordon field in flat spacetime.\questiontag{Check}]
%
After Fourier transform, the theory reads as a collection of independent complex harmonic oscillators
\begin{align}
    &H  = \int \frac{d^3 k_{\geq0}}{(2\pi)^3} \left( \pi_k^\dagger\pi_k + (|\mathbf{k}|^2 + m^2) \phi_k^\dagger \phi_{k} \right) = \frac{1}{V}\sum_{k\geq0} \left( \pi_k^\dagger\pi_k + (|\mathbf{k}|^2 + m^2) \phi_k^\dagger \phi_{k} \right)\,,\\
    & \quad [\phi_k,\pi_{k'}^\dagger]=i\hbar \delta_D(k-k')= i\hbar V \delta_{k,k'}\,,\quad \phi_k^\dagger = \phi_{-k}\,,\qquad \pi_k^\dagger = \pi_{-k}\,.
\end{align}
The overall factor $\frac{1}{2}$ cancels since modes $\pm k$ contribute the same amount to the Hamiltonian and the shorthand $k\geq0$ means the imtegral/sum is only over half of momentum space, e.g. $k_1\geq0$, to avoid double counting.

These are exactly complex harmonic oscillator \eqref{eq:complex_harmonic_oscillator} with complex CCR $[q_z, p_z^*] = i\hbar$.
We need to identify corresponding \emph{physical} self-adjoint oscillators $\{Q^{(k)}_\pm,\,P^{(k)}_\pm\}$.
As argued Section \ref{sec:harmonic_oscillators}, it is more convenient to use the mixed decomposition \eqref{eq:complex_oscillator_mixed_decomposition} since it yields a cleaner decomposition \eqref{eq:complex_oscillator_rotated_mixed_decomposition} of the complex DoFs $\phi_k,\,\pi_k$ in terms of ladder operators of $\frac{\pi}{4}$-rotated oscillators $\{q_{\pm k}, p_{\pm k}\}$.
Namely define
\begin{align}
    Q^{(k)}_\pm &= \frac{1}{\sqrt{2}} (q_k \pm q_{-k}), \quad P^{(k)}_\pm = \frac{1}{\sqrt{2}} (p_k \pm p_{-k}),
\end{align}
Then recast the fields as
\begin{align}\label{eq:relations_fields_creation_operators_harmonic_oscillator_var}
\begin{aligned}
    \phi_k(t_0) &= \frac{1}{\sqrt{2}}\Big(Q_++\frac{i}{\omega_k} P_-\Big) = \tfrac{1}{2}\Big[\big({q}_k+{q}_{-k}\big) + \tfrac{i}{\omega_k}\big({p}_k - {p}_{-k}\big) \Big]
    =\frac{1}{\sqrt{2\omega_k}} (a_k + a_{-k}^{\dagger}) 
    \\
    \pi_k(t_0) &= \frac{1}{\sqrt{2}}\Big(P_+ - i \omega_k Q_-\Big) = \tfrac{1}{2}\Big[ \big({p}_k - {p}_{-k}\big) -i\,\omega_k\big({q}_k-{q}_{-k}\big)\Big]
    = -i \sqrt{\frac{\omega_k}{2}} (a_k - a_{-k}^{\dagger})\,.
\end{aligned}
\end{align}
The ladder operators are defined wrt the rotated oscillators as
\begin{align}\label{eq:ladder_operators_field}
    a_k &= \sqrt{\frac{\omega_k}{2}} \left( q_k + \frac{i}{\omega_k} p_k \right), \quad
    \big[ a_k, a_{k'}^{\dagger} \big] = \hbar (2\pi)^3 \delta^{(3)}(k-k').
\end{align}
The Hamiltonian finally reads, \emph{before} normal ordering,
\begin{align}
    H  &= \int \frac{d^3 k}{(2\pi)^3} \left( \tfrac{1}{2}\pi_k^\dagger\pi_k + \tfrac{1}{2}(|\mathbf{k}|^2 + m^2) \phi_k^\dagger \phi_{k} \right) 
    \\
    & = \int \frac{d^3 k}{(2\pi)^3} \frac{\hbar\omega_k}{2} \Big( a_k^{\dagger} a_k + a_k a_k^\dagger\Big)
    = \int \frac{d^3 k}{(2\pi)^3} \hbar \omega_k \Big( a_k^{\dagger} a_k + \tfrac{1}{2} (2\pi)^3 \delta^{(3)}(\underbrace{k-k}_{=0}) \Big).
\end{align}

In real space the \emph{self-adjoint} fields are
\begin{align}
    \hat{\phi}(x,t_0) &= \int \frac{d^3\bar{k}}{(2\pi)^3}\, e^{i\bar{k}\cdot\bar{x}} \hat{\phi}_k(t_0)
    = \int \frac{d^3\bar{k}}{(2\pi)^3} \frac{1}{\sqrt{2\omega_k}} \left( a_k e^{i \bar{k}\cdot\bar{x}} + a_k^{\dagger} e^{- i \bar{k}\cdot\bar{x}} \right),
    \\
    \hat{\pi}(x,t_0) &= \int \frac{d^3\bar{k}}{(2\pi)^3}\, e^{i\bar{k}\cdot\bar{x}} \hat{\pi}_k(t_0)
    = \int \frac{d^3\bar{k}}{(2\pi)^3} \frac{1}{\sqrt{2\omega_k}} \left( -i \omega_k a_k e^{i \bar{k}\cdot\bar{x}} + i \omega_k a_k^{\dagger} e^{- i \bar{k}\cdot\bar{x}} \right).
\end{align}
Note that we could have \emph{completely equivalently} started from ladder operators $a_k$ with commutation relations \eqref{eq:ladder_operators_field}, imposing the fields be expressed as above, and then identified the corresponding oscillators $\{q_k, p_k\}_k$.
In any case, the decomposition shows the \textbf{truly observable DoFs of the Klein-Gordon field} are \emph{decoupled} real self-adjoint oscillators with frequencies $\omega_k$, and ladder operators create or destroy quanta of these oscillators i.e. quanta of the field with momenta $\bar{k}$ identified with particles under suitable conditions.

Is the above \textbf{decomposition unique}?
We could choose a different reference time $t_0$, but, as long as we are in a free theory in flat spacetime, this simply corresponds to a phase shift in the definition of creation and annihilation operators, leaving the vacuum invariant.
On the other hand, there are indeed inequivalent choices of creation and annihilation operators, for instance mixing $a_k$ and $a_{-k}^\dagger$ as dsicussed in Section \ref{sec:harmonic_oscillators}.
This indeed changes the vacuum of the theory i.e. the state $|0\rangle$ annihilated by all $a_k$ operators.
This is not a problem in flat spacetime, where Poincaré invariance selects a preferred vacuum which happily also coincides with the ground state of the Hamiltonian, but it becomes a serious issue in curved spacetime, where no preferred vacuum exists in general. \todotag{Discuss issue in more detail}
%
\end{mytheorem}


%=========================================================
\subsection{Representations of the Fock space}
%=========================================================


\begin{mytheorem}[Spectral basis \& maximal set of commuting observables.]
%
In ordinary QM, we can expand the state $|\Psi\rangle$ in terms of common eigenstates of suitable sets of commuting self-adjoint operators.
Common choices are the position operator $X$, the momentum $P$, angular momenta $L^2$ and $L_z$, the Hamiltonian, intrisinc spins $S^2$ and $S_z$ or suitable combinations like $L+S$, helicity, other instrinsic DoF operators, etc.

Given a set of commuting observables $\{A_i\}$, the spectral theorem indeed ensures the existence of a common spectral basis.
This basis might however have degeneracies i.e. independent eigenstates sharing the same collection of eigenvalues for all observables in the set.
A \emph{maximal set of commuting observables} is a collection of self-adjoint operators $\{A_i\}$ such that
\begin{itemize}
    \item $[A_i, A_j] = 0$ for all $i, j$;
    \item any other self-adjoint operator $B$ commuting with all $A_i$ is a function\footnote{For example $H\sim p^2/2m$ in ordinary QM.} of the $A_i$.
\end{itemize}
The common eigenstates of a maximal set of commuting observables form a basis for the Hilbert space with no degeneracies i.e. two distinct eigenstates have different eigenvalues for at least one of the observables in the set.
\end{mytheorem}
\begin{proof}
Suppose there is a collection of eigenvalues $\{\lambda_i\}_i$ shared by two linearly independent eigenstates $|\psi\rangle$ and $|\phi\rangle$.
Then $S=\text{Span}\{|\psi\rangle, |\phi\rangle\}$ is a two-dimensional subspace invariant under all $A_i$ and we can define a new self-adjoint operator $B$ acting non-trivially only on this subspace and commuting with all $A_i$, contradicting the maximality of the set--e.g. it swaps $|\psi\rangle$ and $|\phi\rangle$ and is the identity on $S^{\perp}$.
\end{proof}



\begin{mytheorem}[Collapse of the wave functional \& measuring the $\phi$-field at all space points at once]
%
The postulates of QM state that after measuring an observable $A$ on a system in state $|\Psi\rangle$ obtaining the eigenvalue $\lambda$ as outcome, the system collapses to the corresponding eigenspace of $A$.
For example, if we measure the field $\hat{\phi}$ at some points $x_1\dots x_n$ in space obtaining values $f(x_1)\dots f(x_n)$, the system will then collapse onto the eigenspace of states $|\Psi^\prime\rangle$ satisfying
\begin{align}
    \hat{\phi}(x_i) |\Psi^\prime\rangle = f(x_i) |\Psi^\prime\rangle, \quad i=1\dots n.
\end{align}

In fact, since the entire collection of field operators $\{\hat{\phi}(x)\}_{x\in \mathbb{R}^3}$ commutes (it is actually a \emph{maximal} set of commuting observables), we could in principle measure the field values $f(x)\equiv\hat{\phi}(t_0,x)$ at each point in space at the same time $t_0$.
In this case, the system will collapse onto a unique field eigenstate $|f\rangle$ for this fixed configuration $f:\mathbb{R}^3 \to \mathbb{R}$.
Repeating the measurement immediately afterwards will yield the same configuration $f$ with probability one i.e. the probability density of finding the field with configuration between $f'$ and $f'+Df'$ after the measurement is
\begin{align}
    P_{\text{after}}(f') \,Df' &= |\langle f' | f \rangle|^2 \,Df' = \left(\delta_D^{(\infty)}(f' - f)\right)^2 \,Df'\,.
\end{align}
The probability is the abstract function space is explicitated as the probability density of finding position values between $f'(x)$ and $f'(x) + df'(x)$ or Fourier modes between $f'_k$ and $f'_k + d f'_k$ 
\begin{align}
    P_{\text{after}}(f') \,Df' &= \prod_{x} \left(\delta_D^{(1)}(f'(x) - f(x))\right)^2 \prod_x df'(x)
    = \prod_{k} \left(\delta_D^{(2)}(f'_k - f_k)\right)^2 \prod_k d^2\!f'_k.
\end{align}
Obvious caveats apply on ill-defined squares of Dirac deltas, possibly infinite-dimensional in the function space of field configurations, and infinite products.

Such an infinite measurement is of course purely theoretical and practically almost impossible.
However, it is worth noticing that such a measurement has in fact been performed by gravity and matter at the end of inflation, collapsing the quantum fluctuations of the inflaton field into classical inhomogeneities and seeding structure formation. \notetag{Expand on this (cf. kemps qft L4)}
\end{mytheorem}



\begin{mytheorem}[Position \& momentum representations in QFT: eigenstates of the field operators $\hat{\phi},\,\hat{\pi}$.]
%
In a finite-dimensional QM system we have a finite number of DoFs, labelled by $i=1\dots n$, with generalized coordinates $q_i$ and conjugate momenta $p_i$ satisfying equal-time canonical commutation relations
\begin{align}
    [\hat{q}_i, \hat{p}_j] = i \hbar \delta_{ij}, \quad
    [\hat{q}_i, \hat{q}_j] = 0, \quad
    [\hat{p}_i, \hat{p}_j] = 0.
\end{align}
By the spectral theorem, we find common spectral bases for the position operators $q_1\dots q_n$ or momentum operators $p_1\dots p_n$, typically denoted $|q\rangle$ and $|p\rangle$ respectively.
Using these bases for the Hilbert space of states is called the \emph{position or momentum representation}.

The same can be done in QFT.
Here we have an infinite number of DoFs, often labelled by the spatial position $\mathbf{x} \in \mathbb{R}^d$, with generalized coordinates $\phi(\mathbf{x})$ and conjugate momenta $\pi(\mathbf{x})=\frac{\delta \mathcal{L}}{\delta \partial_t \phi(\mathbf{x})}$ satisfying analogous equal-time commutation relations 
\begin{align}
    [\hat{\phi}(t, \mathbf{x}), \hat{\pi}(t, \mathbf{y})] = i \hbar \,\delta^{(d)}(\mathbf{x} - \mathbf{y}), \quad
    [\hat{\phi}(t, \mathbf{x}), \hat{\phi}(t, \mathbf{y})] = 0, \quad
    [\hat{\pi}(t, \mathbf{x}), \hat{\pi}(t, \mathbf{y})] = 0.
\end{align}
%
At any fixed time $t$ the collections of operators $\{\hat{\phi}(t, \mathbf{x})\}_{\mathbf{x}\in \mathbb{R}^d}$ and $\{\hat{\pi}(t, \mathbf{x})\}_{\mathbf{x}\in \mathbb{R}^d}$ form two maximal\footnote{Ignoring further internal DoFs and considering $\R^d$ for simplicity.} sets of commuting observables, and we can find corresponding spectral bases $\{|f\rangle\}_{f}$ and $\{|g\rangle\}_{g}$ of the Fock space $\mathcal{F}$.
%
These bases obey
\begin{align}
    \hat{\phi}(t, \mathbf{x}) |f\rangle &= f(\mathbf{x}) |f\rangle, \qquad
    \hat{\pi}(t, \mathbf{x}) |g\rangle = g(\mathbf{x}) |g\rangle.
\end{align}
That is, the states $|f\rangle$ have eigenvalue collections $\{f(x)\}_{x}$ for the commuting operators $\{\hat{\phi}(x)\}_x$, resp. $|g\rangle$ have $\{g(x)\}_x$ for $\{\hat{\pi}(x)\}_x$, for suitable functions $f,g:\mathbb{R}^d \to \mathbb{R}$.
%
These bases are the field-theoretic analogue of the position $\{|x\rangle\}_{x\in \mathbb{R}^n}$ and momentum $\{|p\rangle\}_{p\in \mathbb{R}^n}$ bases in ordinary QM, since $\hat{\phi}(x)$ and $\hat{\pi}(x)$ are the counterpart of position $\hat{X}^i$ and momentum $\hat{P}^i$ operators.
In the first case, operators are labelled by $1\dots n$ and bra-kets by $x\in \mathbb{R}^n$, whereas in QFT operators are labelled by $\mathbf{x}\in \mathbb{R}^d$ and bra-kets by functions $f:\mathbb{R}^d \to \mathbb{R}$.

We remark nobody really knows what is the \emph{space of field configurations.}
That is the function spaces the functions $f$ and $g$ belong to, i.e. the possible collections $\{f(x)\}_x$ or $\{g(x)\}_x$ of $\hat{\phi}$ or $\hat{\pi}$ eigenvalues.
A naive guess is to consider the space of square-integrable functions $f(x) \in L^2(\mathbb{R}^3)$, but this is definitely not correct since typical field configurations are actually distributions rather than functions.
This is already evident from vacuum fluctuations of the field, which diverge at every point in space.
Rigorous treatments of constructive QFT manage to define suitable function spaces and measures, but they are technical and beyond the scope of these notes.
%

The state $|f\rangle$ is also eigenstates of the Fourier transformed field operators $\hat{\phi}_k(t)$ with its Fourier modes $f_k$ as eigenvalues.
Indeed, for fixed $k$ the operator $\hat{\phi}_k(t)$ is a linear combination of the $\{\hat{\phi}(t,x)\}_x$ operators and returns the corresponding linear combination $f_k$ of eigenvalues when acting on the state $|f\rangle$, namely
%
\begin{align}
    \hat{\phi}(x)&\,|f\rangle = f(x)\, |f\rangle \,\,\, \forall x\quad \Rightarrow\quad 
    \hat{\phi}_k(t)|f\rangle = \int d^3 x\, e^{-i \mathbf{k}\mathbf{x}} \hat{\phi}(t, \mathbf{x}) |f\rangle = \int d^3 x\, e^{-i \mathbf{k}\mathbf{x}} f(x) \,\,|f\rangle =
    f_k\,|f\rangle \quad \forall k.
\end{align}
%

The field configurations $f\in W_\phi$ can equivalently be expressed in terms of position values $\{f(x)\}_x$ or Fourier modes $\{f_k\}_k$.
This corresponds to using two different bases for the function space $W_{\phi}$, with change of basis matrix $F$ given by the Fourier transform\footnote{The space $W_\phi$ is only formally contained in the above direct sums. Also note that Fourier modes are complex $f_k\in\C$ in infinite space or IR regularization with PBC.}
\begin{align}
    W_\phi \simeq\!\!\! \underset{x\in\R^d}{\oplus}\!\! \R \longrightarrow\!\!\!\! \underset{k\in\substack{\text{Fourier}\\\mathrm{modes}}}{\oplus}\!\!\!\!\C \simeq W_\phi,\quad
    f_x\mapsto F_k^\bullet f_\bullet= \int \!\!\underbrace{d^d x\, e^{-i \mathbf{k}\mathbf{x}}}_{=F_k^x}\, f(x) = f_k\,,
    \quad \big(F^{-1}\big)_k^x = \frac{d^dk}{(2\pi)^d} e^{i \mathbf{k}\mathbf{x}} = \frac{1}{V}e^{i \mathbf{k}\mathbf{x}}\,.
\end{align}
Correspondingly the functional measure $Df$ and Dirac delta $\delta_D^{W_{\phi}}$ in the function space $W_{\phi}$ are explicitated as infinite product of finite-dimensional Lebesgue measures and Dirac deltas of position values or Fourier modes
\begin{align}\label{eq:func_measure_vs_dirac_delta_change_configuration_space}
    &\prod_x df(x) = \det(F^{-1})\,\prod_k d^2\!f_k\,,\qquad
    \prod_x \,\,\delta_D^{\R}(f(x) - f'(x)) = \det(F)\, \prod_k \,\,\delta_D^{\C}(f_k - f'_k)\,,
    \\[6pt]
    & \prod_x df(x) \,\,\delta_D^{\R}(f(x) - f'(x)) = \prod_k d^2\!f_k \,\,\delta_D^{\C}(f_k - f'_k)
    = Df \,\,\,\delta_D^{W_{\phi}}(f - f')\,.
\end{align}
%
The expressions should coincide since the Fourier transform is expected to be a measure-preserving bijection between the two formulations of $W_{\phi}$.
The above is made rigorous by introducing suitable infrared regularization, making Fourier modes countable discrete, and ultraviolet cutoff, discarding Fourier modes above some scale $\Lambda$ and making the function space finite-dimensional.
%

Regardless of the real or Fourier space representation, a given field configuration {\small $f\in W_\phi$} ultimately denotes the \emph{same} abstract state {\small$|f\rangle$} in the Fock space {\small $\mathcal{F}\simeq L^2(W_{\phi})$} up to a rescaling related to the above choice of basis for $W_{\phi}\simeq \oplus_x \R \simeq \oplus_k \C$.
Namely we have
{\small
\begin{align}
    |\{f_x\}_x \rangle &= \det(F)^{\frac{1}{2}}\, |\{f_k\}_k \rangle,\quad \text{with}\quad
    \dim|\{f_x\}_x \rangle= \prod_x [f_x]^{-\nicefrac{1}{2}} = [f_x]^{-\frac{1}{2}\underset{x}{\sum}1},\, \dim|\{f_k\}_k \rangle= \prod_k [f_k]^{-1} = [f_k]^{-\underset{x}{\sum}1}.
\end{align}
}
In turn we have the expected orthonormality relations
\begin{align}
    \langle \{f(x)\}_x | \{f'(x)\}_x \rangle &= \prod_x \delta_D^{\R}(f(x) - f'(x)) = \det(F)\, \prod_k \delta_D^{\C}(f_k - f'_k) = \det(F)\,\,\langle \{f_k\}_k | \{f'_k\}_k \rangle.
\end{align}
For convenience, we choose an arbitrary energy scale $\mu$ and define \emph{dimensionless} abstract functional measure $Df$ and states $|f\rangle$, still respecting the relation \eqref{eq:func_measure_vs_dirac_delta_change_configuration_space}, as
\begin{align}\label{eq:adimensional_measure_state_fock_space}
\begin{aligned}
    &Df := \prod_x \mu^{-\dim f_x}\, df_x = \mu^{\underset{x}{\sum}\frac{1-d}{2}}\, \det(F) \prod_k d^2\!f_k,\\[3pt]
    &|f\rangle := \mu^{\underset{x}{\sum}\frac{1}{2}\dim f_x} |\{f(x)\}_x \rangle = \mu^{\underset{x}{\sum}\frac{d-1}{4}} \det(F)^{-\frac{1}{2}} |\{f_k\}_k \rangle\,.
\end{aligned}
\end{align}
%
As $f$ varies in the (unknown, ill-defined) configuration space $W_{\phi}$, the states $|f\rangle$ form an improper orthonormal basis of the Fock space $\mathcal{F}\simeq L^2(W_{\phi})$.
We have a corresponding resolution of the identity 
\begin{align}
    \mathbb{I}_{\mathcal{F}}= \int_{W_{\phi}} \!\!\!\!Df\, \, |f \rangle \,\langle f |
     = \prod_x \int_\R \!\!df_x \,\, |\{f_x\}_x \rangle\, \langle \{f_x\}_x | 
     = \prod_k \int_{\C} \!\!d^2\!f_k\, \, |\{f_k\}_k \rangle \,\langle \{f_k\}_k |.
\end{align}
The transformations \eqref{eq:func_measure_vs_dirac_delta_change_configuration_space} of measures and Dirac $\delta_D$ specified above ensure the expressions coincide.
%

Completely analogous results hold for the $\hat{\pi}$ operators and their eigenstates $|g\rangle$, where $g$ varies over the \emph{conjugate} field configuration space $W_{\pi}$ i.e. the space of possible collections $\{g(x)\}_x$ of $\hat{\pi}$ eigenvalues.
We use the \emph{same} energy scale $\mu$ to define adimensional functional measure $Dg$ and states $|g\rangle$ in order to have consistent dimensions in overlaps and change of basis between the $\hat{\phi}$ and $\hat{\pi}$ representations.
%
The two bases have overlap
\begin{align}
    \langle f | g \rangle &= \mathcal{N} e^{\frac{i}{\hbar} \int d^3 x\, f(x) g(x)} = \mathcal{N} e^{\frac{i}{\hbar} \int \frac{d^3 k}{(2\pi)^3} f_k^* g_{k}}\,,
\end{align}
where $\mathcal{N}$ is a (possibly infinite) \emph{adimensional} normalization constant. 
The normalization is multiplied by appropriate powers of $\mu$ according to \eqref{eq:adimensional_measure_state_fock_space} when overlapping explicit dimensionful states like $|\{f_x\}_x\rangle$ or $|\{g_k\}_k\rangle$.
We pass from one basis to the other via a resolution of the identity
\begin{align}
    |g\rangle &= \int_{W_{\phi}}\!\!\! Df\,\, |f\rangle\, \langle f | g \rangle
    = \int_{W_{\phi}}\!\!\! Df\,\, |f\rangle\, \,\,\mathcal{N} e^{\frac{i}{\hbar} \int d^3 x\, f(x) g(x)},
\end{align}
%
The above is confirmed by acting with $\hat{\pi}(t_0,x)=-i\hbar\frac{\delta\,\cdot}{\delta f(x)}$ in the $\hat{\phi}$ representation or with $\hat{\phi}(t_0,x)=i\hbar\frac{\delta\,\cdot}{\delta g(x)}$ in the $\hat{\pi}$ representation, and then possibly integrating by parts in the functional integral.
%
Note the $\hat{\phi}$ and $\hat{\pi}$ \textbf{representations are simply related by a functional Fourier transform}, just like position and momentum representations in ordinary QM.

Given any state $|\Psi\rangle \in \mathcal{F}$, we express it in either basis as
\begin{align}
    |\Psi\rangle &= \int_{W_{\phi}} \!\!\!Df\,\, \,|f\rangle \, \langle f | \Psi \rangle 
    = \int_{W_{\pi}} \!\!\!Dg\,\,\, |g\rangle \, \langle g | \Psi \rangle.
\end{align}
The functionals $\Psi[f] = \langle f | \Psi \rangle$ and $\Psi[g] = \langle g | \Psi \rangle$ are the \emph{wave functionals} of the state $|\Psi\rangle$ in the $\hat{\phi}$ and $\hat{\pi}$ representations respectively.
%
The value $\Psi[f]$ is the probability amplitude density of finding the field with configuration $f$ when the system is in the state $|\Psi\rangle$.
That is, with the above considerations on the explicit representations of the configuration space $W_\phi$ and its measure $Df$, the probability density of finding the field with configuration between $f$ and $f+Df$ is
\begin{align}
    P_{\Psi}(f) \,Df &= |\langle f | \Psi \rangle|^2 \,Df = |\Psi[f]|^2 \,Df.
\end{align}
Analogous considerations hold for $\Psi[g]$ and $P_{\Psi}(\{g(x)\}_x) \,Dg$ in the $\hat{\pi}$ representation.
%
\end{mytheorem}



\begin{mytheorem}[Operators in the field representations.]
%
Just like in ordinary QM, the field operators $\hat{\phi},\,\hat{\pi}$ act as functional multiplication and differentiation in the $\hat{\phi}$ representation, and viceversa in the $\hat{\pi}$ representation, 
\begin{align}
    \hat{\phi}(x) &\to f(x)\, \cdot, \quad
    \hat{\pi}(x) \to -i \hbar \,\frac{\delta}{\delta f(x)}\,\quad \text{on $\hat{\phi}$ eigenstates }\, |f\rangle, \\
    \hat{\pi}(x) &\to g(x)\, \cdot, \quad
    \hat{\phi}(x) \to i \hbar \,\frac{\delta}{\delta g(x)}\,\quad \text{on $\hat{\pi}$ eigenstates } \,|g\rangle.
\end{align}
%
The same is true for the Fourier transformed $\hat{\phi}_k(t)$ and $\hat{\pi}_k(t)$, since they are just linear combinations of the $\hat{\phi}(x)$ and $\hat{\pi}(x)$ operators, with multiplication and \emph{conjugate} differentiation wrt $f_k$ and $g_k$\footnotemark[\getrefnumber{fn:reality_implies_fk_star+minus_fk}]
\begin{align}
    \hat{\phi}_k &\to f_k\, \cdot, \quad
    \hat{\pi}_k \to -i \hbar\, (2\pi)^d \,\frac{\delta\,\cdot}{\delta f^*_{k}}\,\quad \text{on $\hat{\phi}$ eigenstates }\, |f\rangle, \\
    \hat{\pi}_k &\to g_k\, \cdot, \quad
    \hat{\phi}_k \to i \hbar\, (2\pi)^d \,\frac{\delta\,\cdot}{\delta g^*_{k}}\,\quad \text{on $\hat{\pi}$ eigenstates } \,|g\rangle.
\end{align}
%
Note the dimensions of functional derivatives in real and momentum space are, with/out IR regularization,
\begin{align}
    \left[\frac{\delta}{\delta f_x}\right]= \left[\frac{1}{V}\frac{\partial}{\partial f_x}\right]= L^{-d}\,\,[f_x]^{-1}, \quad
    \left[\frac{\delta}{\delta f_k}\right]= \left[\frac{V}{(2\pi)^d} \frac{\partial}{\partial f_k}\right]= L^{d}\, [f_k]^{-1}\,.
\end{align}
%
Implementing the $\hat{\phi}$ and $\hat{\pi}$ operators in any of the two ways indeed reproduces the canonical commutation relations in both real and momentum space (easy check) and thus provides two \emph{unitaryly equivalent} representations of the operator algebra on the Fock space $\mathcal{F}$.

More generally they act on any functional $\Psi[f] = \langle f | \Psi \rangle$ of the field configurations $f$ resp. $g$ as
{\small 
\begin{align}
    \langle f | \hat{\phi}_x | \Psi \rangle &= f_x \Psi[f], \quad \langle f | \hat{\phi}_k | \Psi \rangle = f_k \Psi[f], \quad
    \langle f | \hat{\pi}_x | \Psi \rangle = -i \hbar \frac{\delta}{\delta f_x} \Psi[f], \quad 
    \langle f | \hat{\pi}_k | \Psi \rangle = -i \hbar (2\pi)^d \frac{\delta}{\delta f_k^*} \Psi[f],\\
    \langle g | \hat{\pi}_x | \Psi \rangle &= g_x \Psi[g], \quad \langle g | \hat{\pi}_k | \Psi \rangle = g_k \Psi[g], \quad
    \langle g | \hat{\phi}_x | \Psi \rangle = i \hbar \frac{\delta}{\delta g_x} \Psi[g],\quad \langle g | \hat{\phi}_k | \Psi \rangle = i \hbar (2\pi)^d\frac{\delta}{\delta g_k^*} \Psi[g].
\end{align}
}
In particular, the fields act like this on the \emph{wave functional} $\Psi$ of the system i.e. the one obeying the Schrödinger equation.

In fact, we can represent \emph{any} operator $\hat{O}$ acting on the Fock space in either the $\hat{\phi}$ or $\hat{\pi}$ representation by inserting suitable resolutions of the identity
\begin{align}
    \hat{O}= \int_{W_{\phi}}\!\!\! \!\!Df \int_{W_{\phi}}\!\!\!\!\!Df' \,\,\, |f\rangle\, \langle f | \hat{O} | f' \rangle \langle f' |= \int_{W_{\pi}}\!\!\!\!\!Dg \int_{W_{\pi}} \!\!\!\!\!Dg' \,\,\, |g\rangle\, \langle g | \hat{O} | g' \rangle \, \langle g'|\,.
\end{align}
In particular, in the $\hat{\phi}$ and $\hat{\pi}$ representation, in position and momentum space respectively, the Hamiltonian reads\footnote{\label{fn:reality_implies_fk_star+minus_fk} Recall $\hat{\phi}^\dagger_k=-\hat{\phi}_k$, $\hat{\pi}^\dagger_k=-\hat{\pi}_k$ and $f_k^* = f_{-k}$, $g_k^* = g_{-k}$ by self-adjoint, and each element commutes with its adjoint.}
{\small
\begin{align}
    &\hat{H} = \int d^d x\,\tfrac{1}{2}\left( \hat{\pi}^2_x +  (\nabla \hat{\phi}_x)^2 + m^2 \hat{\phi}^2_x\right)
    = \int \frac{d^d k}{(2\pi)^d}\,\tfrac{1}{2}\left(\hat{\pi}_k^\dagger \hat{\pi}_{k} + (|\mathbf{k}|^2 + m^2) \hat{\phi}_k^\dagger \hat{\phi}_{k}\right)
    \\
    &\to \int d^d x\, \tfrac{1}{2} \left( -\hbar^2 \frac{\delta^2}{\delta f_x^2} + (\nabla_x f_x)^2 + m^2 f_x^2 \right)
    = \int\frac{d^d k}{(2\pi)^d}\, \tfrac{1}{2} \left( -\hbar^2 (2\pi)^{2d}\frac{\delta^2}{\delta f_k \,\delta f_k^*} + (|\mathbf{k}|^2 + m^2) f_{k}^* f_k \right)
    \,\,\, \text{ $\hat{\phi}$ rep. }, \\
    &\to \int d^d x\, \tfrac{1}{2} \left( g_x^2 - \hbar^2 \Big(\nabla_x \frac{\delta}{\delta g_x}\Big)^2 - m^2 \hbar^2 \frac{\delta^2}{\delta g_x^2} \right)
    = \int \frac{d^d k}{(2\pi)^d}\,\tfrac{1}{2} \left( g_{k}^* g_{k} - \hbar^2 (2\pi)^{2d} (|\mathbf{k}|^2 + m^2) \frac{\delta^2}{\delta g_{k}^* \,\delta g_k} \right)
    \,\,\,\text{ $\hat{\pi}$ rep. }.
\end{align}
}
\mbox{Notably, upon IR regularization, Fourier modes become countable discrete with the replacements \eqref{eq:IR_reg_replacements}.}
%
\end{mytheorem} 



%-------------------------------------------------------------------
%=============================================================
\section{Fluctuations of the quantum field}
%=============================================================
%-------------------------------------------------------------------

\begin{mytheorem}[Hilbert spaces for mode $k$ harmonic oscillators of the Klein-Gordon field\questiontag{Check}]
%
When the field $\phi(t,\mathbf{x})$ is expressed in the space variable $\mathbf{x}$ we can identify\footnote{provided the conditions are indeed such that it actually makes sense to talk about particles} a single-particle Hilbert space of the form $\mathcal{H}_1\simeq L^2_{\mathbf{x}}(\R^3)$ and corresponding $n$-particle Hilbert spaces $\mathcal{H}_1^{\otimes^n}$ for excitations with \emph{definite position} $\mathbf{x}$, that is particles.
%
On the other hand, decomposing the Klein-Gordon field into its constituting uncoupled harmonic oscillators $\phi(t,\mathbf{x})\sim \int d^dk\, \phi_k(t)$, we can identify Hilberts spaces $\mathcal{M}_k$ for excitations with \emph{definite momentum} $k$, which allows for a varying number of quanta (particles) i.e. the Hilberts spaces of each harmonic oscillator.
%
The Fock space is equivalently decomposed as direct sum or direct product as
\begin{align}
    \mathcal{F}=\bigoplus_{n=0}^\infty \mathcal{H}_1^{\otimes^n}=\bigotimes_{k\in\substack{\text{field}\\\mathrm{modes}}} \mathcal{M}_k \,.
\end{align}
%
Imposing some IR regularization, Fourier modes $k$ become countable discrete and we have the replacements \eqref{eq:IR_reg_replacements}.

For each mode $k$ we can consider the representations of the Hilbert space $\mathcal{M}_k$ in real or Fourier space\footnote{We would naively call these `position' and `momentum' representations, but this is somewhat a misnomer since `position' rather means the elongation $q_k$ of the oscillator with momentum $k$, which permeates all of physical space, and 'momentum' means the conjugate variable.} i.e. use a basis of eigenvectors of the operators $q_k$ or $p_k$ respectively.
%
For the sake of clarity, since operators have dimensions $[q_k]=E^{-1/2} E^{-d/2}$ and $[p_k]=E^{1/2} E^{-d/2}$ different from ordinary 1D oscillators due to our conventions, we label the two Hilbert bases with truly adimensional variables $\xi_k, \eta_k\in\R$, that is $[\xi_k]=[\eta_k]=E^0$, related to the operators respectively as
\begin{align}
    \begin{cases}
    q_k=\omega_k^{-\frac{1}{2}}\,\tilde{q}_k =\omega_k^{-\frac{1}{2}}\, V^{\frac{1}{2}}\xi_k\,,\\[6pt]
    p_k=\omega_k^{\frac{1}{2}}\,\tilde{p}_k = -i \omega_k^{\frac{1}{2}}\, V^{\frac{1}{2}} \partial_{\xi_k}\,,
    \end{cases}
    \qquad\text{and}\qquad
    \begin{cases}
    q_k=\omega_k^{-\frac{1}{2}}\,\tilde{q}_k = i \omega_k^{-\frac{1}{2}}\, V^{\frac{1}{2}}\partial_{\eta_k}\,,\\[6pt]
    p_k=\omega_k^{\frac{1}{2}}\,\tilde{p}_k = \omega_k^{\frac{1}{2}}\, V^{\frac{1}{2}} \eta_k\,.
    \end{cases}
\end{align}
%
The two orthonormal improper bases are then defined, enforcing $\big[|\xi_k\rangle\big]=\big[|\eta_k\rangle\big]= E^{0}$, as\footnote{Note the dimension of bra/kets is $\big[|X\rangle\big]=[X]^{-1/2}$ as usual in 1D to enforce the 1-dimensional Dirac delta.}
\begin{align}
    &|\xi_k\rangle \equiv \Big(\omega_k^{-\frac{1}{2}}  V^{\frac{1}{2}}\Big)^{\frac{1}{2}}\,|q_k\rangle, \quad \langle \xi_k | \xi_k' \rangle = \delta^{(1)}_D(\xi_k - \xi_k') = \omega_k^{-\frac{1}{2}} V^{\frac{1}{2}}\delta^{(1)}_D(q_k - q_k')\,,
    \\
    &|\eta_k\rangle \equiv \Big(\omega_k^{\frac{1}{2}} V^{\frac{1}{2}}\Big)^{\frac{1}{2}}\, |p_k\rangle,\quad 
    \langle \eta_k | \eta_k' \rangle = \delta^{(1)}_D(\eta_k - \eta_k') = \omega_k^{\frac{1}{2}} V^{\frac{1}{2}}\delta^{(1)}_D(p_k - p_k')\,.
\end{align}
In these bases the operators act as multiplication and differentiation, and viceversa, respectively
\begin{align}
\begin{aligned}
    \hat{q}_k | \xi_k \rangle &= \omega_k^{-\frac{1}{2}} V^{\frac{1}{2}} \xi_k | \xi_k \rangle, \qquad\qquad
    \hat{p}_k | \xi_k \rangle = -i \omega_k^{\frac{1}{2}} V^{\frac{1}{2}} \frac{\partial}{\partial \xi_k} | \xi_k \rangle,
    \\
    \hat{q}_k | \eta_k \rangle &= i \omega_k^{-\frac{1}{2}} V^{\frac{1}{2}} \frac{\partial}{\partial \eta_k} | \eta_k \rangle, \qquad
    \hat{p}_k | \eta_k \rangle = \omega_k^{\frac{1}{2}} V^{\frac{1}{2}} \eta_k | \eta_k \rangle.
\end{aligned}
\end{align}
%
The overlap between the two bases, as confirmed by acting explicitly with either operator, is
\begin{align}
    \langle \xi_k | \eta_k \rangle &= V^{\frac{1}{2}}\langle q_k | p_k \rangle = \tfrac{1}{2\pi}e^{i \xi_k\eta_k}= \frac{V^{\frac{1}{2}}}{(2\pi)}e^{i \frac{q_k p_k}{V}}.
\end{align}

In the real representation, the \emph{normalized} wave function of the $n_k$th excited state $|n_k\rangle$ is
\begin{align}
    \langle \xi_{k} | n_k \rangle 
     &= \frac{1}{\sqrt{n_k!}}\Big[\tfrac{1}{\sqrt{2}}\big(\xi_k-\partial_{\xi_k}\big)\Big]^{n_k} \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_k^2} 
     \\
     &=:  \frac{1}{\sqrt{2^{n_k}n_k!}} H_{n_k}(\xi_k) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_k^2}
     \\
     &= \frac{1}{\sqrt{2^{n_k}n_k!}} H_{n_k}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}q_k$}) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}V^{-1} \omega_k q_k^2}\,.
\end{align}
In the conjugate representation the \emph{normalized} wave function of $|n_k\rangle$ reads
\begin{align}
    \langle \eta_{k} | n_k \rangle 
     &= \frac{1}{\sqrt{n_k!}}\Big[\tfrac{(-i)}{\sqrt{2}}\big(\eta_k-\partial_{\eta_k}\big)\Big]^{n_k} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_k^2} 
     \\
     &=: \frac{(-i)^{n_k}}{\sqrt{2^{n_k}n_k!}} H_{n_k}(\eta_k) \cdot \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_k^2}
     \\
     &= \frac{1}{\sqrt{2^{n_k}n_k!}} H_{n_k}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}p_k$}) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}V^{-1} \omega_k^{-1} p_k^2}\,.
\end{align}
%
This is just the Fourier transform of the previous expression, as confirmed explicitly by inserting a resolution of the identity and the explicit overlap between the two bases.
Indeed, since $\xi_k\mapsto i \partial_{\eta_k}$ and $\partial_{\xi_k} \mapsto i \eta_k$ under Fourier transform, we find
\begin{align}
    \langle \eta_{k} | n_k \rangle 
     &= \int \!d \xi_k \, \,\langle \eta_k | \xi_k \rangle \,\,\langle \xi_k | n_k \rangle
     \\
     &= \int_\R\!\!\! d\xi_k\, \,\tfrac{1}{2\pi}e^{-i \xi_k\eta_k} \,\,\underbrace{\frac{1}{\sqrt{n_k!}}\Big[\tfrac{1}{\sqrt{2}}\big(\xi_k-\partial_{\xi_k}\big)\Big]^{n_k} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_k^2}}_{= \frac{1}{\sqrt{2^{n_k}n_k!}} H_{n_k}\!(\xi_k) \cdot \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_k^2}}
     \\
     &= \int_\R\!\!\!  d\xi_k\, \tfrac{1}{2\pi}e^{-i \xi_k\eta_k} \frac{1}{\sqrt{n_k!}}\Big[(-i)\tfrac{1}{\sqrt{2}}\big(\eta_k-\partial_{\eta_k}\big)\Big]^{n_k} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_k^2}
     \\
     &= \frac{(-i)^{n_k}}{\sqrt{n_k!}}\Big[\tfrac{1}{\sqrt{2}}\big(\eta_k-\partial_{\eta_k}\big)\Big]^{n_k} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} \int_\R\!\!\!  d\xi_k\, \tfrac{1}{2\pi}e^{-i \xi_k\eta_k}  e^{-\frac{1}{2}\xi_k^2}
     \\
     &= \frac{(-i)^{n_k}}{\sqrt{n_k!}}\Big[\tfrac{1}{\sqrt{2}}\big(\eta_k-\partial_{\eta_k}\big)\Big]^{n_k} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_k^2}
     \\
     &=: \frac{(-i)^{n_k}}{\sqrt{2^{n_k}n_k!}} H_{n_k}(\eta_k) \cdot \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_k^2}
     \\
     &= \frac{(-i)^{n_k}}{\sqrt{2^{n_k}n_k!}} H_{n_k}\!(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}p_k$}) \cdot \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}V^{-1} \omega_k^{-1} p_k^2}\,.
\end{align}
%
Beware the above expressions are normalized as $\int d\xi_k |\langle \xi_k | n_k \rangle|^2 = 1$ and $\int d\eta_k |\langle \eta_k | n_k \rangle|^2 = 1$.
The corresponding expressions whose square integrate to unity against $\int dq_k$ or $\int dp_k$ are instead
\begin{align}
    \langle q_{k} | n_k \rangle &= \left(V^{-\frac{1}{2}} \omega_k^{\frac{1}{2}}\right)^{\frac{1}{2}} \langle \xi_{k} | n_k \rangle\,, \qquad\text{and}\qquad
    \langle p_{k} | n_k \rangle = \left(V^{-\frac{1}{2}} \omega_k^{-\frac{1}{2}}\right)^{\frac{1}{2}} \langle \eta_{k} | n_k \rangle\,.
\end{align}


Finally we compute the wave function for the Fourier transformed field 
\begin{align}
    \hat{\phi}_k=\tfrac{1}{\sqrt{2}}\Big[ \big(\hat{q}_k+\hat{q}_{-k}\big) + \tfrac{i}{\omega_k}\big(\hat{p}_k - \hat{p}_{-k}\big) \Big]\quad \text{acting on}\quad \mathcal{M}_k\oplus \mathcal{M}_{-k}\,.
\end{align}
%
The operator $\hat{\phi}_k$ is \emph{not} self-adjoint, but it is \emph{normal}, so that we can still find a Hilbert basis of  $\mathcal{M}_k\oplus \mathcal{M}_{-k}$ made of eigenstates $|f_k\rangle$ of $\hat{\phi}_k$ with \emph{complex} eigenvalues $f_k\in\C$.
%
Indeed it is sufficient to consider a spectral basis for the two self-adjoint \emph{commuting} operators
\begin{align}
    \hat{X}_k := \frac{1}{\sqrt{2}} ({q}_k + {q}_{-k} ), \quad
    \hat{Y}_k := \frac{1}{\omega_k}\frac{1}{\sqrt{2}} ({p}_k - {p}_{-k} ), \quad
    [\hat{X}_k, \hat{Y}_k]=0\,.
\end{align}
Joint eigenstates $|x_k, y_k\rangle$ of $\hat{X}_k$ and $\hat{Y}_k$ with real eigenvalues $x_k, y_k\in\R$ are also eigenstates of $\phi_k$ with complex eigenvalues $f_k = x_k + i y_k\in\C$.
%

Practically it is convenient to work with the two \emph{rotated} harmonic oscillators 
\begin{align}
    &Q_+ := \frac{1}{\sqrt{2}} (q_k + q_{-k}), \quad P_+ := \frac{1}{\sqrt{2}} (p_k + p_{-k}), \quad a_+^{(\dagger)} := \frac{1}{\sqrt{2}} (a_k^{(\dagger)} + a_{-k}^{(\dagger)})\,,
    \\
    &Q_- := \frac{1}{\sqrt{2}} (q_k - q_{-k}), \quad P_- := \frac{1}{\sqrt{2}} (p_k - p_{-k})\,\quad a_-^{(\dagger)} := \frac{1}{\sqrt{2}} (a_k^{(\dagger)} - a_{-k}^{(\dagger)})\,.
\end{align}
%
The rotated oscillators {\small $(Q_+, P_+)$} and {\small $(Q_-, P_-)$} are still decoupled since {\small $[Q_+, P_-]=[Q_-, P_+]=0$} i.e. {\small $[a_+, a_-]=[a_+, a_-^{\dagger}]=0$}.
%
Denoting $\mathcal{M}_{\pm}^{(k)}$ the Hilbert spaces of the two rotated oscillators, the total Hilbert space decomposes as
\begin{align}
     \mathcal{M}_k \otimes \mathcal{M}_{-k} \equiv \mathcal{M}^{(k)}_+ \otimes \mathcal{M}_-^{(k)}\,.
\end{align}
%
The two vacua conincide {\small $|0_k, 0_{-k}\rangle \equiv |0_+, 0_-\rangle$}, while pure tensor states of the original and rotated oscillators are related by Clebsch-Gordan coefficients as
{\small
\begin{align}
    |n_k, n_{-k}\rangle &:= \frac{(a_k^{\dagger})^{n_k}}{\sqrt{n_k!}} \frac{(a_{-k}^{\dagger})^{n_{-k}}}{\sqrt{n_{-k}!}} |0_k, 0_{-k}\rangle
    \\
    &= \frac{1}{\sqrt{n_k!\, n_{-k}!}} \left( \frac{a_+^{\dagger} + a_-^{\dagger}}{\sqrt{2}} \right)^{n_k} \left( \frac{a_+^{\dagger} - a_-^{\dagger}}{\sqrt{2}} \right)^{n_{-k}} |0_+, 0_-\rangle
    \\
    &= \frac{1}{\sqrt{n_k!\, n_{-k}!}} \frac{1}{{2^{(n_k + n_{-k})/2}}}\sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l} (a_+^{\dagger})^{m+l}\, (a_-^{\dagger})^{n_k + n_{-k} - (m+l)} |0_+, 0_-\rangle
    \\
    &=: \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}\sqrt{\frac{(m+l)!\, (n_k + n_{-k} - (m+l))!}{n_k!\, n_{-k}!\, 2^{(n_k+n_{-k})}}}\,\,| m+l, n_k + n_{-k} - (m+l)\rangle_{\pm}\,.
\end{align}
}

Mimicking the above treatment for the mode $k$ oscillator, denote adimensional variables
\begin{align}
    \begin{cases}
        \xi_+ := V^{-\frac{1}{2}} \omega_k^{\frac{1}{2}} Q_+ = \frac{1}{\sqrt{2}}(\xi_k + \xi_{-k}),\\
        \eta_+ := V^{-\frac{1}{2}} \omega_k^{-\frac{1}{2}} P_+ = \frac{1}{\sqrt{2}}(\eta_k + \eta_{-k}),
    \end{cases}
    \qquad\text{and}\qquad
    \begin{cases}
        \xi_- := V^{-\frac{1}{2}} \omega_k^{\frac{1}{2}} Q_- = \frac{1}{\sqrt{2}}(\xi_k - \xi_{-k}), \\
        \eta_- := V^{-\frac{1}{2}} \omega_k^{-\frac{1}{2}} P_- = \frac{1}{\sqrt{2}}(\eta_k - \eta_{-k})\,.
    \end{cases}
\end{align}
%
We find corresponding spectral bases for the operator $Q_{\pm}$ or $P_{\pm}$ in the Hilbert space $\mathcal{M}_{\pm}$ of the first (resp. second) rotated oscillator 
\begin{align}
    &|\xi_{\pm}\rangle \equiv \left(\omega_k^{-\frac{1}{2}} V^{\frac{1}{2}}\right)^{\frac{1}{2}}|Q_{\pm}\rangle, \quad
     \langle \xi_{\pm} | \xi_{\pm}' \rangle = \delta^{(1)}_D(\xi_{\pm} - \xi_{\pm}') = \omega_k^{-\frac{1}{2}} V^{\frac{1}{2}}\delta^{(1)}_D(Q_{\pm} - Q_{\pm}')\,,
    \\
    &|\eta_{\pm}\rangle \equiv \left(\omega_k^{\frac{1}{2}} V^{\frac{1}{2}}\right)^{\frac{1}{2}} |P_{\pm}\rangle,\quad
    \langle \eta_{\pm} | \eta_{\pm}' \rangle = \delta^{(1)}_D(\eta_{\pm} - \eta_{\pm}') = \omega_k^{\frac{1}{2}} V^{\frac{1}{2}}\delta^{(1)}_D(P_{\pm} - P_{\pm}')\,.
\end{align}
%
In these representations the wave functions for rotated oscillators read
\begin{align}
    \langle \xi_{\pm} | n_{\pm} \rangle & = \frac{1}{\sqrt{n_{\pm}!}}  \Big[\tfrac{1}{\sqrt{2}}\big(\xi_\pm-\partial_{\xi_\pm}\big)\Big]^{n_\pm} \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_{\pm}^2}
    =\frac{1}{\sqrt{2^{n_{\pm}} \,n_{\pm}!}} H_{n_{\pm}}(\xi_{\pm}) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_{\pm}^2}\,,
    \\
    \langle \eta_{\pm} | n_{\pm} \rangle &= \frac{1}{\sqrt{n_{\pm}!}} \Big[\tfrac{(-i)}{\sqrt{2}}\big(\eta_\pm-\partial_{\eta_\pm}\big)\Big]^{n_\pm} \left(\tfrac{1}{\pi}\right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_{\pm}^2}
    = \frac{(-i)^{n_{\pm}}}{\sqrt{2^{n_{\pm}} \,n_{\pm}!}} H_{n_{\pm}}(\eta_{\pm}) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_{\pm}^2}\,.
\end{align}
%
We are interested in tensor states $|\xi_+\rangle \otimes |\eta_-\rangle$ that is eigenstates of $\hat{\phi}_k$ of the form\footnote{Note the dimension of bra/kets is $\big[|f_k\rangle \big]= [f_k]^{-1}$ as usual in 2D to enforce the 2-dimensional Dirac delta.}
\begin{align}
    |f_k\rangle := \Big(V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\Big)\, |\xi_+\rangle \otimes |\eta_-\rangle,\qquad
    \hat{\phi}_k |f_k\rangle =  f_k |f_k\rangle\, = V^{\frac{1}{2}} \omega_k^{-\frac{1}{2}}\, (\xi_+ + i \eta_-)\, |f_k\rangle\,.
\end{align}
%
Note these states have overlaps
\begin{align}
    \langle f_k | f_k' \rangle &= \frac{\omega_k}{V} \langle \xi_+ | \xi_+' \rangle \cdot \langle \eta_- | \eta_-' \rangle 
    = \frac{\omega_k}{V} \,\delta^{(1)}_D(\xi_+ - \xi_+') \, \delta^{(1)}_D(\eta_- - \eta_-')
    = \delta^{(2)}_D(f_k - f_k')\,
\end{align}
and yields resolutions of the identity on $\mathcal{M}_+ \otimes \mathcal{M}_{-}= \mathcal{M}_k \otimes \mathcal{M}_{-k}$ as
\begin{align}
    \mathbb{I}_{\mathcal{M}_k \otimes \mathcal{M}_{-k}} 
    &= \int_{\R^2} \!d\xi_+ d\eta_-\,\,\, |\xi_+, \eta_- \rangle\, \langle \xi_+, \eta_- |
    = \int_{\C}\!\!d^2 f_k \,\, |f_k\rangle \, \langle f_k |\,.
\end{align}
%
The wave function for the state $|n_+,n_-\rangle_{\pm}$ of rotated oscillators in the mixed\footnote{in the sense that these are joint eigenstate of $Q_+$ and $P_-$} representation $|f_k\rangle$ of $\mathcal{M}_{k}\otimes \mathcal{M}_{-k}\equiv \mathcal{M}_{+}\otimes \mathcal{M}_{-}$ is given by 
\begin{align}
    \langle \xi_+,\eta_-| n_+, n_- \rangle_{\pm} 
    &= \langle \xi_+ | n_+ \rangle \cdot \langle \eta_- | n_- \rangle
    \\
    &= \frac{1}{\sqrt{2^{n_+} \,n_+!}} H_{n_+}\!(\xi_+) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\xi_{+}^2} \cdot \frac{(-i)^{n_-}}{\sqrt{2^{n_-} \,n_-!}} H_{n_-}\!(\eta_-) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{4}} e^{-\frac{1}{2}\eta_{-}^2}
    \\
    &= \frac{(-i)^{n_-}}{\sqrt{2^{(n_+ + n_-)} \,n_+!\, n_-!}} H_{n_+}\!(\xi_+)\, H_{n_-}\!(\eta_-) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{2}} e^{-\frac{1}{2}(\xi_{+}^2 + \eta_{-}^2)}\,.
\end{align}
%
The wave function for the state $|n_k, n_{-k}\rangle$ of original oscillators in the $|f_k\rangle$ representation is obtained by inserting a resolution of the identity in the rotated basis or equivalently using the Clebsch-Gordan coefficients above,
{\small
\begin{align}
    \langle \xi_+,\eta_- | n_k, n_{-k} \rangle 
    &= \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}\sqrt{\frac{(m+l)!\, (n_k + n_{-k} - (m+l))!}{n_k!\, n_{-k}!\, 2^{(n_k+n_{-k})}}}\,\,\langle \xi_+,\eta_- | m+l, n_k + n_{-k} - (m+l)\rangle_{\pm}
    \\
    &= \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}\sqrt{\frac{(m+l)!\, (n_k + n_{-k} - (m+l))!}{n_k!\, n_{-k}!\, 2^{(n_k+n_{-k})}}}
    \\
    &\quad \times \frac{(-i)^{n_k + n_{-k} - (m+l)}}{\sqrt{2^{(n_k + n_{-k})} \,(m+l)!\, (n_k + n_{-k} - (m+l))!}} H_{m+l}(\xi_+)\, H_{n_k + n_{-k} - (m+l)}(\eta_-) \cdot \left( \tfrac{1}{\pi} \right)^{\frac{1}{2}} e^{-\frac{1}{2}(\xi_{+}^2 + \eta_{-}^2)}
    \\
    &= \left( \tfrac{1}{\pi} \right)^{\frac{1}{2}} e^{-\frac{1}{2}(\xi_{+}^2 + \eta_{-}^2)} \frac{1}{\sqrt{n_k!\, n_{-k}!}} \frac{1}{2^{(n_k + n_{-k})}} 
    \\
    &\qquad\times \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l} (-i)^{n_k + n_{-k} - m-l} H_{m+l}(\xi_+)\, H_{n_k + n_{-k} - m-l}(\eta_-)
\end{align}
}
%
Again beware that the above expression is normalized as $\int_{\R^2} \!d\xi_+ d\eta_-\, |\langle \xi_+, \eta_- | n_k, n_{-k} \rangle|^2 = 1$, rather than wrt $\int_{\C} \!d^2\!f_k$.
%
The probability amplitude (density) of measuring the value $f_k=V^{\frac{1}{2}}\omega_k^{-\frac{1}{2}}(\xi_+ + i \eta_-)\in\C$ for the Fourier transformed field $\hat{\phi}_k$ when the two original oscillators with modes $\pm k$ are in the state $|n_k, n_{-k}\rangle$ is then
{\small
\begin{align}
    \langle f_k | n_k, n_{-k} \rangle &= \Big(V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\Big) \langle \xi_+, \eta_- | n_k, n_{-k} \rangle
    \\
    &= \Big(\frac{\omega_k}{V}\Big)^{\frac{1}{2}} \Big( \frac{1}{\pi} \Big)^{\frac{1}{2}} 
    e^{-\frac{\omega_k}{2V}|f_k|^2} \frac{1}{\sqrt{n_k!\, n_{-k}!}} \frac{1}{2^{(n_k + n_{-k})}}
    \\
    &\qquad\times \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l} (-i)^{n_k + n_{-k} - m-l} H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Re}f_k$})\, H_{n_k + n_{-k} - m-l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Im}f_k$})\,.
\end{align}
}
%
The corresponding probability density of finding the value $f_k\in\C$ for the field $\hat{\phi}_k$ is simply the modulus squared of the above expression 
{\small
\begin{align}
    &P_{n_k, n_{-k}}(f_k) \,d^2\!f_k = |\langle f_k | n_k, n_{-k} \rangle|^2 \,d^2\!f_k\,
    \\
    &=\! \Big(\frac{\omega_k}{V \pi}\Big) 
    e^{-\frac{\omega_k}{V} |f_k|^2} \frac{1}{2^{2(n_k + n_{-k})}n_k!\, n_{-k}!} 
    \left| \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \!\binom{n_k}{m}\! \binom{n_{-k}}{l}  H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Re}f_k$})\, H_{n_k + n_{-k} - m-l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Im}f_k$}) \right|^2\! \!d^2\!f_k.
\end{align}
}
% 
This expression is independent of the phase of $f_k$ since the sum $\sum_{m,\,l}$ is invariant under the exchange of $\text{Re}f_k \leftrightarrow \text{Im}f_k$.
%
Changing variables $d^2\!f_k = d\text{Re}f_k\, d\text{Im}f_k = |f_k|\, \,d|f_k|\, d\text{arg}(f_k)$, we red off the joint probability density for modulus $|f_k|$ and argument $\arg(f_k)$ as
\begin{align}
    P_{n_k, n_{-k}}(|f_k|,\arg(f_k)) \,d|f_k|\,d\text{arg}(f_k) 
    = P_{n_k, n_{-k}}(f_k) \,d^2\!f_k \,\, \Rightarrow \,\,
    P_{n_k, n_{-k}}(|f_k|,\arg(f_k)) &= |f_k| \, P_{n_k, n_{-k}}(f_k)\,.
\end{align}
%
The probability density for the angle { $\arg(f_k)$} is thus uniform in {$[0, 2\pi)$}, while the probability density for the modulus $|f_k|$ is obtained integrating over the angle
{
\begin{align}
    P_{n_k, n_{-k}}(|f_k|) 
    =& \int_0^{2\pi} \!\!\!\!d\text{arg}(f_k) \,\,\, P_{n_k, n_{-k}}(|f_k|,\arg(f_k)) 
    \\
    =&
    \Big(\frac{\omega_k}{V\,\pi}\Big) \, |f_k| \, e^{-\frac{\omega_k}{V} |f_k|^2} 
    \frac{1}{2^{2(n_k + n_{-k})}\,n_k!\, n_{-k}!}
    \\
    &\times\int_0^{2\pi} \!\!\!\!\!\!d\text{arg}(f_k)\,\,
    \left| \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}  H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Re}f_k$})\, H_{n_k + n_{-k} - m-l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Im}f_k$}) \right|^2 \,.
\end{align}
}
%
\end{mytheorem}


\begin{mytheorem}[Fluctuations of the Klein-Gordon field \questiontag{Check}]
%
Having decomposed the Klein-Gordon field into its constituting uncoupled harmonic oscillators and found the corresponding wave functions, we now compute the field fluctuations i.e. the probability of finding a given set of Fourier modes $\{f_k\}_k$ or equivalently field values $\{f(x)\}_x$ when the Fock space $\mathcal{F}$ is in a given state $|\Psi\rangle$.
%
We could consider the vacuum state $|0\rangle$ where all oscillators are in their ground state, excited states $|n_{k_1}\dots n_{k_m}\dots \rangle$ with $n_k$ quanta in the mode $k$, coherent states $|\{\alpha_k\}\rangle$ or arbitrary entangled states.
%
Indeed the Fock space decomposes as\footnote{Here $k\geq0$ is a shorthand to denote a given choice of modes to avoid the double sum over $\pm k$.}
\begin{align}
    \mathcal{F}= \bigotimes_{k\in\mathrm{modes}}\mathcal{M}_k = \bigotimes_{k\geq 0}\Big(\mathcal{M}_k\otimes\mathcal{M}_{-k}\Big)
    =\bigotimes_{k\geq 0}\Big(\underbrace{\mathcal{M}^{(k)}_+\otimes\mathcal{M}^{(k)}_-}_{\equiv \mathcal{M}_k\otimes\mathcal{M}_{-k}}\Big)\,.
\end{align}
We have a Hilbert basis of the Fock space made of common eigenvectors of the \emph{commuting normal} operators $\{\hat{\phi}_k(t_0)\}_{k}$ as $f$ varies over all field possible field configurations\footnote{cf. the discussion on $\hat{\phi}$ eigenstates in the next section.}
\begin{align}
    |f\rangle \equiv |\{f(x)\}_x\rangle\equiv |\{f_k\}_k\rangle := \otimes_k |f_k\rangle, \qquad \hat{\phi}_{k}(t_0) |f\rangle = f_{k} \,|f\rangle\,, \,\, f_{k}\in\C\, \quad \forall k\in\text{Fourier modes.}
\end{align}
The corresponding resolution of the identity on the total Fock space reads
\begin{align}
    \mathbb{I}_{\mathcal{F}} = \int Df \,\, |f\rangle \langle f| = \prod_{k\geq0} \int_{\C} d^2\!f_k \,\, |f_k\rangle \langle f_k |
\end{align}
where $Df=\prod_{k\geq0} d^2\!f_k=\prod_{{x}\in\R^3}df(x)$ is the formal product of Lebesgue measures over all Fourier modes or equivalently all space values.
%

Impose some IR regularization, so that Fourier modes $k$ are countable discrete and Fourier trasnforms change as discussed in \eqref{eq:IR_reg_replacements} above.
%
Assume the field is in the pure tensor state with $n_k$ quanta in the mode $k$ i.e. the harmonic oscillator labelled by $k$ is in the $n_k$-th excited state,
\begin{equation}
    |\Psi\rangle \equiv |n_{k_1}\dots n_{k_m}\dots \rangle.
\end{equation}
%
Since each mode $k$ is independent, the wave functional in the $|f\rangle$ representation of total space $\mathcal{F}$ factorizes as the product of wave functions for each mode pair $\pm k$,
\begin{align}
     \Psi\big[f\big]\equiv \langle f |n_{k_1}\dots n_{k_m}\dots \rangle = \prod_{k\geq0} \langle f_k | n_{k},n_{-k} \rangle\,.
\end{align}
%
The probability density of finding a given field configuration $f$, i.e. a set of Fourier modes $\{f_k\}_k$ or equivalently space values $\{f(x)\}_x$, when the field is in the state $|n_{k_1}\dots n_{k_m}\dots \rangle$ is thus
\begin{align}
    P_{\Psi}(f)\, Df &= |\Psi[f]|^2 \,\,Df= \prod_{k\geq0}\, \left|\langle f_k | n_{k},n_{-k} \rangle\right|^2\,\,d^2\!f_k
    \\
    &=\!
    \prod_{k\geq0}     
    \left( \frac{\omega_k}{V\pi} \right) e^{-\frac{\omega_k}{V} |f_k|^2} \frac{1}{2^{2(n_k + n_{-k})}n_k!\, n_{-k}!} 
    \\
    &\qquad \times
    \left| \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}  H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Re}f_k$})\, H_{n_k + n_{-k} - m-l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{\frac{1}{2}}\text{Im}f_k$}) \right|^2\! \!d^2\!f_k\,.
\end{align}
The expression is again independent of the phases of $f_k$.
%

Finally, write a general state as a superposition of pure tensor states $|\{n_k\}_k\rangle$ with a definite number of quanta
\begin{align}
    |\Psi\rangle = \sum_{\{n_k\}} c_{\{n_k\}} | \{n_k\} \rangle\quad\text{with}\quad\sum_{\{n_k\}} |c_{\{n_k\}}|^2 = 1\,.
\end{align} 
The wave functional and corresponding probability density read
\begin{align}
    \Psi[f] = \sum_{\{n_k\}} c_{\{n_k\}} \prod_{k\geq0} \langle f_k | n_{k},n_{-k} \rangle\,,\quad
    P_{\Psi}(f)\, Df = |\Psi[f]|^2 \,Df\,.
\end{align}
%
\end{mytheorem}


\begin{mytheorem}[Wave functional \& fluctuations of th Klein-Gordon field with other BCs.\todotag{Do it.}]
%
For the sake of completeness, we sketch how the above arguments change if we consider different boundary conditions \eqref{eq:other_BCs_IR_regulated_field} for the IR-regulated field making its Fourier transfor still self-adjoint, so that we do not need to pair modes $\pm k$.
\end{mytheorem}


\begin{mytheorem}[Measuring the field fluctuations.\todotag{Finish}]
%
We have computed the wave functional of a given state in the $\hat{\phi}$ representation and thus the probability density of the field configuration at a given time $t_0$.
We can now draw random realizations or expectations valus of the field and functionals thereof at this time $t_0$ according to this probability density.

The outcomes are of course sensitive to the chosen state $|\Psi\rangle$ of the field.
For example if we choose a state $|0\dots n_\mathbf{k}\dots\rangle$ with a single excited mode $\mathbf{k}$, the field fluctuations will display a characteristic wavelength $\lambda = \frac{2\pi}{|\mathbf{k}|}$, a phase preference depending on the wave vector $\hat{\mathbf{k}}$ that result in a net trend in this direction, and an average amplitude increasing with $n_\mathbf{k}$.

\begin{wrapfigure}[16]{r}{0.45\textwidth} % 14 = lines to wrap; adjust as needed
    \centering
    \vspace{-0.5\baselineskip}            % optional: nudge up
    \includegraphics[width=0.35\textwidth]{images/field_fluctuations.png}
    \label{fig:field_fluctuations}
    \caption{2d level curves of a stochastic realization of $|\phi(t_0,\mathbf{x})|$ in the ground state.}
    %\includegraphics[width=0.30\textwidth,height=5cm,keepaspectratio]{images/lake_fourier.png}
\end{wrapfigure}
We remark the outcomes are also highly sensitive to the spacetime dimension $d+1$.
In particular fluctuations $\sim |\phi(t_0,\mathbf{x})|^2$ gets more and more divergent in the UV for increasing $d$ (cf. the discussion on the two-point function in Section \ref{sec:two_point_function_QFT}). 
Finally they will show a characteristic behavior close to the boundary of space depending on the BCs  imposed during the IR regularization e.g. amplitudes will die off for Dirichlet BCs.

For example we can draw a random realization of the field $\phi(t_0, \mathbf{x})$ for each space point $\mathbf{x}\in\R^d$ according to the above probability density $P_{\Psi}(f)$ above for a given state $|\Psi\rangle$ and then plot its amplitude $|\phi(t_0,\mathbf{x})|$ or its argument $\arg(\phi(t_0,\mathbf{x}))$.
Figure \ref{fig:field_fluctuations} shows 2d level curves of $|\phi(t_0,\mathbf{x})|$ for the ground state
$|\Psi\rangle = |0\rangle$.
We see that there is indeed no preference for the scale of fluctuations.
A plot of the argument would confirm it is uniformly distributed in $[0,2\pi)$.

We can also compute expectations values of suitable (local or global) observable functionals $\mathcal{O}[\phi]$ of the field at time $t_0$ as
\begin{align}
    \langle \Psi | \mathcal{O}[\hat{\phi}(t_0)] | \Psi \rangle
    = \int \!Df \,\,\, |\langle f | \Psi \rangle|^2 \,\, \mathcal{O}[f]\,.
\end{align}
%
For example we can compute the expectation value of the field or its powers at a given space point $\mathbf{x}$ as
\begin{align}
    \langle \Psi | \hat{\phi}^n(t_0, \mathbf{x}) | \Psi \rangle
    = \int \!Df \,\,\, |\langle f | \Psi \rangle|^2 \,\, f^n(\mathbf{x})\,.
\end{align}
%
\end{mytheorem}
% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=0.3\textwidth]{images/field_fluctuations.png}
%     \label{fig:field_fluctuations}
%     \caption{2d level curves of a stochastic realization of $|\phi(t_0,\mathbf{x})|$ in the ground state.}
% \end{figure}





\begin{mytheorem}[Wave functional \& fluctuations of the conjugate field $\pi$.\questiontag{check it}]
%
The above arguments are immediately applied to the conjugate field $\pi$.
Sticking to the above treatment \eqref{eq:relations_fields_creation_operators_harmonic_oscillator_var} with periodic BCs, the field is decomposed as
\begin{align}
    \hat{\pi}(x,t_0) &= \int \frac{d^3\bar{k}}{(2\pi)^3}\, e^{i\bar{k}\cdot\bar{x}} \hat{\pi}_k(t_0)
    = : \int \frac{d^3\bar{k}}{(2\pi)^3} \frac{1}{\sqrt{2\omega_k}} \left( -i \omega_k a_k e^{i \bar{k}\cdot\bar{x}} + i \omega_k a_k^{\dagger} e^{- i \bar{k}\cdot\bar{x}} \right)\,,
\end{align}
%
and we identify
\begin{align}
\begin{aligned}
    \pi_k(t_0) &= -i \sqrt{\frac{\omega_k}{2}} (a_k - a_{-k}^{\dagger}) 
    = \tfrac{1}{\sqrt{2}}\Big[ \big({p}_k + {p}_{-k}\big) -i\,\omega_k\big({q}_k-{q}_{-k}\big)\Big].
\end{aligned}
\end{align}
%
As above we recast the Hilbert space $\mathcal{M}_k\otimes \mathcal{M}_{-k} \equiv \mathcal{M}_+^{(k)} \otimes \mathcal{M}_-^{(k)}$ for the two oscillators with modes $k, -k$ into that for rotated oscillators $(Q_{\pm}, P_{\pm})$, and identify adimensional variables $\xi_{\pm}, \eta_{\pm}$.
A spectral basis for $\hat{\pi}_k$ with eigenvalues $g_k=V^{\frac{1}{2}} \omega_k^{\frac{1}{2}}\, ( \eta_+ - i \xi_-)$ is now given by tensor states\footnote{Again note bra/kets have dimension $\big[|g_k\rangle\big]=[g_k]^{-1}$ in 2D to enforce the 2-dimensional Dirac delta.}
\begin{align}
    |g_k\rangle := \Big(V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}\Big)\, |\eta_+\rangle \otimes |\xi_-\rangle\,,\qquad
    \hat{\pi}_k |g_k\rangle = g_k |g_k\rangle\, = V^{\frac{1}{2}} \omega_k^{\frac{1}{2}}\, ( \eta_+ - i \xi_-)\, |g_k\rangle\,.
\end{align}
%
We have overlaps and corresponding resolutions of the identity
\begin{align}
    &\langle g_k | g_k' \rangle= \frac{1}{V\omega_k} \langle \eta_+ | \eta_+' \rangle \cdot \langle \xi_- | \xi_-' \rangle 
    = \frac{1}{V\omega_k} \,\delta^{(1)}_D(\eta_+ - \eta_+') \, \delta^{(1)}_D(\xi_- - \xi_-')
    = \delta^{(2)}_D(g_k - g_k')\,,
    \\
    &\mathbb{I}_{\mathcal{M}_+ \otimes \mathcal{M}_{-}} 
    = \int_{\R^2} \!d\eta_+ d\xi_-\,\,\, |\eta_+, \xi_- \rangle\, \langle \eta_+, \xi_- |
    = \int_{\C}\!\!d^2 g_k \,\, |g_k\rangle \, \langle g_k |\,.
\end{align}
%
The wave function for the state $|n_k, n_{-k}\rangle$ of original oscillators in the $|g_k\rangle$ representation is obtained similarly as
{\small
\begin{align}
    \langle g_k | n_k, n_{-k} \rangle 
    &= \Big(\frac{1}{\omega_k V}\Big)^{\frac{1}{2}} \Big( \frac{1}{\pi} \Big)^{\frac{1}{2}} 
    e^{-\frac{1}{2V}\frac{1}{\omega_k} |g_k|^2} \frac{1}{\sqrt{n_k!\, n_{-k}!}} \frac{1}{2^{(n_k + n_{-k})}}
    \\
    &\qquad\times \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l} (-i)^{m+l} H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}\text{Re}\,g_k$})\, H_{n_k + n_{-k} - m-l}(-\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}\text{Im}\,g_k$})\,.
\end{align}
}
%
The probability density of measuring the value $g_k=V^{\frac{1}{2}}\omega_k^{\frac{1}{2}}( \eta_+ - i \xi_-)$ for the conjugate field $\hat{\pi}_k$ when the two original oscillators with modes $\pm k$ are in the state $|n_k, n_{-k}\rangle$ is then\footnote{The minus sign inside the argument of $H_{n_k+n_{-k}-m-l}$ drops since Hermite polynomials are odd/even.}
{\small
\begin{align}
    P_{n_k, n_{-k}}(g_k) \,d^2\!g_k &= |\langle g_k | n_k, n_{-k} \rangle|^2 \,d^2\!g_k\,
    \\
    &=\! \Big(\frac{1}{\omega_k V \pi}\Big) 
    e^{-\frac{1}{V \omega_k} |g_k|^2} \frac{1}{2^{2(n_k + n_{-k})}n_k!\, n_{-k}!} 
    \\
    & \quad\times
    \left| \sum_{m=0}^{n_k} \sum_{l=0}^{n_{-k}} \binom{n_k}{m} \binom{n_{-k}}{l}  H_{m+l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}\text{Re}g_k$})\, H_{n_k + n_{-k} - m-l}(\text{\scriptsize $V^{-\frac{1}{2}}\omega_k^{-\frac{1}{2}}\text{Im}g_k$}) \right|^2\! \!d^2\!g_k.
\end{align}
}
The expression is again independent of the phase of $g_k$, so that $\arg(g_k)$ is uniformly distributed in $[0,2\pi)$.

In complete analogy with the field $\phi$, decompose the Fock space as $\mathcal{F}= \bigotimes_{k\geq 0}(\mathcal{M}_k\otimes\mathcal{M}_{-k})$ and consider the spectral basis of common eigenstates of all conjugate field modes $\hat{\pi}_k$,
\begin{align}
    |g\rangle \equiv |\{g(x)\}_x\rangle\equiv |\{g_k\}_k\rangle := \otimes_k |g_k\rangle, \qquad \hat{\pi}_{k}(t_0) |g\rangle = g_{k} \,|g\rangle\,, \,\, g_{k}\in\C\, \quad \forall k\in\text{Fourier modes.}
\end{align}
The wave functional and corresponding probability density of finding a given configuration $g$ of the conjugate field, i.e. a given set of Fourier modes $\{g_k\}_k$ or equivalently field values $\{g(x)\}_x$, when the field is in the state $|n_{k_1}\dots n_{k_m}\dots \rangle$ read
\begin{align}
     \Psi\big[g\big]\equiv \langle g |n_{k_1}\dots n_{k_m}.. \rangle = \prod_{k\geq0} \langle g_k | n_{k},n_{-k} \rangle\,,\quad\text{and}\quad
    P_{\Psi}(g)\, Dg &= |\Psi[g]|^2 \,\,Dg= \prod_{k\geq0}\, \left|\langle g_k | n_{k},n_{-k} \rangle\right|^2\,\,d^2\!g_k\,,
\end{align}
where $Dg=\prod_{k\geq0} d^2\!g_k=\prod_{{x}\in\R^3}dg(x)$ is the functional measure in the configuration space of the conjugate field.
General superposition of pure states $|\{n_k\}_k\rangle$ with a definite number of quanta are treated as above.
%
\end{mytheorem}



\begin{mytheorem}[Solving the Schrödinger equations in the $\hat{\phi}$ representation\todotag{Fix \& finish}]
We can explicitly solve the Schrödinger equation in QFT for the free Klein-Gordon field in the $\hat{\phi}$ representation.
The Hamiltonian operator is reported above.
The time-dependent Schrödinger equation reads, possibly after IR regularization,
\begin{align}
    i \hbar \frac{\partial}{\partial t} \Psi[t; f] &= \int \frac{d^dk}{(2\pi)^d}\, \tfrac{1}{2} \left( -\hbar^2 (2\pi)^{2d}\frac{\delta^2}{\delta f_k \,\delta f_k^*} + (|\mathbf{k}|^2 + m^2) f_{-k} f_k \right) \Psi[t; f]
    \\
    &=\frac{1}{V}\sum_k \tfrac{1}{2} \left( -\hbar^2 V^2\frac{\partial^2}{\partial f_k \,\partial f_k^*} + (|\mathbf{k}|^2 + m^2) f_{-k} f_k \right) \Psi[t; f]
    \\
    &= \sum_{k\geq0} \left( -\hbar^2V\frac{\partial^2}{\partial f_k \,\partial f_k^*} + \frac{1}{V}(|\mathbf{k}|^2 + m^2) |f_k|^2 \right) \Psi[t; f]\,.
\end{align}
We can solve it by separation of variables, writing the wave functional as a product over Fourier modes\footnote{Here $k\geq0$ is shorthand to denote we do \emph{not} double count over $\pm k$.}
\begin{align}
    \Psi[t; f] = \prod_{k\geq 0} \psi_k(t; f_k, f_k^*).
\end{align}
Plugging this into the Schrödinger equation, we obtain a separate equation for each Fourier mode pair $\pm k$
\begin{align}
    i \hbar \frac{\partial}{\partial t} \psi_k(t; f_k, f_k^*) &= \left( -\hbar^2V\frac{\partial^2}{\partial f_k \,\partial f_k^*} + \frac{1}{V}(|\mathbf{k}|^2 + m^2) |f_k|^2 \right)\,\psi_k(t; f_k, f_k^*)\,.
\end{align}
Each of these equations is formally identical to the Schrödinger equation of a 2D \emph{complex} quantum harmonic oscillator with mass $m=1$ and frequency $\omega_k = \sqrt{|\mathbf{k}|^2 + m^2}$, with complex elongation $V^{-1/2}f_k$.
Writing as before
\begin{align}
    f_k= V^{1/2}\omega_k^{-1/2}(\xi_+ + i\eta_-)
\end{align}
we obtain two decoupled real harmonic oscillators in the adimensional variables $\xi_+$ and $\eta_-$ with frequency $\omega_k$,
\begin{align}
    i \hbar \frac{\partial}{\partial t} \psi_k(t; \xi_+,\eta_-) &= \frac{2\omega_k}{2}\omega_k\left( -\partial_{\xi_+}^2 - \partial_{\eta_-}^2 + (\xi_+^2 + \eta_-^2) \right)\,\psi_k(t; \xi_+,\eta_-)\,.
\end{align}
%
The eigenfunctions are then
\begin{align}
    &\langle \xi_+,\eta_-| n_+, n_- \rangle = \frac{1}{\sqrt{2^{n_+ + n_-} n_+! n_-!}} H_{n_+}\left( \xi_+ \right) H_{n_-}\left( \eta_- \right) \Big(\frac{1}{\pi}\Big)\,e^{-\frac{1}{2} (\xi_+^2 + \eta_-^2)}\,,\\
    &\quad\text{with}\quad H_k |n_+,n_-\rangle = 2\hbar \omega_k (n_+ + n_- + 1) |n_+, n_-\rangle\,.
\end{align}
%
The corresponding solution 

The solutions are thus well-known energy eigenstates
\begin{align}
    \psi_{n_k}(t; f_k, f_k^*) &= \left( \frac{\omega_k}{\pi \hbar} \right)^{1/4} \frac{1}{\sqrt{2^{n_k} n_k!}} H_{n_k}\left( \sqrt{\frac{\omega_k}{\hbar}} f_{k} \right) e^{-\frac{\omega_k}{2\hbar} f_{k}^2} e^{-i E_{n_k} t/\hbar}, \quad
    E_{n_k} = \hbar \omega_k \left( n_k + \tfrac{1}{2} \right), \quad n_k = 0, 1, 2, \dots
\end{align}
The general solution of the Schrödinger equation is thus
\begin{align}
    \Psi[t; f] &= \prod_k \psi_{n_k}(t; f_k, f_k^* ) 
    = \prod_k \left( \frac{\omega_k}{\pi \hbar} \right)^{1/4} \frac{1}{\sqrt{2^{n_k} n_k!}} H_{n_k}\left( \sqrt{\frac{\omega_k}{\hbar}} f_{k} \right) e^{-\frac{\omega_k}{2\hbar} f_{k}^2} e^{-i E_{n_k} t/\hbar}.
\end{align}
This solution corresponds to the Fock space state
\begin{align}
    |\Psi\rangle = \bigotimes_k |n_k\rangle,
\end{align}
i.e. the state with $n_k$ particles in the mode $k$ for all $k$.
%
\end{mytheorem}


\begin{mytheorem}[Solving the Heisenberg equations in the $\hat{\phi}$ representation\todotag{Fix \& finish}]
%
Alternatively, we can solve the Heisenberg equations of motion for the free Klein-Gordon field in the $\hat{\phi}$ representation.
The Heisenberg equation for the field operator reads
\begin{align}
    \frac{\partial}{\partial t} \hat{\phi}(t, x) &= \frac{1}{i \hbar} [\hat{\phi}(t, x), \hat{H}] = \hat{\pi}(t, x), \\
    \frac{\partial}{\partial t} \hat{\pi}(t, x) &= \frac{1}{i \hbar} [\hat{\pi}(t, x), \hat{H}] = (\nabla^2 - m^2) \hat{\phi}(t, x).
\end{align}
Combining these two equations, we obtain the Klein-Gordon equation for the field operator
\begin{align}
    (\partial_t^2 - \nabla^2 + m^2) \hat{\phi}(t, x) = 0.
\end{align}
We can solve this equation by expanding the field operator in Fourier modes
\begin{align}
    \hat{\phi}(t, x) = \int \frac{d^3k}{(2\pi)^3} e^{i \mathbf{k} \cdot \mathbf{x}} \hat{\phi}_k(t).
\end{align}
Plugging this into the Klein-Gordon equation, we obtain a separate equation for each Fourier mode
\begin{align}
    \frac{d^2}{dt^2} \hat{\phi}_k(t) + \omega_k^2 \hat{\phi}_k(t) = 0, \quad \omega_k = \sqrt{|\mathbf{k}|^2 + m^2}.
\end{align}
Each of these equations is formally identical to the equation of motion of a single quantum harmonic oscillator with frequency $\omega_k$.
The solutions are thus well-known
\begin{align}
    \hat{\phi}_k(t) &= \hat{a}_k e^{-i \omega_k t} + \hat{a}_k^\dagger e^{i \omega_k t}, \\
    \hat{\pi}_k(t) &= -i \hbar \omega_k \left( \hat{a}_k e^{-i \omega_k t} - \hat{a}_k^\dagger e^{i \omega_k t} \right).
\end{align}
The operators $\hat{a}_k$ and $\hat{a}_k^\dagger$ are the annihilation and creation operators for the mode $k$, satisfying the commutation relations
\begin{align}
    [\hat{a}_k, \hat{a}_{k'}^\dagger] = (2\pi)^3 \delta^{(3)}(k - k'), \quad [\hat{a}_k, \hat{a}_{k'}] = 0, \quad [\hat{a}_k^\dagger, \hat{a}_{k'}^\dagger] = 0.
\end{align}
%
\end{mytheorem}




%------------------------------------------------------------------
%======================================================================
\section{Particles, coherent states \& interactions}
%======================================================================
%------------------------------------------------------------------

We would like to identify states in the Fock space $\mathcal{F}$ that correspond to a given number of particles in a given mode, as well as coherent states that approximate classical field configurations.

We anticipate that indeed is not always the case that creation operators $a_k^{\dagger}$ create a particle in the mode $k$ when acting on a given state, nor that number operators $N_k = a_k^{\dagger} a_k$ count the number of particles in the mode $k$.
The most immediate example is indeed given by squeezed states aka coherent states of the second kind, that are superpositions of different number eigenstates and do not have a well-defined number of particles in any mode.


%=======================================================================
\subsection{States of the field}
%=======================================================================



%=======================================================================
\subsection{Exciting the KG field}
%=======================================================================


%------------------------------------------------------------
\subsubsection{Semiclassical treatment made rigorous}
%------------------------------------------------------------

\begin{mytheorem}[A single electron in a classical electromagnetic field\todotag{Expand \& finish}]
%
Consider a first quantized electron described moving into a classical electromagnetic field $A_{\mu}$.
The Lagrangian density for this system is given by...
\end{mytheorem}
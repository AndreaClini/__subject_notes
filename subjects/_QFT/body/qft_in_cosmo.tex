% !TeX root = ../QFT_main.tex
%=========================================================
%=========================================================
\chapter{Quantum Field Theory in Curved Spacetime}\label{ch:qft_in_curved_spacetime}
%========================================================
%=========================================================


\section{Initial consideration} \todotag{Finish \& remove sec header}

\begin{mytheorem}[How to formulate QFT in curved spacetime?\questiontag{Polish}]
%
QFT in curved spacetime requires a careful rethinking of our approach.
Indeed canonical quantization is performed in Hamiltonian formalism, which requires a global time coordinate to define conjugate variables and then equal-time commutation relations.
The Hamiltonian formalism is thus coordinate-dependent by definition, and \emph{would seem} doomed to fail in curved spacetime.
We should find a way to quantization that ultimately preserves covariance and yields the same physics.

To develop the intuition, note that we are used familiar expressions for the lagrangian or hamiltonian in flat spacetime because we always use inertial `rectangular' coordinates related by global Lorentz transformations.
In other coordinates e.g. polar ones, the expressions for $\mathcal{L}$ and $\mathcal{H}$ would be different (and possibly more complicated) even in flat spacetime, but the physics would be the same.
This suggests how to proceed: we should recast the lagrangian density $\sqrt{|g|}\mathcal{L}$ in a covariant form, that is \emph{formally} invariant under change of coordinates in flat spacetime, and then promote it to arbitrary spacetimes by replacing the Minkowski metric with a general one and partial derivatives with covariant ones.

Having a Lagrangian formulation valid in curved spacetime, we can then derive the Hamiltonian formulation by choosing a coordinate system and a time slicing.
Beware the expressions for $\mathcal{H}$ and the conjugate field $\pi$ do depend on this choice.
While this seems to break covariance, in facts it only hides it.
Indeed, regardless of the coordinate choice and corresponding expressions, combining the two hamilton equations for $\phi$ and its coordinate-dependent conjugate field $\pi$ gives back the covariant Euler--Lagrange equations
\begin{align}
  \begin{cases}
    \frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H}{\delta \pi(t,\mathbf{x})}, \\
    \frac{\partial \pi(t,\mathbf{x})}{\partial t} = -\frac{\delta H}{\delta \phi(t,\mathbf{x})},
  \end{cases} \quad \Leftrightarrow \quad \nabla_\mu \left(\tfrac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)}\right) - \tfrac{\partial \mathcal{L}}{\partial \phi} = 0.
\end{align}
Alternatively, we can formulate QFT directly in Lagrangian formalism via path integrals, which is manifestly covariant and does not require singling out a time coordinate.

The resulting quantum theories are completely equivalent since they have the same Dyson--Schwinger equations for correlators.
But the path integral approach is practically more powerful since it extends beyond the perturbative regime.
The two procedures are summarized in the following diagram.
\vspace{2mm}

\begin{tikzpicture}[
  font=\small,
  >=Stealth,
  block/.style={
    draw=blue!60!black,
    rounded corners=2pt,
    thick,
    fill=blue!8,
    text width=5.1cm,
    align=center,
    inner sep=5pt
  },
  lab/.style={
    font=\scriptsize,
    align=center,
    text=blue!70!black,
    fill=white,
    fill opacity=0.9,
    text opacity=1,
    inner sep=1.5pt
  },
  arr/.style={->, thick, draw=black},
  equiv/.style={<->, thick, draw=black}
]
\matrix (m) [matrix of nodes, row sep=16mm, column sep=38mm, nodes={block}] {
  |[name=srH ]| {SR, classical field theory\\Hamiltonian formalism}
    & |[name=srL ]| {SR, classical field theory\\Lagrangian formalism} \\
  |[name=grHc]| {GR, classical field theory\\Hamiltonian formalism}
    & |[name=grLc]| {GR, classical field theory\\Lagrangian formalism} \\
  |[name=grHq]| {GR, QFT\\Hamiltonian formalism\\(Canonical quantization)}
    & |[name=grLq]| {GR, QFT\\Lagrangian formalism\\(Path integral QFT)} \\
};
% Top row
\draw[equiv] (srH) -- node[lab, above]{Legendre transform} node[lab, below]{equivalence} (srL);
% Middle row
\draw[arr]  (srL) -- node[lab, right] {allow curvature\\\& make covariant} (grLc);
\draw[equiv] (grHc) -- node[lab, above]{Legendre transform} node[lab, below]{equivalence} (grLc);
% Bottom row
\draw[arr] (grHc) -- node[lab, left] {canonical\\quantization} (grHq);
\draw[arr] (grLc) -- node[lab, right] {path\\integral} (grLq);
\draw[equiv] (grHq) -- node[lab, above]{same Dyson--Schwinger eqs\\ for correlators} node[lab, below]{equivalence} (grLq);
\end{tikzpicture}
%
\end{mytheorem}


\begin{mytheorem}[Hamiltonian as generator of time translations \& different foliations\todotag{Polish \& understand better}]
%
The above analysis clarifies that for any given choice $F$ spacetime foliation $\mathcal{M}\simeq \R\times \Sigma$ with coordinates $x^\mu$, the corresponding hamiltonian $H_F=\int_\Sigma d^3\mathbf{x}\,\mathcal{H}_F$  is the generator of time translations along the chosen time coordinate $t\equiv x^0$.
Indeed the \emph{classical} hamilton equations in the chosen coordinates $(t,\mathbf{x})$ read
\begin{align}
  &\frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H_F}{\delta \pi_F(t,\mathbf{x})}, \quad
  \frac{\partial \pi_F(t,\mathbf{x})}{\partial t} = -\frac{\delta H_F}{\delta \phi(t,\mathbf{x})},\quad\text{and more generally }\quad \frac{\partial \mathcal{O}}{\partial t} = \{\mathcal{O}, H_F\}\quad \forall\,\, \text{field}\,\,\mathcal{O}.
\end{align}
At the quantum level, replacing $\{\,,\,\}\mapsto -\frac{i}{\hbar}[\,,\,]$ and time-evolving operators in the Heisenberg picture
\begin{equation}
  \frac{\partial \hat{\mathcal{O}}}{\partial t} = -\frac{i}{\hbar} [\hat{\mathcal{O}}(t), \hat{H}_F]\quad \forall \,\,\text{field operator}\,\, \hat{\mathcal{O}}.
\end{equation}
In both classical and quantum cases, this shows that $H_F$ is the generator of the time evolution operator parametrized wrt the chosen coordinate time $t$, that is
\begin{align}
  &U(t,t_0) = \mathcal{T}\exp\left(-\frac{i}{\hbar}\int_{t_0}^t \!\! dt' H_F(t')\right)\,.
\end{align}
A different choice $\tilde{F}$ of coordinates and foliation  $\mathcal{M}\simeq \R\times \tilde{\Sigma}$ yields a different hamiltonian $H_{\tilde{F}}$ generating time translations along the corresponding time $\tilde{t}\equiv \tilde{x}^0$.

If the two foliations are \emph{equivalent}, i.e. fixed-time leaves are mapped into each other by the change of coordinates, \todotag{Not sure what if $\tilde{t}=\tilde{t}(t,\mathbf{x})$ i.e. leaves not map into each other?}
\begin{align}
  \R\times \Sigma \simeq\mathcal{M}\simeq  \tilde{\R}\times \tilde{\Sigma} \quad \text{via}\quad (t,\mathbf{x}) \mapsto (\tilde{t}(t), \tilde{\mathbf{x}}(t,\mathbf{x})), \quad \text{so that}\quad \Sigma_t \mapsto \tilde{\Sigma}_{\tilde{t}(t)},
\end{align}
the Hilbert spaces $\mathcal{H}=\bigotimes_n L^2(\Sigma,\C)^{\otimes^n}$ of the two quantum theories are isomorphic (resp. the fixed-time function spaces $\mathcal{C}(\Sigma_t,\R)$ in the classical case) and so must be the time evolution of their states and operators, provided we evolve across corresponding time intervals $[t_1,t_2]$ and $[\tilde{t}_1,\tilde{t}_2]$ with $\tilde{t}_j:=\tilde{t}(t_j)$.
If $\chi_t: \mathcal{H}_F \to \mathcal{H}_{\tilde{F}}$ is the isomorphism between the two Hilbert spaces (resp. classical spaces) induced by the coordinate change $\mathbf{x}\mapsto \tilde{\mathbf{x}}(t,\mathbf{x})$ at time $t$, the corresponding time evolutions obey
{\small
\begin{equation}
  \chi_{t_2} \circ U_F(t_2,t_1)\circ \chi_{t_1}^{-1} 
  = \chi_{t_2} \circ \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{t_1}^{t_2} dt' H_F(t')\right)\circ \chi_{t_1}^{-1}
  = \mathcal{T}\exp\left( -\frac{i}{\hbar}\int_{\tilde{t}(t_1)}^{\tilde{t}(t_2)} d\tilde{t}' H_{\tilde{F}}(\tilde{t}')\right)
  = U_{\tilde{F}}(\tilde{t}_2,\tilde{t}_1)\,.
\end{equation}
}
If the coordinate change does not mix time and space $(t,\mathbf{x})\mapsto (\tilde{t}(t),\tilde{\mathbf{x}}(\mathbf{x}))$, the isomorphism bewteen Hilbert (resp. classical) spaces $\chi_t\equiv \chi$ is time-independent, and we can thus take it to be the identity upon changing spatial coordinates in one frame, so that we have the same leaves $\Sigma_t=\tilde{\Sigma}_{\tilde{t}(t)}$ at all times.
The two hamiltonians and time evolutions then act on the \emph{same} Hilbert space, and we simply have a time change relation
{\small
\begin{align}
  H_F(t) = \tfrac{d\tilde{t}}{dt} H_{\tilde{F}}(\tilde{t}(t)), \quad
  U_F(t_2,t_1) = \mathcal{T}\exp\bigg( -\frac{i}{\hbar}\int_{t_1}^{t_2} dt' H_F(t')\bigg)
  = \mathcal{T}\exp\bigg( -\frac{i}{\hbar}\int_{\tilde{t}(t_1)}^{\tilde{t}(t_2)} d\tilde{t}' H_{\tilde{F}}(\tilde{t}')\bigg)
  = U_{\tilde{F}}(\tilde{t}_2,\tilde{t}_1).
\end{align}
}

Finally, the above analysis also allows for a temporary period where the two foliations $F$ and $\tilde{F}$ are inequivalent, e.g. during a gravitational collapse or other highly dynamical spacetime process, as long as spacetime is asymptotically stationary in the past and future.
That is the coordinate change $(t,\mathbf{x})\mapsto \tilde{t}=\tilde{t}(t,\mathbf{x})$ does not map leaves of the foliations into each other for some time interval $[t_i,t_f]$, but does so asymptotically for $t\to \pm\infty$.
In this case, we can relate the two Hilbert (resp. classical) spaces and corresponding time evolutions via the isomorshisms $\chi_t$ as above only in the asymptotic regions $t<t_i$ and $t>t_f$, and define $S$-matrix like operators mapping states (resp. classical configurations) from one foliation to the other across the dynamical period.
\end{mytheorem}



%==================================================================================
\subsection{Canonical quantization of the Klein-Gordon field}
%==================================================================================

To fix ideas we consider below the case of quintessence scalar field, but the analysis extends to any field theory in curved spacetime.

\begin{mytheorem}[Metric induced on spatial leaves $\R\times\Sigma_t$\todotag{Finish}]
%
Choose a spacetime foliation $\mathcal{M}\simeq \R\times\Sigma$.
In adapted coordinates $x^\mu=(t,\mathbf{x})$ i.e. $\Sigma_t=\{x^0=t\}$, the outward (positive-time oriented) normal $n^\mu$ and the metric induced on spatial leaves $\Sigma$ obey
{\small
\begin{align}\label{eq:metric_induced_spatial_leaves_folitation}
    n^\mu = \frac{g^{0\mu}}{\sqrt{g^{00}}}, \quad \text{and}\quad
    \begin{pmatrix}
      n^0 & 0\\
      n^i & \delta^i_j
    \end{pmatrix}^T
    g_{\mu\nu}
    \begin{pmatrix}
      n^0 & 0\\
      n^i & \delta^i_j
    \end{pmatrix}= \begin{pmatrix}
      1 & 0\\
     0 & g_{|\Sigma\, ij}
    \end{pmatrix}\quad \Rightarrow \quad \sqrt{g} = \frac{1}{n^0}\sqrt{g_{|_\Sigma}}= \sqrt{g^{00}}\sqrt{g_{|_\Sigma}}.
\end{align}
}
The inverse of the spatial metric $g_{|\Sigma}$ can then be written as
{\small
\begin{align}\label{eq:inverse_metric_induced_leaves_foliation}
    g_{|\Sigma}^{ij}= g^{ij} - \tfrac{g^{i0}g^{0j}}{g^{00}},\quad\text{since}\quad
    \sum_{i=1}^n \underbrace{g_{ai}}_{=g_{|\Sigma\, ai}} \Big(g^{ib} - \tfrac{g^{i0}g^{0b}}{g^{00}}\Big) = (\delta_a^b - g_{a0} g^{0b}) -\big(\underbrace{\delta_a^0}_{=0} - g_{a0} g^{00}\big) \tfrac{g^{0b}}{g^{00}}= \delta_a^b\,.
\end{align}}
Beware that $g_{|\Sigma}^{ij}$ is negative definite in our mostly minus signature convention.
\end{mytheorem}


\begin{mytheorem}[Hamiltonian formulation of scalar field in curved spacetime\todotag{Finish}]
Consider the action for a scalar field, possibly with nonminimal coupling to gravity $\xi\neq0$, and choose a spacetime foliation $\mathcal{M}\simeq \R\times\Sigma_t$ with adapted coordinates $x^\mu=(t,\mathbf{x})$,
{\small
\begin{align}
    S[\phi] = \int d^4x\, \sqrt{|g|} \left( \frac{1}{2} g^{\mu\nu} \nabla_\mu \phi \nabla_\nu \phi - V(\phi) - \xi R \phi^2 \right) = \int dt \underbrace{\int_{\Sigma_t} d^3\mathbf{x}\, \sqrt{|g|} \left( \frac{1}{2} g^{\mu\nu} \nabla_\mu \phi \nabla_\nu \phi - V(\phi) - \tfrac{\xi}{2} R \phi^2 \right)}_{=\int d\mathbf{x}\sqrt{|g|}\, \mathcal{L}\,\,=  \, L(t)}.
\end{align}}
\vspace{-4mm}

\noindent
The conjugate field in these coordinates is then\footnote{Note for spin fields $\phi^\star_\bullet$ we would need to subtract terms $\sim \phi^\star_{\bullet} \Gamma_{0\star}^\bullet \subset $ to extract $\dot{\phi}^\star_\bullet\subset \nabla_0\phi$.}
{\small
\begin{align}
    &\pi(t,\mathbf{x}) = \frac{\delta L(t)}{\delta \dot{\phi}(t,\mathbf{x})}= \frac{\partial\big(\sqrt{g}\, \mathcal{L}(t,\mathbf{x})\big)}{\partial \dot{\phi}(t,\mathbf{x})} = \sqrt{|g|} g^{0\nu} \nabla_\nu \phi(t,\mathbf{x}) = \sqrt{|g|} \Big( g^{00} \,\nabla_0\phi(t,\mathbf{x}) + g^{0j} \,\nabla_{\!j} \phi(t,\mathbf{x}) \Big)\\
    & \quad \Rightarrow \quad \dot{\phi}(t,\mathbf{x}) = \frac{1}{\sqrt{g}\, g^{00}} \Big( \pi(t,\mathbf{x}) - \sqrt{g}\, g^{0j} \partial_j\phi(t,\mathbf{x}) \Big).
\end{align}}
Using \eqref{eq:metric_induced_spatial_leaves_folitation} the conjugate field may also be written in terms of the unit time-oriented normal and induced metric on spatial leaves as
\begin{align}
  \pi = \sqrt{g}\,g^{0\mu}\,\nabla_\mu\phi= \sqrt{g_{|\Sigma}}\, \frac{g^{0\mu}}{\sqrt{g^{00}}} \nabla_\mu \phi = \sqrt{g_{|\Sigma}}\, n^\mu \nabla_\mu \phi.
\end{align}
The hamiltonian \emph{density} is then
{\small
\begin{align}
    \mathcal{H}(t,\mathbf{x}) &= \pi(t,\mathbf{x}) \dot{\phi}(t,\mathbf{x}) - \sqrt{g}\,\,\mathcal{L}(t,\mathbf{x}) 
    = \frac{1}{\sqrt{g}} \frac{\pi^2}{g^{00}} - \frac{g^{0j}}{g^{00}}\, \pi\, \partial_j\phi - \frac{\sqrt{g}}{2} \Big(\underbrace{g^{ij} - \tfrac{g^{i0}g^{0j}}{g^{00}}}_{=\, g_{|\Sigma}^{ij}}\Big)\partial_i\phi\,\partial_j\phi + \sqrt{g}\,V(\phi) + \sqrt{g}\,\tfrac{\xi}{2} R \phi^2,
\end{align}}
where the inverse metric $g_{|\Sigma}^{ij}$ induced on spatial slices \eqref{eq:inverse_metric_induced_leaves_foliation} is negative definite in our convention, thus contributing positive kinetic energy to the hamiltonian.
The hamiltonian is $\displaystyle H(t) = \int_\Sigma d^n\mathbf{x}\,\,\, \mathcal{H}(t,\mathbf{x})$.
The classical hamilton equations are
\begin{align}
    &\frac{\partial \phi(t,\mathbf{x})}{\partial t} = \frac{\delta H(t)}{\delta \pi(t,\mathbf{x})} = \frac{1}{\sqrt{g} g^{00}}\, \pi - \frac{g^{0j}}{g^{00}}\, \partial_j \phi\,, \\
    &\frac{\partial \pi(t,\mathbf{x})}{\partial t} = -\frac{\delta H(t)}{\delta \phi(t,\mathbf{x})} = -\partial_j \Big(\tfrac{g^{0j}}{g^{00}}\pi\Big) - \partial_j \left( \sqrt{g}\,\big(g^{ij}-\tfrac{g^{i0}g^{j0}}{g^{00}}\big)\nabla_i \phi\right) - \sqrt{g}\, \tfrac{dV}{d\phi} - \sqrt{g}\,\xi\,  R \phi\,.
\end{align}
Combining them, recalling $\tfrac{1}{\sqrt{g}}\partial_\mu(\sqrt{g}\, X^\mu)=\nabla_\mu X^\mu$, gives back the covariant Euler--Lagrange equations
\begin{align}
    \nabla_\mu \left( \frac{\partial \mathcal{L}}{\partial (\nabla_\mu \phi)} \right) - \frac{\partial \mathcal{L}}{\partial \phi} = (\nabla_\mu \nabla^\mu + \partial_\phi V + \xi R) \phi = 0.
\end{align}
%
\end{mytheorem}


\begin{mytheorem}[Sympetic structure of the classical phase space]
%
Consider the space of $\R$-valued (smooth, vanishing at \emph{spatial} infinity) solutions of the Klein-Gordon equation
\begin{align}\label{eq:real_space_KG_solutions}
    \mathcal{S}_\R = \{ \phi \in C^\infty_0(\mathcal{M},\R) \mid (\nabla_\mu \nabla^\mu + \partial_\phi V + \xi R) \phi = 0 \}.
\end{align}
In the free case $V(\phi) = \frac{1}{2} m^2 \phi^2$ this is a real vector space, and we can naturally endow it with a symplectic form $\omega$ making $(\mathcal{S}_\R, \omega)$ the classical phase space of the theory.


Fix a foliation $\mathcal{M}\simeq \R\times \Sigma$ with adapted coordinates $x^\mu=(t,\mathbf{x})$.
The symplectic form is defined in several equivalent ways, independent of \emph{equivalent} spacetime foliations\footnote{This is crucial, since the solution space $\mathcal{S}_\R$ is fully covariant, and thus the symplectic form should not depend on the coordinates.} and the specific time of the Cauchy surface $\Sigma_t$ chosen to evaluate it.
Namely, for $\phi_1, \phi_2 \in \mathcal{S}_\R$, we have the following equivalent definitions
\begin{align}
    \omega(\phi_1, \phi_2) &= \int_\Sigma \star d\phi_1 \, \phi_2 - \phi_1 \, \star d\phi_2
    =\int_\Sigma \star \big(J^{12}_\mu\, dx^\mu\big) \\
    &= \int_\Sigma \sqrt{|g|}\, g^{\alpha\beta}\Big(\partial_\beta \phi_1 \phi_2- \phi_1 \partial_\beta \phi_2\Big)\, \epsilon_{\alpha \mu_1\dots\mu_n}\,\frac{1}{n!}\,\, dx^{\mu_1}\wedge \cdots \wedge dx^{\mu_n} \\
    &= \int_\Sigma i_{J_{{12}}}\Omega_g\\
    &= \int_\Sigma \Omega_{g_{|\Sigma}}\, n^\mu \Big(\partial_\mu \phi_1 \,\phi_2- \phi_1 \,\partial_\mu \phi_2\Big) = \int_\Sigma \underbrace{d^n\mathbf{x}\,\sqrt{g_{|_\Sigma}}}_{\equiv \,\Omega_{g_{|\Sigma}}}\,\, g(n, J_{{12}}),
\end{align}
\vspace{-4mm}

\noindent
where $n^\mu$ is the unit outward (positive-time oriented) normal to the spatial slice $\Sigma^{(n)}$ and it is always intended that the $n$-form is pulled back to $\Sigma^{(n)}$ before integration (except for the last case, where it is already done explicitly). 
Using \eqref{eq:metric_induced_spatial_leaves_folitation}, the symplectic form then takes the familiar form in terms of conjugate fields
{\small
\begin{align}
    \omega(\phi_1, \phi_2) &= 
    \int_\Sigma \!\!\! d^n\mathbf{x}\,\,\sqrt{g_{|_\Sigma}}\,\,\, \tfrac{g^{0\mu}}{\sqrt{g^{00}}} \Big( \partial_\mu \phi_1(t,\mathbf{x}) \,\phi_2(t,\mathbf{x}) - \phi_1(t,\mathbf{x})\, \partial_\mu \phi_2(t,\mathbf{x}) \Big)\\
    &=\int_\Sigma \!\!d^n\mathbf{x}\, \,\Big( \pi_1(t,\mathbf{x})\,\phi_2(t,\mathbf{x}) - \phi_1(t,\mathbf{x})\, \pi_2(t,\mathbf{x}) \Big), \quad\text{for}\quad \pi(t,\mathbf{x})=\frac{\delta L(t)}{\delta (\partial_t\phi)} = \sqrt{g}\, \,g^{0\mu}\, \partial_\mu \phi(t,\mathbf{x}).
\end{align}}

The \emph{conserved} current is defined as
\begin{align}
    J^{12}_\mu \, dx^\mu:= \nabla \phi_1 \, \phi_2 - \phi_1 \, \nabla \phi_2 = \big(d\phi_1\phi_2 - \phi_1 d\phi_2\big), \quad \nabla_\mu J^\mu_{12} = 0\,,
\end{align}
and is conserved since both fields satisfy the \emph{free}\footnote{It is indeed crucial the theory is free $V(\phi)=a+b\phi+c\phi^2$ for the cancellation to occur bewteen the two fields.} Klein--Gordon equation \eqref{eq:real_space_KG_solutions}.
This follows from $\nabla_\mu big(\nabla^\mu \phi_1 \, \phi_2 - \phi_1 \, \nabla^\mu \phi_2\big)=0$, and the explicit expression for the Hodge dual or the expression via (co)-differentials for the Laplace operator $\nabla_\mu\nabla^\mu=\Box = d\delta + \delta d \equiv \delta d$ for the Laplace operator on 0-forms
\begin{align}
  &\star J = \sqrt{g}\, J^\mu \,\epsilon_{\mu\alpha_1\dots\alpha_n} \,\frac{1}{n!} \,dx^{\alpha_1}\wedge \cdots \wedge dx^{\alpha_n} \quad \Rightarrow \quad d\star J = \partial_\nu(\sqrt{g} J^\nu)\,d^{n+1}\!x  =  \nabla_\nu J^\nu\,\sqrt{g}\, d^{n+1}\!x =0,\\[3pt]
  &d \star J = d \star d\phi_1 \, \phi_2 - d \star d\phi_2 \, \phi_1 = \star\!\!\!\!\!\!\!\!\!\underbrace{\delta d\,\phi_1}_{=(\delta d+d\delta)\phi = \Box \phi_1}\!\!\!\!\!\!\!\!\!\phi_2 -\phi_1\,\, \star\delta d\phi_2 =0\\
\end{align}
\vspace{-7mm}

\noindent
The \textbf{symplectic form} is \textbf{independent of \emph{equivalent} foliations}, that is $\mathcal{M}\simeq \R\times \Sigma \simeq \tilde{\R}\times \tilde{\Sigma}$ with coordinate change $(t,\mathbf{x})\mapsto (\tilde{t}(t), \tilde{\mathbf{x}}(t,\mathbf{x}))$ mapping leaves into each other, and the specific time $t$ of the Cauchy surface $\Sigma_t$ chosen to evaluate it.
Indeed by current conservation and Gauss theorem
\begin{align}
    \int_{\Sigma_{t_1}}\!\!\!\!\star J \,\,- \int_{\Sigma_{t_2}}\!\!\!\! \star J 
    = \int_{\partial\big([t_1,t_2]\times \Sigma\big)} \!\!\!\!\!\!\star J
    = \int_{[t_1,t_2]\times \Sigma} d \!\star\! J =0.
\end{align}
More generally, for equivalent foliations $\mathcal{M}\simeq \R\times \Sigma \simeq \tilde{\R}\times \tilde{\Sigma}$ and two times $t_1$ and $\tilde{t}_2=\tilde{t}(t_2)$ we proceed the same considering the spacetime region bounded by $\Sigma_{t_1}$ and $\tilde{\Sigma}_{\tilde{t}_2}$.

The symplectic space is naturally promoted to a Poisson space by defining the Poisson bracket of two functionals $F_1, F_2: \mathcal{S}_\R \to \R$ as
\begin{align}
    \{F_1, F_2\} = \omega(X_{F_1}, X_{F_2}),
\end{align}
where the hamiltonian vector field $X_F$ associated to a functional $F$ is defined by enforcing
\begin{align}
    \omega(X_F(\phi), Y) := dF_{|\phi}(Y) \quad \forall\, Y \in T_\phi \mathcal{S}_\R \simeq \mathcal{S}_\R.
\end{align}

Finally we complexify the space of solutions 
\begin{align}
    \mathcal{S}_\C = \{ \phi \in C^\infty_0(\mathcal{M},\C) \mid (\nabla_\mu \nabla^\mu + 2\partial_\phi V + \xi R) \phi = 0 \} = \mathcal{S} \otimes_\R \C
\end{align}
and promote the symplectic form to a hermitian sesquilinear form by 
\begin{align}
  \langle \psi_1, \psi_2\rangle := -i \,\omega(\psi^*_1, \psi_2) = -i\int_\Sigma \star d\psi_1^* \, \psi_2 - \psi_1^* \, \star d\psi_2
  \quad \forall\, \psi_1, \psi_2 \in \mathcal{S}_\C, \qquad \langle \psi_1, \psi_2\rangle = \langle \psi_2, \psi_1\rangle^*.
\end{align}
This is again written in terms of a \emph{complex} \emph{conserved} current, now associated to the global $U(1)$-symmetry $\psi \mapsto e^{i\alpha} \psi$ of the complex Klein--Gordon lagrangian,
\begin{align}
    \langle \psi_1, \psi_2\rangle \equiv \int_\Sigma \star J_{12}\,,\quad\text{for}\quad
    J_{12}= -i\big(d\psi_1^* \psi_2 - \psi_1^* d\psi_2\big)\quad \text{with} \quad J_{12}^* = J_{21}, \quad \nabla_\mu J^\mu_{12} = 0.
\end{align}
Beware this hermitian product has signature $(+1,-1)$ with an equal number of $\pm1$ by construction, since it arises from a symplectic (real antisymmetric) form and thus
\begin{align}\label{eq:signature_pm_hermitian_product_phase_space}
    \langle \psi^*,\chi^*\rangle := i\, \omega(\psi, \chi^*) = -i\, \omega(\chi^*, \psi) =: -\langle \chi, \psi \rangle^* = -\langle \psi, \chi \rangle.
\end{align}

Sylvester theorem ensures the existence of a basis of $\{u_n, v_n, z_n\}_{n}$ of $\mathcal{S}_\C$ such that the hermitian form decomposes orthogonally wrt this product as
\begin{align}\label{eq:orthogonality_bogoliubov_basis_complex_phase_space}
    \langle u_n, u_m \rangle = +\delta_{nm}, \,\,\, \langle v_n, v_m \rangle = -\delta_{nm}, \,\,\, \langle u_n, v_m \rangle = 0, \,\,\, \langle z_n, \cdot \rangle = 0, \quad \mathcal{S}_\C = \mathcal{S}_\C^+ \oplus^\perp \mathcal{S}_\C^- \oplus^\perp \mathcal{S}_\C^0\,.
\end{align}
Because of \eqref{eq:signature_pm_hermitian_product_phase_space}, we can and will actually arrange the basis so that $*:\mathcal{S}_\C^+ \to \mathcal{S}_\C^-$ is an isomorphism and $v_n \equiv u_n^*$, and we also remove the ghost modes $z_n$ upon quotienting $\mathcal{S}_C/\mathcal{S}_\C^0$.
Equivalently Darboux theorem for sympletic forms ensures the existence of a basis $\{\phi_n, \, \pi_n, z_n\}_n$ of $\mathcal{S}_\R$ such that
{\small
\begin{align}
    \omega = \begin{pmatrix}
    0 & \mathbb{I} &0\\
    -\mathbb{I} & 0 & 0\\
    0 & 0 & 0
    \end{pmatrix}
    \,\,\text{i.e.}\,\,
    \begin{array}{l}
    \omega(\phi_n, \phi_m) = 0, \quad \omega(\pi_n, \pi_m) = 0,\\[2pt]
    \omega(\phi_n, \pi_m) = \delta_{nm}, \quad \omega(z_n, \cdot) = 0,
    \end{array}\,\,\,\text{simply related by}\,\,\,
    \phi_n= \frac{u_n+u_n^*}{i\sqrt{2}}, \,\,\pi_n = \frac{u_n-u_n^*}{\sqrt{2}}.
\end{align}}
%
The index $n$ can be discrete with Kronecker deltas, or continuous with Dirac deltas, depending on the spatial topology and boundary conditions.
In any case, the bases are complete and yield a resolution of the identity (and similarly for $\mathcal{S}_\R$)
\begin{align}
    \sum_n |u_n\rangle \langle u_n| - \sum_n |v_n\rangle \langle v_n| = \mathbb{I}_{\mathcal{S}_\C}.
\end{align}
%

Finally, suppose we have two complete bases $\{u_n, u_n^*\}_n$ satisfying \eqref{eq:orthogonality_bogoliubov_basis_complex_phase_space}, and we pass to another basis $\{\tilde{u}_m, \tilde{u}_m^*\}_m$ of $\mathcal{S}_\C$ related by a Bogoliubov transformation\todotag{Fix}
\begin{align}
    \tilde{u}_m = \sum_i \alpha_{mi} u_i + \beta_{mi} u_i^*.
\end{align}
Demanding the basis $\{\tilde{u}_m, \tilde{u}_m^*\}_m$ also obey the orthogonality properties \eqref{eq:orthogonality_bogoliubov_basis_complex_phase_space} requires the Bogoliubov coefficient satisfy
\begin{align}
    &\langle \tilde{u}_m, \tilde{u}_{n} \rangle = \delta_{mn} \quad \Rightarrow \quad (\alpha \alpha^\dagger- \beta\beta^\dagger)_{nm}=\sum_i \alpha_{mi}^* \alpha_{ni} - \beta_{mi}^* \beta_{ni}^* = \delta_{mn},\\
    &\langle \tilde{u}_m^*, \tilde{u}_{n} \rangle = 0 \quad \Rightarrow \quad (\alpha\beta^T-\beta\alpha^T)_{nm}=\sum_i -\alpha_{mi} \beta_{ni} + \beta_{mi} \alpha_{ni} = 0.
\end{align}
%
\end{mytheorem}



\begin{mytheorem}[Phase space in static spacetimes\todotag{Finish}]
A particularly important case is that of static spacetimes i.e. spacetimes admitting a global timelike Killing vector field $K$ orthogonal to the spatial slices of the foliation $\mathcal{M}\simeq \R\times \Sigma$.
In adapted coordinates $x^\mu=(t,\mathbf{x})$ the metric reads\footnote{Beware the existence of a global timelike v.f. is not enough, since there might still be cross terms $g_{0j}(\mathbf{x})\neq0$ that cannot be removed by a change of coordinates.}
\begin{align}
    ds^2 = g_{\mu\nu} dx^\mu dx^\nu = g_{00}(\mathbf{x}) dt^2 + g_{ij}(\mathbf{x}) dx^i dx^j.
\end{align}
The Chrsitoffel symbols obey $\Gamma^\mu_{\mu0}=0$ and $\Gamma^\mu_{\mu j} = \bar{\Gamma}^i_{ij}$ where $\bar{\Gamma}^i_{jk}$ are the Christoffel symbols associated to the (postive definite) spatial metric $\bar{g}_{ij}:=-g_{|\Sigma}\equiv -g_{ij}$ induced on leaves $\Sigma$.
The D'Alambert operator then reads in terms the spatial Laplacian $\bar{\nabla}_j\bar{\nabla}^j$ associated to $\bar{g}$
\begin{align}
  \nabla_\mu\nabla^\mu \phi = g^{00}(\mathbf{x}) \partial_t^2 \phi - \bar{\nabla}_j\bar{\nabla}^j\phi\,.
\end{align}
%
If $\{\chi_n(\mathbf{x})\}_n$ is a complete orthonormal set of eigenfunctions of the spatial operator $\tfrac{1}{g^{00}(\mathbf{x})}\big(-\bar{\nabla}_j\bar{\nabla}^j + m^2 + \xi R\big)$ with eigenvalues $\omega_n^2$ so that
\begin{align}
  \int_\Sigma d^n\mathbf{x}\, \sqrt{\bar{g}(\mathbf{x})}\,\, \chi_n(\mathbf{x}) \chi_m(\mathbf{x}) = \delta_{nm}, \quad
\end{align}
the functions below are a complete set of solutions to the Klein--Gordon equation, and form a basis of $\mathcal{S}_\C$ with the desired orthogonality properties
\begin{align}
    u_n^+(t,\mathbf{x}) = \frac{e^{-i\omega_n t}}{\sqrt{2\omega_n}} \chi_n(\mathbf{x}), \quad u_n^-(t,\mathbf{x}) = \big(u_n^+\big)^* = \frac{e^{+i\omega_n t}}{\sqrt{2\omega_n}} \chi_n(\mathbf{x})\,.
\end{align}
%
\end{mytheorem}


\begin{mytheorem}[Canonical quantization of scalar field in curved spacetime\todotag{Finish}]
%
We now proceed to canonical quantization following Heinsenberg procedure.
We promote the classical fields $\phi(t,\mathbf{x})$ and $\pi(t,\mathbf{x})$ to \emph{self-adjoint} operators $\hat{\phi}(t,\mathbf{x})$ and $\hat{\pi}(t,\mathbf{x})$ acting on a Hilbert space $\mathcal{H}$ and the equations are left unchanged upon replacing Poisson brackets with commutators $\{\,,\,\}\mapsto -\frac{i}{\hbar}[\,,\,]$.
In particular EoM for the fields and equal-time CCR read
\begin{align}
    &\frac{\partial \hat{\phi}(t,\mathbf{x})}{\partial t} = \frac{1}{i\hbar} [\hat{\phi}(t,\mathbf{x}), \hat{H}(t)] = \frac{\hat{\pi}(t,\mathbf{x})}{\sqrt{|g|} g^{00}} - \frac{g^{0j}}{g^{00}} \nabla_{\!j} \hat{\phi}(t,\mathbf{x}), \\
    &\frac{\partial \hat{\pi}(t,\mathbf{x})}{\partial t} = \frac{1}{i\hbar} [\hat{\pi}(t,\mathbf{x}), \hat{H}(t)] = \nabla_{\!j} \left( \sqrt{|g|} h^{ij} \nabla_{\!i} \hat{\phi}(t,\mathbf{x}) \right) - \sqrt{|g|} V'(\hat{\phi}(t,\mathbf{x})), \\
    &[\hat{\phi}(t,\mathbf{x}), \hat{\phi}(t,\mathbf{y})] = 0, \quad [\hat{\pi}(t,\mathbf{x}), \hat{\pi}(t,\mathbf{y})] = 0, \quad [\hat{\phi}(t,\mathbf{x}), \hat{\pi}(t,\mathbf{y})] = i\hbar\, \delta^{(3)}(\mathbf{x}-\mathbf{y}). \label{eq:CCR_curved_spacetime}
\end{align}
We now want to solve this theory.
The strategy is to mimick the flat spacetime approach and expand the field operator in terms of mode solutions to the Klein--Gordon equation in curved spacetime...

\textbf{Since} the \textbf{symplectic structure} of the classical phase space is \textbf{independent of the chosen foliation} (as long as they are equivalent), the \textbf{CCR} for the field operators are also \textbf{independent of the foliation} chosen for canonical quantization (as long as they are equivalent).
In particular the CCR \eqref{eq:CCR_curved_spacetime} between two fields at spacetime points $x^\mu_1, x^\mu_2$ hold not only when they have the same time coordinate $x^0_1=x^0_2=t$ in the foliation $\mathcal{M}\simeq \R\times \Sigma$ used for quantization, but more generally whenever they are spacelike separated (i.e. the geodesic between them is spacelike) since we can always find an equivalent foliation $\mathcal{M}\simeq \tilde{\R}\times \tilde{\Sigma}$ where they lie on the same leaf $\tilde{\Sigma}_{\tilde{t}}$.
That is\todotag{fix $\delta_3$ make it covariant}
\begin{align}
    [\hat{\phi}(x_1), \hat{\phi}(x_2)] = 0, \quad [\hat{\pi}(x_1), \hat{\pi}(x_2)] = 0, \quad [\hat{\phi}(x_1), \hat{\pi}(x_2)] = i\hbar\, \delta_\Sigma^{(3)}(\mathbf{x}_1 - \mathbf{x}_2),\quad \text{if}\quad (x_1 - x_2)^2 < 0,
\end{align}
where it is understood that the delta function is to hold on a Cauchy hypersurface containing both $x_1$ and $x_2$, that is coordinates such that $x^0_1 = x^0_2 = t$.
\end{mytheorem}





%--------------------------------------------------------
%=========================================================
\section{Green functions}
%=========================================================
%------------------------------------------------------------


\begin{mytheorem}[Dyson--Schwinger equations for correlators in curved spacetime\todotag{polish}]
%
A quantum theory is completely specified by its correlators\footnote{In fact, it is even sufficient to only know time-ordered ones.} (expectation values of products of time-evolved field operators).
Correlators are uniquely determined by the Dyson--Schwinger equations, which are an infinite set of coupled differential equations relating all $n$-point functions to each other for all $n\in\mathbb{N}$.
If two theories have all the same Dyson--Schwinger equations for correlators, they are thus completely equivalent.
In particular this proves the equivalence between canonical quantization and path integral quantization in curved spacetime, at least as long as the former approach is applicable.
\end{mytheorem}